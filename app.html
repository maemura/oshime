<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‹ã¶ã®ã™ã‘ â€” ä»Šæ—¥ã®é«˜é…å½“æŠ¼ã—ç›®ã‚’è‡ªå‹•æŠ½å‡º</title>
<meta name="description" content="æ—¥çµŒã®åœ°åˆã„ã‚’åˆ¤å®šã—ã¦ã€ä»Šæ—¥è²·ã„ã‚„ã™ã„é«˜é…å½“ãƒ»å‰²å®‰æ ªã‚’è‡ªå‹•ã‚¹ã‚­ãƒ£ãƒ³ã€‚åˆå¿ƒè€…ã§ã‚‚è²·ã„å ´ãŒä¸€ç›®ã§ã‚ã‹ã‚‹ç„¡æ–™ãƒ„ãƒ¼ãƒ«ã€‚">
<meta property="og:title" content="ã‹ã¶ã®ã™ã‘ â€” ä»Šæ—¥ã®æŠ¼ã—ç›®å€™è£œã‚’è‡ªå‹•æŠ½å‡º">
<meta property="og:description" content="åœ°åˆã„åˆ¤å®š Ã— é«˜é…å½“ã‚¹ã‚­ãƒ£ãƒ³ã€‚æ¯æœ8:30æ›´æ–°ã€‚">
<meta property="og:type" content="website">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&family=DM+Mono:wght@400;500&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --navy:#0a2540;
  --navy2:#0d3060;
  --orange:#e8541e;
  --orange2:#ff6b35;
  --orange-lt:#fff3ee;
  --up:#d0021b;
  --dn:#0055cc;
  --green:#00875a;
  --green-lt:#e3fcef;
  --amber:#946500;
  --amber-lt:#fffae6;
  --bg:#f0f4f8;
  --bg2:#ffffff;
  --bg3:#f7f9fc;
  --border:#e2e8f0;
  --text:#2d3748;
  --text2:#1a202c;
  --text3:#718096;
  --r:8px;
  --r2:5px;
  --fn:'DM Mono','Outfit',monospace;
  --fh:'Outfit','Noto Sans JP',sans-serif;
  --fb:'Noto Sans JP',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{font-size:15px;}
body{background:var(--bg);color:var(--text);font-family:var(--fb);min-height:100vh;overflow-x:hidden;}

/* ======= TOPBAR ======= */
.topbar{
  position:sticky;top:0;z-index:200;
  background:var(--navy);border-bottom:3px solid var(--orange);
  height:54px;display:flex;align-items:center;padding:0 20px;
}
.topbar-inner{width:100%;max-width:1280px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;}
.logo{display:flex;align-items:center;gap:10px;}
.logo-texts{}
.logo-name{font-family:var(--fh);font-size:17px;font-weight:800;color:#fff;letter-spacing:-0.3px;line-height:1.1;}
.logo-tag{font-size:9px;color:rgba(255,255,255,0.45);font-family:var(--fh);letter-spacing:0.5px;}
.topbar-right{display:flex;align-items:center;gap:8px;}
.btn-watch{
  background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);
  border-radius:var(--r2);padding:5px 12px;
  font-family:var(--fh);font-size:11px;font-weight:700;color:#fff;cursor:pointer;
  transition:all 0.15s;display:flex;align-items:center;gap:5px;position:relative;
}
.btn-watch:hover{background:rgba(255,255,255,0.2);}
.watch-count{
  background:var(--orange);color:#fff;border-radius:10px;
  padding:1px 5px;font-size:9px;font-weight:700;display:none;
}
.watch-count.show{display:inline-block;}

/* ======= PAGE LAYOUT ======= */
.page{max-width:1280px;margin:0 auto;padding:20px 20px 100px;}
@media(min-width:960px){
  .page{display:grid;grid-template-columns:1fr 400px;gap:24px;align-items:start;}
  .col-right{position:sticky;top:74px;}
}
@media(max-width:480px){.page{padding:14px 14px 90px;}}

/* ======= HERO ======= */
.hero{
  background:linear-gradient(135deg,var(--navy) 0%,#0e2f5a 100%);
  border-radius:var(--r);padding:24px;margin-bottom:18px;
  position:relative;overflow:hidden;
}
.hero::before{
  content:'';position:absolute;right:-50px;top:-50px;
  width:220px;height:220px;border-radius:50%;
  background:rgba(232,84,30,0.09);pointer-events:none;
}
.hero::after{
  content:'';position:absolute;left:-30px;bottom:-40px;
  width:160px;height:160px;border-radius:50%;
  background:rgba(255,255,255,0.03);pointer-events:none;
}
.hero-eyebrow{
  display:inline-flex;align-items:center;gap:7px;
  background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);
  border-radius:20px;padding:4px 12px;
  font-family:var(--fh);font-size:10px;color:rgba(255,255,255,0.55);
  margin-bottom:16px;letter-spacing:0.3px;
}
.hero-dot{
  width:6px;height:6px;border-radius:50%;background:var(--orange);flex-shrink:0;
  animation:blink 2s ease-in-out infinite;
}
.hero-title{
  font-family:var(--fh);font-size:26px;font-weight:800;color:#fff;
  line-height:1.25;margin-bottom:12px;letter-spacing:-0.5px;
}
.hero-title span{color:var(--orange2);}
@media(max-width:480px){.hero-title{font-size:21px;}}
.hero-sub{
  font-size:13px;color:rgba(255,255,255,0.6);line-height:1.85;margin-bottom:20px;
}
.hero-sub strong{color:rgba(255,255,255,0.9);font-weight:700;}
.hero-stats{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px;}
.hero-stat{
  background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);
  border-radius:var(--r2);padding:10px 14px;flex:1;min-width:80px;
}
.hero-stat-val{font-family:var(--fn);font-size:22px;color:#fff;line-height:1;margin-bottom:3px;}
.hero-stat-val.buy{color:var(--orange2);}
.hero-stat-label{font-size:9px;color:rgba(255,255,255,0.45);font-family:var(--fh);}
.hero-cta{
  display:inline-flex;align-items:center;gap:6px;
  background:var(--orange);color:#fff;border:none;border-radius:var(--r2);
  padding:10px 18px;font-family:var(--fh);font-size:12px;font-weight:700;
  cursor:pointer;transition:all 0.15s;letter-spacing:0.3px;
}
.hero-cta:hover{background:var(--orange2);}

/* ======= MARKET PULSE ======= */
.pulse{
  background:var(--bg2);border:1px solid var(--border);
  border-radius:var(--r);margin-bottom:16px;overflow:hidden;
}
.pulse-row{display:flex;overflow-x:auto;scrollbar-width:none;}
.pulse-row::-webkit-scrollbar{display:none;}
.pc{flex-shrink:0;padding:10px 14px;border-right:1px solid var(--border);min-width:90px;text-align:center;}
.pc:last-child{border-right:none;}
.pc-l{font-size:9px;color:var(--text3);font-family:var(--fh);letter-spacing:0.3px;margin-bottom:2px;}
.pc-v{font-family:var(--fn);font-size:13px;color:var(--text2);}
.pc-v.up{color:var(--up);}
.pc-v.dn{color:var(--dn);}
.pc-c{font-family:var(--fn);font-size:10px;color:var(--text3);}
.pc-c.up{color:var(--up);}
.pc-c.dn{color:var(--dn);}

/* ======= STANCE BLOCK ======= */
.stance{
  background:var(--bg2);border-radius:var(--r);padding:18px;margin-bottom:16px;
  border:1px solid var(--border);border-left:4px solid var(--border);
}
.stance.bull{border-left-color:var(--up);}
.stance.neutral{border-left-color:var(--amber);}
.stance.bear{border-left-color:var(--dn);}
.stance-head{margin-bottom:12px;}
.stance-date{font-size:11px;color:var(--text3);font-family:var(--fh);margin-bottom:5px;}
.stance-top{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap;}
.stance-title{font-family:var(--fh);font-size:17px;font-weight:800;color:var(--text2);letter-spacing:-0.2px;}
.stance-badge{
  flex-shrink:0;padding:5px 12px;border-radius:20px;
  font-family:var(--fh);font-size:11px;font-weight:700;border:1px solid;white-space:nowrap;
}
.stance-badge.bull{background:rgba(208,2,27,0.07);color:var(--up);border-color:rgba(208,2,27,0.2);}
.stance-badge.neutral{background:var(--amber-lt);color:var(--amber);border-color:rgba(148,101,0,0.2);}
.stance-badge.bear{background:rgba(0,85,204,0.07);color:var(--dn);border-color:rgba(0,85,204,0.2);}
.stance-reason{
  font-size:13px;color:var(--text);line-height:1.9;margin-bottom:14px;
}
.stance-reason strong{color:var(--navy);font-weight:700;}
/* Data chips â€” æ•°å€¤æ ¹æ‹ ã‚’ä¸¦ã¹ã‚‹ */
.stance-data{display:flex;gap:8px;flex-wrap:wrap;}
.stance-chip{
  background:var(--bg3);border:1px solid var(--border);border-radius:var(--r2);
  padding:8px 12px;flex:1;min-width:80px;text-align:center;
}
.stance-chip.buy{background:var(--green-lt);border-color:rgba(0,135,90,0.2);}
.stance-chip.warn{background:var(--amber-lt);border-color:rgba(148,101,0,0.2);}
.stance-chip.hold{background:var(--bg3);border-color:var(--border);}
.stance-chip-val{
  font-family:var(--fn);font-size:16px;line-height:1;margin-bottom:3px;
}
.stance-chip.buy .stance-chip-val{color:var(--up);}
.stance-chip.warn .stance-chip-val{color:var(--amber);}
.stance-chip.hold .stance-chip-val{color:var(--text3);}
.stance-chip-label{font-family:var(--fh);font-size:9px;color:var(--text3);}
/* 3è»¸ã‚¹ã‚³ã‚¢ãƒãƒ¼ */
.stance-axes{margin-bottom:14px;display:flex;flex-direction:column;gap:7px;}
.axis-row{display:flex;align-items:center;gap:10px;font-size:12px;}
.axis-name{color:var(--text);min-width:120px;font-size:11px;}
.axis-bar{display:flex;gap:3px;}
.axis-seg{width:28px;height:7px;border-radius:3px;background:var(--border);}
.axis-seg.on.hi{background:var(--up);}
.axis-seg.on.mid{background:var(--amber);}
.axis-seg.on.zero{background:var(--dn);}
.axis-score{font-family:var(--fn);font-size:11px;color:var(--text3);width:30px;}
.axis-total{font-family:var(--fh);font-size:11px;font-weight:700;color:var(--text2);padding-top:4px;border-top:1px solid var(--border);}
.axis-total strong{color:var(--navy);}
/* stance note */
.stance-note{
  margin-top:12px;padding:8px 12px;background:var(--bg3);border:1px solid var(--border);
  border-radius:var(--r2);font-size:11px;color:var(--text3);line-height:1.7;
}

/* ======= MODE & SCAN ======= */
.mode-wrap{margin-bottom:14px;}
.sec-label{
  font-family:var(--fh);font-size:10px;font-weight:700;color:var(--text3);
  letter-spacing:1px;text-transform:uppercase;margin-bottom:8px;
}
.mode-tabs{display:flex;gap:6px;}
.mode-tab{
  flex:1;background:var(--bg2);border:1.5px solid var(--border);
  border-radius:var(--r);padding:10px 8px;text-align:center;cursor:pointer;
  transition:all 0.15s;
}
.mode-tab:hover{border-color:var(--navy2);}
.mode-tab.active{background:var(--navy);border-color:var(--navy);}
.mode-ico{font-size:18px;margin-bottom:3px;}
.mode-t{font-family:var(--fh);font-size:10px;font-weight:600;color:var(--text3);}
.mode-tab.active .mode-t{color:rgba(255,255,255,0.85);}

.btn-scan{
  width:100%;background:var(--orange);color:#fff;border:none;
  border-radius:var(--r);padding:14px;
  font-family:var(--fh);font-size:14px;font-weight:700;cursor:pointer;
  transition:all 0.15s;letter-spacing:0.3px;
  display:flex;align-items:center;justify-content:center;gap:8px;
  box-shadow:0 2px 8px rgba(232,84,30,0.35);margin-bottom:16px;
}
.btn-scan:hover{background:var(--orange2);}
.btn-scan:active{transform:scale(0.99);}

/* ======= SCAN ANIMATION ======= */
.scan-anim{
  display:none;background:var(--bg2);border:1px solid var(--border);
  border-radius:var(--r);padding:20px;margin-bottom:16px;text-align:center;
}
.scan-anim.show{display:block;}
.scan-anim-steps{display:flex;flex-direction:column;gap:8px;text-align:left;max-width:260px;margin:0 auto;}
.scan-step{
  display:flex;align-items:center;gap:10px;font-size:12px;color:var(--text3);
  opacity:0;transition:opacity 0.3s;
}
.scan-step.done{color:var(--green);opacity:1;}
.scan-step.active{color:var(--text2);opacity:1;}
.scan-step-dot{width:8px;height:8px;border-radius:50%;background:var(--border);flex-shrink:0;}
.scan-step.done .scan-step-dot{background:var(--green);}
.scan-step.active .scan-step-dot{background:var(--orange);animation:blink 0.7s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}

/* ======= RANKINGS ======= */
.rankings{margin-bottom:16px;}
.rank-block{
  background:var(--bg2);border:1px solid var(--border);
  border-radius:var(--r);overflow:hidden;margin-bottom:10px;
}
.rank-head{
  background:var(--navy);padding:8px 14px;
  display:flex;align-items:center;gap:6px;
}
.rank-head-title{font-family:var(--fh);font-size:12px;font-weight:700;color:#fff;}
.rank-rows{}
.rank-row{
  padding:10px 14px;display:flex;align-items:center;gap:10px;
  cursor:pointer;transition:background 0.1s;border-bottom:1px solid var(--border);
}
.rank-row:last-child{border-bottom:none;}
.rank-row:hover{background:var(--bg3);}
.rank-num{font-family:var(--fn);font-size:13px;color:var(--text3);width:18px;flex-shrink:0;text-align:center;}
.rank-num.top{color:var(--orange);font-weight:700;}
.rank-info{flex:1;min-width:0;}
.rank-name{font-size:13px;color:var(--text2);font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rank-meta{font-size:10px;color:var(--text3);margin-top:1px;font-family:var(--fn);}
.rank-right{text-align:right;flex-shrink:0;}
.rank-score{
  display:inline-flex;align-items:center;justify-content:center;
  width:36px;height:36px;border-radius:50%;
  font-family:var(--fn);font-size:12px;border:2px solid;
}
.rank-score.hi{color:var(--up);border-color:rgba(208,2,27,0.2);background:rgba(208,2,27,0.04);}
.rank-score.md{color:var(--amber);border-color:rgba(148,101,0,0.2);background:var(--amber-lt);}
.rank-score.lo{color:var(--text3);border-color:var(--border);background:var(--bg3);}
.rank-key{font-size:10px;color:var(--text3);margin-top:2px;font-family:var(--fn);}
.rank-key.w{color:var(--orange);}
.rank-key.g{color:var(--green);}

/* ======= EVENTS ======= */
.events{margin-bottom:16px;}
.sec-head{font-family:var(--fh);font-size:12px;font-weight:700;color:#fff;background:var(--navy);border-radius:var(--r) var(--r) 0 0;padding:9px 14px;display:flex;align-items:center;gap:6px;}
.event-list{background:var(--bg2);border:1px solid var(--border);border-top:none;border-radius:0 0 var(--r) var(--r);overflow:hidden;}
.event-row{display:flex;gap:12px;padding:11px 14px;border-bottom:1px solid var(--border);font-size:12px;}
.event-row:last-child{border-bottom:none;}
.ev-ico{font-size:18px;flex-shrink:0;padding-top:1px;}
.ev-body{flex:1;}
.ev-title{font-weight:600;color:var(--text2);margin-bottom:3px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.ev-desc{font-size:11px;color:var(--text3);line-height:1.7;}
.ev-tag{display:inline-flex;padding:1px 6px;border-radius:3px;font-family:var(--fh);font-size:9px;font-weight:700;flex-shrink:0;}
.ev-tag.bull{background:rgba(208,2,27,0.07);color:var(--up);}
.ev-tag.bear{background:rgba(0,85,204,0.07);color:var(--dn);}
.ev-tag.neutral{background:var(--bg3);color:var(--text3);}

/* ======= TRUST BAR ======= */
.trust-bar{
  background:var(--bg2);border:1px solid var(--border);
  border-left:4px solid var(--green);border-radius:var(--r);
  padding:10px 14px;margin-bottom:14px;
  display:flex;align-items:center;justify-content:space-between;
  gap:10px;flex-wrap:wrap;
}
.trust-left{display:flex;align-items:center;gap:8px;}
.trust-dot{width:8px;height:8px;border-radius:50%;background:var(--amber);flex-shrink:0;}
.trust-text{font-size:12px;color:var(--text2);font-weight:500;}
.trust-text .hi{color:var(--green);font-weight:700;}
.trust-text .warn{color:var(--amber);font-weight:700;}
.trust-badges{display:flex;gap:5px;flex-wrap:wrap;}
.tbadge{background:var(--bg3);border:1px solid var(--border);border-radius:4px;padding:3px 8px;font-size:10px;color:var(--text3);}
.tbadge.link{cursor:pointer;transition:all 0.15s;}
.tbadge.link:hover{border-color:var(--navy);color:var(--navy);}

/* ======= DIFF BAR ======= */
.diff-bar{
  background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);
  padding:8px 14px;margin-bottom:14px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;font-size:11px;
}
.diff-label{color:var(--text3);}
.diff-new{color:var(--green);font-weight:700;}
.diff-gone{color:var(--text3);font-weight:700;}
.diff-same{color:var(--text3);}
.diff-sep{color:var(--border);}

/* ======= DISCLAIMER ======= */
.disclaimer{font-size:11px;color:var(--text3);line-height:1.8;background:var(--bg3);border:1px solid var(--border);border-radius:var(--r2);padding:10px 14px;margin-bottom:16px;}

/* ======= BOTTOM NAV ======= */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;z-index:200;background:var(--bg2);border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-around;padding:8px 0 max(8px,env(safe-area-inset-bottom));}
@media(min-width:960px){.bottom-nav{display:none;}}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:2px;padding:4px 24px;cursor:pointer;background:none;border:none;transition:all 0.15s;}
.nav-ico{font-size:20px;line-height:1;}
.nav-label{font-family:var(--fh);font-size:9px;font-weight:600;color:var(--text3);letter-spacing:0.3px;}
.nav-item.active .nav-label{color:var(--navy);}

/* PC tabs */
.pc-tabs{display:none;}
@media(min-width:960px){
  .pc-tabs{display:flex;gap:4px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);padding:4px;margin-bottom:16px;}
  .pc-tab{flex:1;background:none;border:none;border-radius:var(--r2);padding:8px 12px;font-family:var(--fh);font-size:12px;font-weight:600;color:var(--text3);cursor:pointer;transition:all 0.15s;}
  .pc-tab.active{background:var(--navy);color:#fff;}
  .pc-tab:hover:not(.active){background:var(--bg3);}
}

/* ======= PANELS ======= */
.panel{display:none;}
.panel.active{display:block;}

/* ======= CARD AREA ======= */
.card-wrap{}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.card-label{font-family:var(--fh);font-size:10px;font-weight:700;color:var(--text3);letter-spacing:1px;text-transform:uppercase;}
.card-nav{display:flex;align-items:center;gap:8px;}
.card-counter{font-family:var(--fn);font-size:12px;color:var(--text3);}
.card-arr{background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--r2);width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;color:var(--text);transition:all 0.15s;}
.card-arr:hover{border-color:var(--navy);color:var(--navy);}
.card-arr:disabled{opacity:0.3;cursor:not-allowed;}

/* Stock Card */
.stock-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);border-top:3px solid var(--navy);padding:16px;}
.score-hero{display:flex;align-items:center;gap:14px;margin-bottom:14px;padding-bottom:14px;border-bottom:1px solid var(--border);}
.score-ring{position:relative;flex-shrink:0;width:72px;height:72px;}
.score-ring svg{transform:rotate(-90deg);}
.score-ring-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.score-ring-num{font-family:var(--fn);font-size:22px;line-height:1;}
.score-ring-lbl{font-family:var(--fh);font-size:7px;letter-spacing:1.5px;color:var(--text3);margin-top:2px;}
.score-info{flex:1;min-width:0;}
.score-zone{display:inline-flex;align-items:center;padding:3px 9px;border-radius:20px;font-family:var(--fh);font-size:10px;font-weight:700;border:1px solid;margin-bottom:6px;}
.score-zone.buy{background:rgba(208,2,27,0.06);color:var(--up);border-color:rgba(208,2,27,0.2);}
.score-zone.watch{background:var(--amber-lt);color:var(--amber);border-color:rgba(148,101,0,0.2);}
.score-zone.hold{background:var(--bg3);color:var(--text3);border-color:var(--border);}
.score-name{font-family:var(--fh);font-size:18px;font-weight:700;color:var(--text2);margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.score-code{font-size:11px;color:var(--text3);font-family:var(--fn);}

/* WHY BLOCK â€” è²·ã„ç†ç”±ã‚’å¤§ãã */
.why-block{
  background:var(--bg3);border:1px solid var(--border);
  border-radius:var(--r);padding:14px;margin-bottom:14px;
}
.why-title{font-family:var(--fh);font-size:10px;font-weight:700;color:var(--text3);letter-spacing:0.8px;margin-bottom:10px;}
.why-items{display:flex;flex-wrap:wrap;gap:8px;}
.why-item{
  background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--r2);
  padding:9px 12px;flex:1;min-width:110px;
}


/* Why block â€” è²·ã„ç†ç”±ï¼ˆå¼·åŒ–ç‰ˆï¼‰*/
.why-block{
  background:var(--bg3);border:1px solid var(--border);
  border-radius:var(--r);padding:14px;margin-bottom:14px;
}
.why-block.why-empty{padding:12px 14px;}
.why-header{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:12px;flex-wrap:wrap;}
.why-title{font-family:var(--fh);font-size:10px;font-weight:700;color:var(--text3);letter-spacing:0.8px;}
.why-strength{font-family:var(--fh);font-size:10px;font-weight:700;padding:2px 8px;border-radius:4px;}
.why-strength.strong{background:rgba(208,2,27,0.08);color:var(--up);}
.why-strength.mid{background:var(--amber-lt);color:var(--amber);}
.why-strength.weak{background:var(--bg3);color:var(--text3);}
.why-items{display:flex;flex-direction:column;gap:8px;}
.why-item{
  background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--r2);
  padding:10px 12px;position:relative;
}
.why-item.strong{border-color:rgba(208,2,27,0.25);background:rgba(208,2,27,0.03);}
.why-item.mid{border-color:rgba(148,101,0,0.25);background:var(--amber-lt);}
.why-rank-badge{
  position:absolute;top:10px;right:10px;
  width:18px;height:18px;border-radius:50%;
  font-family:var(--fh);font-size:9px;font-weight:700;
  display:flex;align-items:center;justify-content:center;
}
.why-rank-badge.strong{background:rgba(208,2,27,0.1);color:var(--up);}
.why-rank-badge.mid{background:rgba(148,101,0,0.1);color:var(--amber);}
.why-val{font-family:var(--fn);font-size:20px;font-weight:500;color:var(--text2);line-height:1;margin-bottom:2px;}
.why-item.strong .why-val{color:var(--up);}
.why-item.mid .why-val{color:var(--amber);}
.why-label{font-size:10px;color:var(--text3);margin-bottom:3px;}
.why-note-text{font-size:11px;font-weight:700;margin-bottom:4px;}
.why-item.strong .why-note-text{color:var(--up);}
.why-item.mid .why-note-text{color:var(--amber);}
.why-desc{font-size:11px;color:var(--text3);line-height:1.6;}
/* ã‚¹ã‚³ã‚¢ã‚¾ãƒ¼ãƒ³è¡Œ */
.score-zone-row{display:flex;align-items:center;gap:6px;flex-wrap:wrap;margin-bottom:6px;}
/* å‰æ—¥æ¯”å¤‰åŒ–ãƒãƒƒã‚¸ */
.change-badge{
  display:inline-flex;align-items:center;padding:2px 7px;border-radius:4px;
  font-family:var(--fn);font-size:10px;font-weight:700;
}
.change-badge.up{background:rgba(208,2,27,0.07);color:var(--up);}
.change-badge.dn{background:rgba(0,85,204,0.07);color:var(--dn);}
.change-badge.flat{background:var(--bg3);color:var(--text3);}
.change-badge.rank{background:rgba(232,84,30,0.08);color:var(--orange);}

/* Metrics */
.metrics{width:100%;border-collapse:collapse;margin-bottom:14px;font-size:12px;}
.metrics th{background:var(--navy);color:rgba(255,255,255,0.65);padding:6px;font-family:var(--fh);font-size:9px;font-weight:600;letter-spacing:0.5px;text-align:center;}
.metrics td{padding:8px 6px;text-align:center;border:1px solid var(--border);}
.metrics td.val{font-family:var(--fn);font-size:14px;color:var(--text2);}
.metrics td.val.up{color:var(--up);}
.metrics td.val.dn{color:var(--dn);}
.metrics td.val.w{color:var(--orange);}
.metrics td.hint{font-size:9px;color:var(--text3);padding:3px 6px;background:var(--bg3);}

/* Breakdown */
.breakdown{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r2);padding:12px 14px;margin-bottom:14px;}
.breakdown-title{font-family:var(--fh);font-size:10px;font-weight:700;color:var(--text3);letter-spacing:0.5px;margin-bottom:10px;}
.bd-row{display:flex;align-items:center;gap:8px;margin-bottom:7px;font-size:12px;}
.bd-row:last-child{margin-bottom:0;}
.bd-l{color:var(--text);min-width:72px;font-size:11px;}
.bd-bar{flex:1;height:5px;background:var(--border);border-radius:3px;overflow:hidden;}
.bd-fill{height:100%;border-radius:3px;transition:width 0.4s ease;}
.bd-v{font-family:var(--fn);font-size:11px;width:36px;text-align:right;}
.bd-v.pos{color:var(--up);}
.bd-v.neg{color:var(--dn);}

/* Card actions */
.card-actions{display:flex;gap:8px;}
.btn-fav{flex:1;background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--r2);padding:10px;font-family:var(--fh);font-size:12px;color:var(--text);cursor:pointer;transition:all 0.15s;display:flex;align-items:center;justify-content:center;gap:5px;}
.btn-fav:hover{border-color:var(--orange);color:var(--orange);}
.btn-fav.active{background:var(--orange-lt);border-color:rgba(232,84,30,0.3);color:var(--orange);}

/* ======= WATCHLIST ======= */
.watch-empty{background:var(--bg2);border:1px solid var(--border);border-top:none;border-radius:0 0 var(--r) var(--r);padding:20px;text-align:center;font-size:12px;color:var(--text3);}
.watch-list{background:var(--bg2);border:1px solid var(--border);border-top:none;border-radius:0 0 var(--r) var(--r);overflow:hidden;}
.watch-row{padding:10px 14px;display:flex;align-items:center;gap:10px;cursor:pointer;transition:background 0.1s;border-bottom:1px solid var(--border);}
.watch-row:last-child{border-bottom:none;}
.watch-row:hover{background:var(--bg3);}
.watch-code{font-family:var(--fn);font-size:11px;color:var(--navy);font-weight:500;width:38px;}
.watch-name{flex:1;font-size:13px;color:var(--text2);}
.watch-score{font-family:var(--fn);font-size:14px;}
.watch-score.hi{color:var(--up);}
.watch-score.md{color:var(--amber);}
.watch-remove{background:none;border:none;color:var(--text3);cursor:pointer;font-size:14px;padding:2px 5px;transition:color 0.15s;}
.watch-remove:hover{color:var(--up);}

/* ======= HISTORY ======= */
.hist-table{width:100%;border-collapse:collapse;background:var(--bg2);border:1px solid var(--border);border-top:none;border-radius:0 0 var(--r) var(--r);overflow:hidden;font-size:12px;}
.hist-table th{background:var(--bg3);color:var(--text3);padding:7px 12px;font-family:var(--fh);font-size:9px;font-weight:700;text-align:left;border-bottom:1px solid var(--border);}
.hist-table td{padding:8px 12px;border-bottom:1px solid var(--border);color:var(--text);font-family:var(--fn);font-size:11px;}
.hist-table tr:last-child td{border-bottom:none;}
.hist-table tr:hover td{background:var(--bg3);}

/* ======= QUIZ ======= */
.quiz-overlay{display:none;position:fixed;inset:0;z-index:300;background:rgba(10,37,64,0.6);backdrop-filter:blur(2px);align-items:flex-end;justify-content:center;}
.quiz-overlay.open{display:flex;}
@media(min-width:640px){.quiz-overlay.open{align-items:center;}}
.quiz-box{background:var(--bg2);border-radius:14px 14px 0 0;width:100%;max-width:520px;padding:20px 20px max(20px,env(safe-area-inset-bottom));animation:slideUp 0.25s ease;max-height:90vh;overflow-y:auto;}
@media(min-width:640px){.quiz-box{border-radius:14px;max-height:80vh;}}
@keyframes slideUp{from{transform:translateY(60px);opacity:0}to{transform:translateY(0);opacity:1}}
.quiz-handle{width:36px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 18px;}
@media(min-width:640px){.quiz-handle{display:none;}}
.quiz-step{font-family:var(--fh);font-size:10px;font-weight:700;color:var(--text3);letter-spacing:0.8px;margin-bottom:8px;}
.quiz-bar{display:flex;gap:4px;margin-bottom:18px;}
.quiz-seg{flex:1;height:3px;border-radius:2px;background:var(--border);transition:background 0.3s;}
.quiz-seg.done{background:var(--navy);}
.quiz-seg.active{background:var(--orange);}
.quiz-q{font-family:var(--fh);font-size:16px;font-weight:700;color:var(--text2);margin-bottom:5px;line-height:1.4;}
.quiz-hint{font-size:12px;color:var(--text3);margin-bottom:14px;line-height:1.6;}
.quiz-rec{background:rgba(10,37,64,0.05);border:1px solid rgba(10,37,64,0.12);border-left:3px solid var(--navy);border-radius:0 var(--r2) var(--r5) 0;padding:10px 13px;margin-bottom:14px;font-size:12px;display:flex;gap:9px;align-items:flex-start;}
.quiz-rec-ico{font-size:17px;flex-shrink:0;}
.quiz-rec-label{font-family:var(--fh);font-size:9px;color:var(--navy);font-weight:700;letter-spacing:0.5px;margin-bottom:2px;}
.quiz-rec-text{color:var(--navy);font-weight:600;font-size:13px;margin-bottom:2px;}
.quiz-rec-reason{font-size:11px;color:var(--text3);line-height:1.5;}
.quiz-opts{display:flex;flex-direction:column;gap:7px;}
.quiz-opt{background:var(--bg2);border:1.5px solid var(--border);border-radius:var(--r);padding:12px 14px;cursor:pointer;transition:all 0.15s;display:flex;align-items:center;gap:12px;position:relative;}
.quiz-opt:hover{border-color:var(--navy2);}
.quiz-opt.sel{border-color:var(--navy);background:var(--bg3);}
.quiz-opt.recommended{border-color:var(--orange);background:var(--orange-lt);}
.quiz-opt-ico{font-size:20px;flex-shrink:0;}
.quiz-opt-t{font-family:var(--fh);font-size:13px;color:var(--text2);font-weight:700;margin-bottom:2px;}
.quiz-opt-d{font-size:11px;color:var(--text3);line-height:1.5;}
.rec-badge{position:absolute;top:-1px;right:-1px;background:var(--orange);color:#fff;font-family:var(--fh);font-size:9px;font-weight:700;padding:2px 8px;border-radius:0 var(--r) 0 var(--r2);}
.quiz-nav{display:flex;justify-content:space-between;align-items:center;margin-top:16px;gap:8px;}
.btn-qback{background:var(--bg3);border:1.5px solid var(--border);border-radius:var(--r2);padding:9px 16px;font-family:var(--fh);font-size:12px;font-weight:600;color:var(--text);cursor:pointer;transition:all 0.15s;}
.btn-qback:hover{border-color:var(--navy);}
.btn-qnext{flex:1;background:var(--navy);border:none;border-radius:var(--r2);padding:10px 20px;font-family:var(--fh);font-size:13px;font-weight:700;color:#fff;cursor:pointer;transition:all 0.15s;}
.btn-qnext:hover{background:var(--navy2);}
.btn-qnext:disabled{opacity:0.4;cursor:not-allowed;}

/* ======= LOGIC MODAL ======= */
.logic-overlay{display:none;position:fixed;inset:0;z-index:500;background:rgba(0,0,0,0.5);}
.logic-overlay.open{display:flex;align-items:flex-end;justify-content:center;}
@media(min-width:640px){.logic-overlay.open{align-items:center;}}
.logic-box{background:var(--bg2);border-radius:14px 14px 0 0;width:100%;max-width:480px;max-height:88vh;overflow-y:auto;padding:20px 20px max(20px,env(safe-area-inset-bottom));animation:slideUp 0.25s ease;}
@media(min-width:640px){.logic-box{border-radius:14px;}}
.modal-handle{width:36px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 16px;}
@media(min-width:640px){.modal-handle{display:none;}}
.modal-close{float:right;background:none;border:none;color:var(--text3);font-size:17px;cursor:pointer;line-height:1;}
.logic-title{font-family:var(--fh);font-size:16px;font-weight:700;color:var(--text2);margin-bottom:4px;}
.logic-sub{font-size:12px;color:var(--text3);margin-bottom:16px;line-height:1.6;}
.logic-tbl{width:100%;border-collapse:collapse;font-size:12px;margin-bottom:14px;}
.logic-tbl th{background:var(--navy);color:rgba(255,255,255,0.7);padding:7px 10px;font-family:var(--fh);font-size:9px;font-weight:600;text-align:left;letter-spacing:0.5px;}
.logic-tbl td{padding:9px 10px;border-bottom:1px solid var(--border);color:var(--text);}
.logic-tbl td:first-child{font-weight:600;color:var(--text2);width:90px;}
.logic-tbl td.pts{font-family:var(--fn);color:var(--navy);text-align:right;width:60px;}
.logic-tbl tr:nth-child(even) td{background:var(--bg3);}
.logic-note{background:var(--amber-lt);border:1px solid rgba(148,101,0,0.15);border-left:3px solid var(--amber);border-radius:0 var(--r2) var(--r2) 0;padding:10px 13px;font-size:11px;color:var(--text);line-height:1.8;margin-bottom:14px;}
.logic-note strong{color:var(--amber);}
.btn-logic-close{width:100%;background:var(--navy);color:#fff;border:none;border-radius:var(--r2);padding:12px;font-family:var(--fh);font-size:13px;font-weight:700;cursor:pointer;}

/* ======= LOADER ======= */
.loader{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px;gap:10px;}
.spin{width:22px;height:22px;border:2px solid var(--border);border-top-color:var(--navy);border-radius:50%;animation:spin 0.7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
.loader-text{font-size:12px;color:var(--text3);}
.fadein{animation:fadeIn 0.2s ease both;}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

/* ======= RESPONSIVE ======= */
@media(max-width:480px){
  .topbar{padding:0 14px;}
  .logo-tag{display:none;}
  .hero{padding:16px;}
  .hero-stat-val{font-size:17px;}
  .hero-stats{gap:6px;}
  .metrics th{font-size:8px;padding:5px 3px;}
  .metrics td.val{font-size:12px;}
  .metrics td.hint{font-size:8px;}
  .why-item{min-width:calc(50% - 4px);}
}
</style>
</head>
<body>

<!-- TOPBAR -->
<header class="topbar">
  <div class="topbar-inner">
    <div class="logo">
      <div class="logo-texts">
        <div class="logo-name">ã‹ã¶ã®ã™ã‘</div>
        <div class="logo-tag">é«˜é…å½“ãƒ»å‰²å®‰æ ªã®è²·ã„å ´ã‚’æ¯æ—¥ã‚¹ã‚­ãƒ£ãƒ³</div>
      </div>
    </div>
    <div class="topbar-right">
      <button class="btn-watch" onclick="switchTab('watch')">
        â­ ã‚¦ã‚©ãƒƒãƒ<span class="watch-count" id="watchCount">0</span>
      </button>
    </div>
  </div>
</header>

<div class="page">

  <!-- LEFT COLUMN -->
  <div class="col-left">

    <div class="pc-tabs">
      <button class="pc-tab active" id="pc-home" onclick="switchTab('home')">ğŸ  ãƒ›ãƒ¼ãƒ </button>
      <button class="pc-tab" id="pc-watch" onclick="switchTab('watch')">â­ ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆ</button>
    </div>

    <!-- HOME PANEL -->
    <div class="panel active" id="panel-home">

      <!-- HERO -->
      <div class="hero">
        <div class="hero-eyebrow" id="heroEyebrow">
          <span class="hero-dot"></span>æ¯æœ8:30ãƒ»å‰å ´å¾Œ12:30 è‡ªå‹•æ›´æ–°
        </div>
        <div class="hero-title">ä»Šæ—¥ã®é«˜é…å½“æŠ¼ã—ç›®å€™è£œã‚’<br><span>è‡ªå‹•æŠ½å‡º</span></div>
        <div class="hero-sub">æ—¥çµŒã®åœ°åˆã„ã‚‚åŒæ™‚åˆ¤å®šã€‚æ±è¨¼ãƒ—ãƒ©ã‚¤ãƒ å…¨éŠ˜æŸ„ã‚’5æŒ‡æ¨™ã§ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã—ã¦ã€<strong>åˆå¿ƒè€…ã§ã‚‚è²·ã„æ™‚ãŒä¸€ç›®ã§ã‚ã‹ã‚‹</strong>ç„¡æ–™ãƒ„ãƒ¼ãƒ«ã€‚</div>
        <div class="hero-stats">
          <div class="hero-stat">
            <div class="hero-stat-val buy" id="hsBuy">â€”</div>
            <div class="hero-stat-label">è²·ã„åœã®éŠ˜æŸ„æ•°</div>
          </div>
          <div class="hero-stat">
            <div class="hero-stat-val" id="hsTop">â€”</div>
            <div class="hero-stat-label">æœ¬æ—¥1ä½ã‚¹ã‚³ã‚¢</div>
          </div>
          <div class="hero-stat">
            <div class="hero-stat-val" id="hsDiv">â€”</div>
            <div class="hero-stat-label">æœ€é«˜é…å½“åˆ©å›ã‚Š</div>
          </div>
        </div>
        <button class="hero-cta" onclick="document.getElementById('stanceBox').scrollIntoView({behavior:'smooth'})">
          ä»Šæ—¥ã®åœ°åˆã„åˆ¤å®šã‚’è¦‹ã‚‹ â†“
        </button>
      </div>

      <!-- MARKET PULSE -->
      <div class="pulse">
        <div class="pulse-row" id="pulseBar"></div>
      </div>

      <!-- TRUST BAR -->
      <div class="trust-bar" id="trustBanner">
        <div class="trust-left">
          <div class="trust-dot" id="trustDot"></div>
          <div class="trust-text" id="trustText">ãƒ‡ãƒ¼ã‚¿ç¢ºèªä¸­...</div>
        </div>
        <div class="trust-badges">
          <span class="tbadge">yfinance / æ±è¨¼</span>
          <span class="tbadge">æ±è¨¼ãƒ—ãƒ©ã‚¤ãƒ å…¨éŠ˜æŸ„</span>
          <span class="tbadge link" onclick="openLogicModal()">ã‚¹ã‚³ã‚¢è¨ˆç®—å¼ â–¶</span>
        </div>
      </div>

      <!-- DIFF BAR -->
      <div class="diff-bar" id="diffBar" style="display:none">
        <span class="diff-label">å‰å›ã¨ã®å¤‰åŒ–ï¼š</span>
        <div id="diffItems" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;"></div>
      </div>

      <!-- STANCE (åœ°åˆã„åˆ¤å®š) -->
      <div id="stanceBox"></div>

      <!-- MODE & SCAN -->
      <div class="mode-wrap">
        <div class="sec-label">ã‚¹ã‚­ãƒ£ãƒ³ãƒ¢ãƒ¼ãƒ‰</div>
        <div class="mode-tabs">
          <div class="mode-tab active" id="mode-dividend" onclick="setMode('dividend',this)">
            <div class="mode-ico">ğŸ’°</div>
            <div class="mode-t">å®‰å®šé«˜é…å½“</div>
          </div>
          <div class="mode-tab" id="mode-value" onclick="setMode('value',this)">
            <div class="mode-ico">ğŸ›¡ï¸</div>
            <div class="mode-t">å‰²å®‰ãƒãƒªãƒ¥ãƒ¼</div>
          </div>
          <div class="mode-tab" id="mode-rebound" onclick="setMode('rebound',this)">
            <div class="mode-ico">âš¡</div>
            <div class="mode-t">å¼·æŠ¼ã—ç›®</div>
          </div>
        </div>
      </div>

      <button class="btn-scan" id="scanBtn" onclick="startScan()">ğŸ” è³ªå•ã«ç­”ãˆã¦ã‚¹ã‚­ãƒ£ãƒ³</button>

      <!-- SCAN ANIMATION -->
      <div class="scan-anim" id="scanAnim">
        <div class="scan-anim-steps" id="scanSteps"></div>
      </div>

      <!-- RANKINGS -->
      <div class="rankings" id="rankings"></div>

      <!-- EVENTS -->
      <div class="events">
        <div class="sec-head">ğŸ“° ä»Šæ—¥ã®ç›¸å ´ã‚¤ãƒ™ãƒ³ãƒˆ</div>
        <div class="event-list" id="eventList"></div>
      </div>

      <div class="disclaimer">âš ï¸ æœ¬ãƒ„ãƒ¼ãƒ«ã¯å‚è€ƒæƒ…å ±ã®æä¾›ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã®æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ã§è¡Œã£ã¦ãã ã•ã„ã€‚æ ªå¼æŠ•è³‡ã«ã¯å…ƒæœ¬å‰²ã‚Œã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚</div>

    </div><!-- /panel-home -->

    <!-- WATCH PANEL -->
    <div class="panel" id="panel-watch">
      <div style="margin-bottom:16px">
        <div class="sec-head">â­ ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆ</div>
        <div id="watchlistBody"></div>
      </div>
      <div>
        <div class="sec-head">ğŸ• ã‚¹ã‚­ãƒ£ãƒ³å±¥æ­´</div>
        <div id="historyBody"></div>
      </div>
    </div>

  </div><!-- /col-left -->

  <!-- RIGHT COLUMN (sticky card) -->
  <div class="col-right">
    <div class="card-wrap">
      <div class="card-header">
        <div class="card-label">è©³ç´°ã‚«ãƒ¼ãƒ‰</div>
        <div class="card-nav">
          <span class="card-counter" id="cardCounter">â€”</span>
          <button class="card-arr" id="cardPrev" onclick="cardMove(-1)">â—€</button>
          <button class="card-arr" id="cardNext" onclick="cardMove(1)">â–¶</button>
        </div>
      </div>
      <div id="cardArea">
        <div class="loader"><div class="spin"></div><div class="loader-text">ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã¨ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div></div>
      </div>
    </div>
  </div>

</div><!-- /page -->

<!-- MOBILE BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="nav-item active" id="nav-home" onclick="switchTab('home')">
    <span class="nav-ico">ğŸ </span><span class="nav-label">ãƒ›ãƒ¼ãƒ </span>
  </button>
  <button class="nav-item" id="nav-watch" onclick="switchTab('watch')">
    <span class="nav-ico">â­</span><span class="nav-label">ã‚¦ã‚©ãƒƒãƒ</span>
  </button>
</nav>

<!-- QUIZ -->
<div class="quiz-overlay" id="quizOverlay" onclick="closeQuizBg(event)">
  <div class="quiz-box">
    <div class="quiz-handle"></div>
    <div class="quiz-step" id="qzStep">STEP 1 / 3</div>
    <div class="quiz-bar" id="qzBar"></div>
    <div class="quiz-q" id="qzQ"></div>
    <div class="quiz-hint" id="qzHint"></div>
    <div id="qzRecommend"></div>
    <div class="quiz-opts" id="qzOpts"></div>
    <div class="quiz-nav">
      <button class="btn-qback" id="qzBack" onclick="quizBack()">â—€ æˆ»ã‚‹</button>
      <button class="btn-qnext" id="qzNext" onclick="quizNext()" disabled>æ¬¡ã¸ â–¶</button>
    </div>
  </div>
</div>

<!-- LOGIC MODAL -->
<div class="logic-overlay" id="logicModal" onclick="closeLogicModal(event)">
  <div class="logic-box">
    <div class="modal-handle"></div>
    <button class="modal-close" onclick="closeLogicModal()">âœ•</button>
    <div class="logic-title">ã‹ã¶ã®ã™ã‘ ã‚¹ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯</div>
    <div class="logic-sub">ã‚¹ã‚³ã‚¢ã¯ä»¥ä¸‹ã®5æŒ‡æ¨™ã‚’100ç‚¹æº€ç‚¹ã§åˆè¨ˆã—ã¾ã™ã€‚ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦å„æŒ‡æ¨™ã®é‡ã¿ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚</div>
    <table class="logic-tbl">
      <tr><th>æŒ‡æ¨™</th><th>æ¡ä»¶</th><th style="text-align:right">åŸºæœ¬ç‚¹</th></tr>
      <tr><td>é…å½“åˆ©å›ã‚Š</td><td>5%ä»¥ä¸Š/4.5%/4%/3.5%/3%/2.5%</td><td class="pts">æœ€å¤§30pt</td></tr>
      <tr><td>25MAä¹–é›¢</td><td>-8%ä»¥ä¸‹/-6%/-4%/-2%</td><td class="pts">æœ€å¤§28pt</td></tr>
      <tr><td>RSI</td><td>28ä»¥ä¸‹/32/38/42</td><td class="pts">æœ€å¤§22pt</td></tr>
      <tr><td>PBR</td><td>0.7å€ä»¥ä¸‹/0.9/1.1/1.5</td><td class="pts">æœ€å¤§18pt</td></tr>
      <tr><td>PER</td><td>9å€ä»¥ä¸‹/11/13/15</td><td class="pts">æœ€å¤§12pt</td></tr>
      <tr><td>âš  ãƒšãƒŠãƒ«ãƒ†ã‚£</td><td>å‡ºæ¥é«˜ãŒç›´è¿‘20æ—¥å¹³å‡ã®1.5å€è¶…</td><td class="pts" style="color:var(--up)">-20pt</td></tr>
    </table>
    <div class="logic-note">
      <strong>ãƒ¢ãƒ¼ãƒ‰åˆ¥ãƒœãƒ¼ãƒŠã‚¹ï¼š</strong><br>
      ğŸ’° å®‰å®šé«˜é…å½“ãƒ¢ãƒ¼ãƒ‰ â†’ é…å½“åˆ©å›ã‚Šã®ç‚¹æ•°ãŒæœ€å¤§1.4å€<br>
      ğŸ›¡ï¸ å‰²å®‰ãƒãƒªãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ â†’ PBRãƒ»PERã®ç‚¹æ•°ãŒæœ€å¤§1.6å€<br>
      âš¡ å¼·æŠ¼ã—ç›®ãƒ¢ãƒ¼ãƒ‰ â†’ MAä¹–é›¢ãƒ»RSIã®ç‚¹æ•°ãŒæœ€å¤§1.5å€
    </div>
    <div style="font-size:11px;color:var(--text3);margin-bottom:16px;line-height:1.8">
      ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ï¼šYahoo Finance (yfinance) çµŒç”±ã§æ±è¨¼ä¸Šå ´éŠ˜æŸ„ã®æ ªä¾¡ãƒ»è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã€‚<br>
      æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼šæ¯æœ8:30 / å‰å ´å¼•ã‘å¾Œ12:30 ã®1æ—¥2å›è‡ªå‹•æ›´æ–°ã€‚
    </div>
    <button class="btn-logic-close" onclick="closeLogicModal()">é–‰ã˜ã‚‹</button>
  </div>
</div>

<script>
// ===== DATA =====
const STOCKS=[
  {code:'8306',name:'ä¸‰è±UFJãƒ•ã‚£ãƒŠãƒ³ã‚·ãƒ£ãƒ«',sector:'éŠ€è¡Œ',price:1423,ma25:1520,ma75:1580,rsi:32,dividend:3.8,pbr:0.7,per:9.2,vol_r:0.8},
  {code:'9432',name:'NTT',sector:'é€šä¿¡',price:163,ma25:168,ma75:172,rsi:38,dividend:3.2,pbr:1.1,per:11.5,vol_r:0.9},
  {code:'8058',name:'ä¸‰è±å•†äº‹',sector:'å•†ç¤¾',price:2890,ma25:3050,ma75:3200,rsi:29,dividend:4.1,pbr:0.9,per:8.7,vol_r:0.7},
  {code:'4502',name:'æ­¦ç”°è–¬å“å·¥æ¥­',sector:'åŒ»è–¬å“',price:3820,ma25:3960,ma75:4050,rsi:41,dividend:5.6,pbr:1.3,per:15.2,vol_r:1.1},
  {code:'8001',name:'ä¼Šè—¤å¿ å•†äº‹',sector:'å•†ç¤¾',price:6780,ma25:7050,ma75:7200,rsi:33,dividend:3.5,pbr:1.8,per:12.3,vol_r:0.6},
  {code:'7203',name:'ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š',sector:'è‡ªå‹•è»Š',price:2650,ma25:2720,ma75:2800,rsi:36,dividend:3.0,pbr:1.1,per:10.4,vol_r:0.9},
  {code:'8316',name:'ä¸‰äº•ä½å‹FG',sector:'éŠ€è¡Œ',price:7100,ma25:7600,ma75:7800,rsi:28,dividend:4.2,pbr:0.8,per:9.0,vol_r:0.7},
  {code:'2914',name:'JTï¼ˆæ—¥æœ¬ãŸã°ã“ç”£æ¥­ï¼‰',sector:'é£Ÿå“',price:3680,ma25:3780,ma75:3820,rsi:35,dividend:6.2,pbr:1.6,per:13.8,vol_r:0.8},
  {code:'9020',name:'JRæ±æ—¥æœ¬',sector:'é‰„é“',price:8150,ma25:8300,ma75:8450,rsi:42,dividend:2.1,pbr:1.4,per:14.2,vol_r:0.9},
  {code:'8411',name:'ã¿ãšã»FG',sector:'éŠ€è¡Œ',price:2680,ma25:2850,ma75:2950,rsi:31,dividend:3.9,pbr:0.7,per:8.5,vol_r:0.8},
  {code:'9433',name:'KDDI',sector:'é€šä¿¡',price:4350,ma25:4500,ma75:4600,rsi:37,dividend:3.3,pbr:1.9,per:13.5,vol_r:1.0},
  {code:'5108',name:'ãƒ–ãƒªãƒ‚ã‚¹ãƒˆãƒ³',sector:'ã‚´ãƒ ',price:5100,ma25:5280,ma75:5350,rsi:40,dividend:3.8,pbr:1.2,per:11.8,vol_r:0.8},
  {code:'7267',name:'æœ¬ç”°æŠ€ç ”å·¥æ¥­',sector:'è‡ªå‹•è»Š',price:1380,ma25:1480,ma75:1550,rsi:29,dividend:4.2,pbr:0.65,per:7.8,vol_r:0.9},
  {code:'8766',name:'æ±äº¬æµ·ä¸ŠHD',sector:'ä¿é™º',price:4820,ma25:5100,ma75:5200,rsi:34,dividend:3.1,pbr:1.8,per:12.1,vol_r:0.7},
  {code:'6098',name:'ãƒªã‚¯ãƒ«ãƒ¼ãƒˆHD',sector:'ã‚µãƒ¼ãƒ“ã‚¹',price:8900,ma25:9200,ma75:9500,rsi:38,dividend:1.2,pbr:4.2,per:28.5,vol_r:1.1},
  {code:'4063',name:'ä¿¡è¶ŠåŒ–å­¦å·¥æ¥­',sector:'åŒ–å­¦',price:4200,ma25:4450,ma75:4600,rsi:35,dividend:2.8,pbr:2.1,per:15.3,vol_r:0.8},
  {code:'9984',name:'ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯G',sector:'é€šä¿¡',price:8750,ma25:9100,ma75:9400,rsi:40,dividend:0.8,pbr:1.3,per:18.2,vol_r:1.3},
  {code:'6861',name:'ã‚­ãƒ¼ã‚¨ãƒ³ã‚¹',sector:'é›»æ©Ÿ',price:62000,ma25:64000,ma75:66000,rsi:36,dividend:0.6,pbr:5.8,per:32.1,vol_r:0.6},
  {code:'7751',name:'ã‚­ãƒ¤ãƒãƒ³',sector:'é›»æ©Ÿ',price:3850,ma25:4050,ma75:4150,rsi:33,dividend:3.5,pbr:1.4,per:13.8,vol_r:0.8},
  {code:'8035',name:'æ±äº¬ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒ³',sector:'é›»æ©Ÿ',price:18500,ma25:19800,ma75:20500,rsi:31,dividend:2.4,pbr:4.1,per:22.4,vol_r:0.9},
  {code:'4661',name:'ã‚ªãƒªã‚¨ãƒ³ã‚¿ãƒ«ãƒ©ãƒ³ãƒ‰',sector:'ãƒ¬ã‚¸ãƒ£ãƒ¼',price:3200,ma25:3400,ma75:3600,rsi:35,dividend:0.4,pbr:6.2,per:45.0,vol_r:0.7},
  {code:'9983',name:'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒªãƒ†ã‚¤ãƒªãƒ³ã‚°',sector:'å°å£²',price:44000,ma25:46000,ma75:48000,rsi:37,dividend:1.1,pbr:8.5,per:35.2,vol_r:0.8},
  {code:'6367',name:'ãƒ€ã‚¤ã‚­ãƒ³å·¥æ¥­',sector:'æ©Ÿæ¢°',price:18200,ma25:19500,ma75:20200,rsi:34,dividend:1.2,pbr:3.8,per:24.5,vol_r:0.7},
  {code:'3382',name:'ã‚»ãƒ–ãƒ³ï¼†ã‚¢ã‚¤HD',sector:'å°å£²',price:1890,ma25:2050,ma75:2150,rsi:36,dividend:3.2,pbr:1.1,per:14.8,vol_r:0.9},
  {code:'8802',name:'ä¸‰è±åœ°æ‰€',sector:'ä¸å‹•ç”£',price:1920,ma25:2050,ma75:2150,rsi:33,dividend:2.8,pbr:1.2,per:16.5,vol_r:0.8},
  {code:'5401',name:'æ—¥æœ¬è£½é‰„',sector:'é‰„é‹¼',price:2850,ma25:3100,ma75:3250,rsi:30,dividend:4.8,pbr:0.75,per:8.2,vol_r:0.9},
];

let currentMode='dividend';
let processed=[];
let cardIndex=0;
let watchlist=[];
let scanHistory=[];
let lastScanCounts={buy:0,watch:0,total:0};
let dataSource='sample';

// å¸‚å ´ãƒ‡ãƒ¼ã‚¿ï¼ˆstocks_data.json ã‹ã‚‰å–å¾—ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
let marketData={
  nikkei_price:38240,
  nikkei_ma25:38800,      // æ—¥çµŒ25MA
  nikkei_1d_chg:-0.81,    // å‰æ—¥æ¯”%
  nasdaq_1d_chg:-0.3,     // NASDAQå‰æ—¥æ¯”%
  vix:18.4,               // ææ€–æŒ‡æ•°
  usdjpy:149.82,          // ãƒ‰ãƒ«å††
  us10y:4.28,             // ç±³10å¹´å‚µåˆ©å›ã‚Š
  geo_risk:false,         // åœ°æ”¿å­¦ãƒªã‚¹ã‚¯ãƒ•ãƒ©ã‚°
  rate_cut_flag:false,    // ç±³åˆ©ä¸‹ã’æœŸå¾…ãƒ•ãƒ©ã‚°
  prev_buy_count:null,    // å‰æ—¥ã®è²·ã„åœä»¶æ•°ï¼ˆnullãªã‚‰å‰æ—¥ãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰
  prev_top_score:null,    // å‰æ—¥ã®1ä½ã‚¹ã‚³ã‚¢
};

try{watchlist=JSON.parse(localStorage.getItem('kbs_watch')||'[]');}catch(e){}
try{scanHistory=JSON.parse(localStorage.getItem('kbs_history')||'[]');}catch(e){}

// ===== SCORING =====
function dv(p,m){return+((p-m)/m*100).toFixed(1);}
function calcScore(s,mode){
  let score=0,bd=[];
  const d25=dv(s.price,s.ma25);
  let dp=s.dividend>=5?30:s.dividend>=4.5?25:s.dividend>=4?20:s.dividend>=3.5?15:s.dividend>=3?10:s.dividend>=2.5?5:0;
  if(mode==='dividend')dp=Math.min(Math.round(dp*1.4),40);
  if(dp>0){bd.push({l:'é…å½“åˆ©å›ã‚Š',v:dp,max:40,pos:true});score+=dp;}
  let mp=d25<=-8?28:d25<=-6?22:d25<=-4?12:d25<=-2?5:0;
  if(mode==='rebound')mp=Math.min(Math.round(mp*1.5),35);
  if(mp>0){bd.push({l:'ä¸‹è½å¹…',v:mp,max:35,pos:true});score+=mp;}
  let rp=s.rsi<=28?22:s.rsi<=32?16:s.rsi<=38?10:s.rsi<=42?5:0;
  if(mode==='rebound')rp=Math.min(Math.round(rp*1.3),25);
  if(rp>0){bd.push({l:'å£²ã‚‰ã‚Œã™ã',v:rp,max:25,pos:true});score+=rp;}
  let pp=s.pbr<=0.7?18:s.pbr<=0.9?13:s.pbr<=1.1?7:s.pbr<=1.5?3:0;
  if(mode==='value')pp=Math.min(Math.round(pp*1.6),25);
  if(pp>0){bd.push({l:'PBRå‰²å®‰',v:pp,max:25,pos:true});score+=pp;}
  let ep=s.per<=9?12:s.per<=11?8:s.per<=13?5:s.per<=15?2:0;
  if(mode==='value')ep=Math.min(Math.round(ep*1.4),15);
  if(ep>0){bd.push({l:'PERå‰²å®‰',v:ep,max:15,pos:true});score+=ep;}
  if(s.vol_r>=1.5){score-=20;bd.push({l:'å‡ºæ¥é«˜æ€¥å¢—',v:-20,max:20,pos:false});}
  return{score:Math.max(0,Math.min(score,100)),bd};
}
function getZone(sc){
  if(sc>=60)return{label:'è²·ã„åœ',cls:'buy'};
  if(sc>=35)return{label:'æ³¨æ„åœ',cls:'watch'};
  return{label:'å¾…æ©Ÿåœ',cls:'hold'};
}
function genComment(s,d25){
  const p=[];
  if(d25<=-6)p.push(`25MAã‹ã‚‰<strong>${d25}%</strong>ä¸‹è½`);
  else if(d25<=-3)p.push(`25MAã‹ã‚‰<strong>${d25}%</strong>ã®æŠ¼ã—ç›®`);
  if(s.rsi<=30)p.push(`RSI <strong>${s.rsi}</strong>ã§å¼·ã„å£²ã‚‰ã‚Œã™ã`);
  else if(s.rsi<=38)p.push(`RSI <strong>${s.rsi}</strong>ã§åè»¢åœ`);
  if(s.dividend>=4.5)p.push(`é…å½“<strong>${s.dividend}%</strong>ã¨é«˜æ°´æº–`);
  else if(s.dividend>=3)p.push(`é…å½“<strong>${s.dividend}%</strong>ã§ä¸‹å€¤ã‚µãƒãƒ¼ãƒˆ`);
  if(s.pbr<=0.8)p.push(`PBR <strong>${s.pbr}å€</strong>ã®å‰²å®‰åœ`);
  return(p.join('ã€‚')+'ã€‚');
}

// ===== PROCESS =====
function processStocks(){
  const f={dividend:s=>s.dividend>=3.0,value:s=>s.pbr<=1.5&&s.per<=15,rebound:s=>dv(s.price,s.ma25)<=-3&&s.rsi<=42};
  processed=STOCKS.filter(f[currentMode]||(()=>true)).map(s=>{
    const d25=dv(s.price,s.ma25),d75=dv(s.price,s.ma75);
    const{score,bd}=calcScore(s,currentMode);
    return{...s,d25,d75,score,bd,zone:getZone(score),comment:genComment(s,d25)};
  }).sort((a,b)=>b.score-a.score);
  const now=new Date();
  const e={
    date:`${now.getMonth()+1}/${now.getDate()} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`,
    mode:currentMode,count:processed.length,
    top:processed[0]?.name||'â€”',topScore:processed[0]?.score||0
  };
  scanHistory.unshift(e);scanHistory=scanHistory.slice(0,14);
  try{localStorage.setItem('kbs_history',JSON.stringify(scanHistory));}catch(err){}
}

// ===== SCAN WITH ANIMATION =====
function startScan(){
  document.getElementById('quizOverlay').classList.add('open');
  qStep=0;qAnswers={};renderQuiz();
}

function runWithAnimation(){
  const btn=document.getElementById('scanBtn');
  const anim=document.getElementById('scanAnim');
  btn.disabled=true;
  anim.classList.add('show');

  const steps=[
    {text:'åœ°åˆã„ã‚’åˆ†æä¸­...'},
    {text:'æ±è¨¼ãƒ—ãƒ©ã‚¤ãƒ å…¨éŠ˜æŸ„ã‚¹ã‚­ãƒ£ãƒ³ä¸­...'},
    {text:'æŠ¼ã—ç›®å€™è£œã‚’æŠ½å‡ºä¸­...'},
    {text:'ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åˆ¤å®šä¸­...'},
  ];

  const el=document.getElementById('scanSteps');
  el.innerHTML=steps.map((s,i)=>`
    <div class="scan-step" id="ss${i}">
      <div class="scan-step-dot"></div>
      <span>${s.text}</span>
    </div>`).join('');

  let i=0;
  function next(){
    if(i>0)document.getElementById('ss'+(i-1)).className='scan-step done';
    if(i<steps.length){
      document.getElementById('ss'+i).className='scan-step active';
      i++;
      setTimeout(next,480);
    } else {
      setTimeout(()=>{
        anim.classList.remove('show');
        btn.disabled=false;
        run();
      },300);
    }
  }
  next();
}

// ===== PULSE =====
function renderPulse(){
  const chips=[
    {l:'æ—¥çµŒå¹³å‡',v:'38,240',c:'-312',d:'dn'},
    {l:'TOPIX',v:'2,718',c:'-18',d:'dn'},
    {l:'ãƒ‰ãƒ«å††',v:'149.82',c:'+0.34',d:'up'},
    {l:'VIX',v:'18.4',c:'+1.2',d:'neutral'},
    {l:'10å¹´å‚µ',v:'1.08%',c:'+0.02',d:'neutral'},
    {l:'å£²è²·ä»£é‡‘',v:'3.8å…†',c:'-0.4å…†',d:'dn'},
  ];
  document.getElementById('pulseBar').innerHTML=chips.map(c=>`
    <div class="pc">
      <div class="pc-l">${c.l}</div>
      <div class="pc-v ${c.d}">${c.v}</div>
      <div class="pc-c ${c.d}">${c.c}</div>
    </div>`).join('');
}

// ===== STANCE AUTO-JUDGEMENT: 3è»¸ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚° =====
// è»¸â‘  ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«: æ—¥æœ¬å¸‚å ´ã®æ•°å­—
// è»¸â‘¡ ãƒã‚¯ãƒ­: ç±³å›½ãƒ»ä¸–ç•Œãƒªã‚¹ã‚¯
// è»¸â‘¢ ã‚¹ã‚­ãƒ£ãƒ³: ãƒ„ãƒ¼ãƒ«å›ºæœ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆå¸¸ã«ä½¿ç”¨ï¼‰
// å„è»¸ 0ã€œ3ç‚¹ã€‚åˆè¨ˆ 7ç‚¹ä»¥ä¸Š=å¼·æ°—ã€4ã€œ6ç‚¹=ä¸­ç«‹ã€3ç‚¹ä»¥ä¸‹=å¼±æ°—
function calcStanceScore(){
  const md=marketData;
  const axes={};
  const evidence=[];

  // â”€â”€ è»¸â‘  ãƒ†ã‚¯ãƒ‹ã‚«ãƒ« (0ã€œ3pt) â”€â”€
  let t=0;
  const nikkeiAboveMA=(md.nikkei_price&&md.nikkei_ma25)?(md.nikkei_price>=md.nikkei_ma25):null;
  const nikkeiChg=md.nikkei_1d_chg||0;
  if(nikkeiAboveMA===true) t++;
  if(nikkeiAboveMA===false) t--;
  if(nikkeiChg>-1) t++; else if(nikkeiChg<-1.5) t--;
  if(md.vix<20) t++; else if(md.vix>25) t--;
  if(md.usdjpy>=147) t++; // å††å®‰=è¼¸å‡ºæ ªã«è¿½ã„é¢¨
  else if(md.usdjpy<140) t--; // æ€¥æ¿€ãªå††é«˜ã¯ãƒªã‚¹ã‚¯
  axes.tech=Math.max(0,Math.min(t,3));
  if(nikkeiChg<-1.5) evidence.push({label:'æ—¥çµŒ',val:nikkeiChg+'%',neg:true});
  else if(nikkeiChg>0) evidence.push({label:'æ—¥çµŒ',val:'+'+nikkeiChg+'%',neg:false});
  if(md.vix) evidence.push({label:'VIX',val:String(md.vix),neg:md.vix>22});
  if(md.usdjpy) evidence.push({label:'ãƒ‰ãƒ«å††',val:md.usdjpy+'å††',neg:md.usdjpy<142});

  // â”€â”€ è»¸â‘¡ ãƒã‚¯ãƒ­ (0ã€œ3pt) â”€â”€
  let m=1; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä¸­ç«‹ã‹ã‚‰
  const nasdaqChg=md.nasdaq_1d_chg||0;
  if(nasdaqChg>0.5) m++; else if(nasdaqChg<-1.5) m-=2;
  else if(nasdaqChg<0) m--;
  const us10y=md.us10y||4.2;
  if(us10y>=3.5&&us10y<=4.5) m++; // å®‰å®šåœ
  else if(us10y>5.0) m--; // é«˜ã™ãã‚‹=æ ªã«é‡è·
  if(md.geo_risk) m-=2; // åœ°æ”¿å­¦ãƒªã‚¹ã‚¯ã¯å¤§ãããƒã‚¤ãƒŠã‚¹
  if(md.rate_cut_flag) m++; // åˆ©ä¸‹ã’æœŸå¾…ã¯ãƒ—ãƒ©ã‚¹
  axes.macro=Math.max(0,Math.min(m,3));
  if(nasdaqChg) evidence.push({label:'NASDAQ',val:(nasdaqChg>0?'+':'')+nasdaqChg+'%',neg:nasdaqChg<0});
  if(md.geo_risk) evidence.push({label:'åœ°æ”¿å­¦',val:'ãƒªã‚¹ã‚¯ã‚ã‚Š',neg:true});
  if(us10y) evidence.push({label:'ç±³10å¹´å‚µ',val:us10y+'%',neg:us10y>5});

  // â”€â”€ è»¸â‘¢ ã‚¹ã‚­ãƒ£ãƒ³çµæœ (0ã€œ3pt) â”€â”€
  const buyN=processed.filter(s=>s.zone.cls==='buy').length;
  const avgRsi=processed.length?(processed.reduce((a,s)=>a+s.rsi,0)/processed.length):50;
  const avgD25=processed.length?(processed.reduce((a,s)=>a+s.d25,0)/processed.length):0;
  let sc=0;
  if(buyN>=5) sc+=2; else if(buyN>=3) sc+=1;
  if(avgRsi<=35) sc++; else if(avgRsi<=42) sc+=0.5;
  if(avgD25<=-4) sc++;
  // å‰æ—¥æ¯”ã§è²·ã„åœãŒå¢—ãˆã¦ã„ã‚Œã°ãƒ—ãƒ©ã‚¹
  if(md.prev_buy_count!==null&&buyN>md.prev_buy_count) sc++;
  axes.scan=Math.max(0,Math.min(Math.round(sc),3));
  evidence.push({label:'è²·ã„åœ',val:buyN+'éŠ˜æŸ„',neg:buyN<3});
  evidence.push({label:'å¹³å‡RSI',val:avgRsi.toFixed(1),neg:avgRsi>45});
  evidence.push({label:'MAä¹–é›¢',val:avgD25.toFixed(1)+'%',neg:avgD25>-2});

  const total=axes.tech+axes.macro+axes.scan;
  return{total,axes,evidence,
    buyN,watchN:processed.filter(s=>s.zone.cls==='watch').length,
    avgRsi:avgRsi.toFixed(1),avgD25:avgD25.toFixed(1),
    highDiv:processed.filter(s=>s.dividend>=4).length};
}

function renderStance(){
  const{total,axes,evidence,buyN,watchN,avgRsi,avgD25,highDiv}=calcStanceScore();
  const now=new Date();
  const days=['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
  const modeNames={dividend:'å®‰å®šé«˜é…å½“',value:'å‰²å®‰ãƒãƒªãƒ¥ãƒ¼',rebound:'å¼·æŠ¼ã—ç›®'};
  const md=marketData;
  const hasMacroData=(md.nikkei_price!==38240||dataSource==='real');

  let stance,icon,label,title,reason;
  if(total>=7){
    stance='bull';icon='ğŸŸ¢';label='å¼·æ°— â€” ç©æ¥µçš„ã«ä»•è¾¼ã‚ã‚‹æ—¥';
    title='ä»Šæ—¥ã¯è²·ã„ã‚„ã™ã„åœ°åˆã„';
    reason=hasMacroData
      ?`3è»¸ã‚¹ã‚³ã‚¢<strong>${total}/9ç‚¹</strong>ã§å¼·æ°—åœã€‚æ—¥çµŒ${md.nikkei_1d_chg>0?'+':''}${md.nikkei_1d_chg}%ãƒ»NASDAQ${md.nasdaq_1d_chg>0?'+':''}${md.nasdaq_1d_chg}%ã¨å¤–éƒ¨ç’°å¢ƒã‚‚å®‰å®šã€‚ã‚¹ã‚­ãƒ£ãƒ³å¯¾è±¡ã®è²·ã„åœã¯<strong>${buyN}éŠ˜æŸ„</strong>ã€å¹³å‡RSI<strong>${avgRsi}</strong>ã§å£²ã‚‰ã‚Œã™ãæ°´æº–ã€‚é…å½“4%è¶…ãŒ<strong>${highDiv}ä»¶</strong>ã€‚é•·æœŸä¿æœ‰ã‚’å‰æã«ç©æ¥µçš„ã«æ¤œè¨ã§ãã‚‹å±€é¢ã§ã™ã€‚`
      :`ã‚¹ã‚­ãƒ£ãƒ³çµæœã‹ã‚‰è‡ªå‹•åˆ¤å®šã€‚è²·ã„åœ<strong>${buyN}éŠ˜æŸ„</strong>ã€å¹³å‡RSI<strong>${avgRsi}</strong>ã€å¹³å‡25MAä¹–é›¢<strong>${avgD25}%</strong>ã€‚æ•°å€¤ãŒæƒã£ã¦ãŠã‚Šç©æ¥µçš„ã«æ¤œè¨ã§ãã‚‹å±€é¢ã§ã™ã€‚å®Ÿãƒ‡ãƒ¼ã‚¿é€£æºï¼ˆupdate.shï¼‰ã§æ—¥ç±³ãƒãƒ¼ã‚±ãƒƒãƒˆæƒ…å ±ã‚‚è‡ªå‹•åˆ¤å®šã«åŠ ã‚ã‚Šã¾ã™ã€‚`;
  } else if(total>=4){
    stance='neutral';icon='ğŸŸ¡';label='ä¸­ç«‹ â€” å³é¸ã—ã¦ä»•è¾¼ã‚€æ—¥';
    title='ä»Šæ—¥ã¯éŠ˜æŸ„ã‚’é¸ã¶æ—¥';
    reason=hasMacroData
      ?`3è»¸ã‚¹ã‚³ã‚¢<strong>${total}/9ç‚¹</strong>ã§ä¸­ç«‹åœã€‚è²·ã„åœã¯<strong>${buyN}éŠ˜æŸ„</strong>ã¨å¹³å‡çš„ã€‚å¤–éƒ¨ç’°å¢ƒï¼ˆNASDAQ${md.nasdaq_1d_chg>0?'+':''}${md.nasdaq_1d_chg}%ï¼‰ã«å¤§ããªå´©ã‚Œã¯ãªãã€ã‚¹ã‚³ã‚¢ä¸Šä½éŠ˜æŸ„ã«çµã‚Œã°ååˆ†ãªæŠ¼ã—ç›®æ°´æº–ãŒè¦‹ãˆã¾ã™ã€‚æ³¨æ„åœ<strong>${watchN}ä»¶</strong>ã‚‚å«ã‚æ…é‡ã«é¸åˆ¥ã‚’ã€‚`
      :`ã‚¹ã‚­ãƒ£ãƒ³çµæœã‹ã‚‰è‡ªå‹•åˆ¤å®šã€‚è²·ã„åœ<strong>${buyN}éŠ˜æŸ„</strong>ã€å¹³å‡RSI<strong>${avgRsi}</strong>ã€‚å…¨ä½“çš„ã«ã¯ã‚„ã‚„è»Ÿèª¿ã§ã™ãŒã€ã‚¹ã‚³ã‚¢60ç‚¹ä»¥ä¸Šã«çµã‚Œã°è²·ã„ã‚„ã™ã„éŠ˜æŸ„ãŒå­˜åœ¨ã—ã¾ã™ã€‚`;
  } else {
    stance='bear';icon='ğŸ”´';label='å¼±æ°— â€” æ§˜å­è¦‹ãŒç„¡é›£ãªæ—¥';
    title='ä»Šæ—¥ã¯ç„¡ç†ã—ã¦è²·ã‚ãªã„æ—¥';
    reason=hasMacroData
      ?`3è»¸ã‚¹ã‚³ã‚¢<strong>${total}/9ç‚¹</strong>ã§å¼±æ°—åœã€‚${md.nasdaq_1d_chg<-1?`NASDAQ${md.nasdaq_1d_chg}%ã¨ç±³å›½æ ªãŒè»Ÿèª¿ã€‚`:''}${md.geo_risk?'åœ°æ”¿å­¦ãƒªã‚¹ã‚¯ãŒæµ®ä¸Šã€‚':''}è²·ã„åœãŒã‚ãšã‹<strong>${buyN}éŠ˜æŸ„</strong>ã§ååˆ†ãªæŠ¼ã—ç›®ãŒå½¢æˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç¾é‡‘ã‚’æ¸©å­˜ã—ã¦æ¬¡ã®ä¸‹è½å±€é¢ã‚’å¾…ã¤ã®ãŒè³¢æ˜ã§ã™ã€‚`
      :`ã‚¹ã‚­ãƒ£ãƒ³çµæœã‹ã‚‰è‡ªå‹•åˆ¤å®šã€‚è²·ã„åœãŒ<strong>${buyN}éŠ˜æŸ„</strong>ã¨å°‘ãªãã€å¹³å‡25MAä¹–é›¢<strong>${avgD25}%</strong>ã¨æŠ¼ã—ç›®ãŒæµ…ã„ã€‚æ€¥ã„ã§ä»•è¾¼ã‚€å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`;
  }

  // è»¸ã‚¹ã‚³ã‚¢ãƒãƒ¼
  const axisBar=(name,score,icon)=>`
    <div class="axis-row">
      <div class="axis-name">${icon} ${name}</div>
      <div class="axis-bar">
        ${[0,1,2].map(i=>`<div class="axis-seg ${i<score?'on':''} ${score===0?'zero':score>=2?'hi':'mid'}"></div>`).join('')}
      </div>
      <div class="axis-score">${score}/3</div>
    </div>`;

  // æ ¹æ‹ ãƒãƒƒãƒ—
  const chips=[
    {label:'è²·ã„åœ',val:buyN+'éŠ˜æŸ„',cls:buyN>=5?'buy':buyN>=3?'warn':'hold'},
    {label:'å¹³å‡RSI',val:avgRsi,cls:parseFloat(avgRsi)<=35?'buy':parseFloat(avgRsi)<=45?'warn':'hold'},
    {label:'MAä¹–é›¢å¹³å‡',val:avgD25+'%',cls:parseFloat(avgD25)<=-4?'buy':parseFloat(avgD25)<=-2?'warn':'hold'},
    {label:'é«˜é…å½“4%è¶…',val:highDiv+'ä»¶',cls:highDiv>=3?'buy':highDiv>=1?'warn':'hold'},
  ];

  document.getElementById('stanceBox').innerHTML=`
    <div class="stance ${stance} fadein">
      <div class="stance-head">
        <div class="stance-date">${now.getFullYear()}å¹´${now.getMonth()+1}æœˆ${now.getDate()}æ—¥ï¼ˆ${days[now.getDay()]}ï¼‰Â· ${modeNames[currentMode]}ãƒ¢ãƒ¼ãƒ‰</div>
        <div class="stance-top">
          <div class="stance-title">${title}</div>
          <div class="stance-badge ${stance}">${icon} ${label}</div>
        </div>
      </div>
      <div class="stance-reason">${reason}</div>
      <div class="stance-axes">
        ${axisBar('ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ï¼ˆæ—¥æœ¬å¸‚å ´ï¼‰',axes.tech,'ğŸ“Š')}
        ${axisBar('ãƒã‚¯ãƒ­ï¼ˆç±³å›½ãƒ»ä¸–ç•Œï¼‰',axes.macro,'ğŸŒ')}
        ${axisBar('ã‚¹ã‚­ãƒ£ãƒ³çµæœ',axes.scan,'ğŸ”')}
        <div class="axis-total">ç·åˆã‚¹ã‚³ã‚¢ <strong>${total}</strong> / 9ç‚¹</div>
      </div>
      <div class="stance-data">
        ${chips.map(c=>`
          <div class="stance-chip ${c.cls}">
            <div class="stance-chip-val">${c.val}</div>
            <div class="stance-chip-label">${c.label}</div>
          </div>`).join('')}
      </div>
      ${!hasMacroData?'<div class="stance-note">ğŸ’¡ æ—¥ç±³ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’é€£æºã™ã‚‹ã¨ã€ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ãƒ»ãƒã‚¯ãƒ­è»¸ã‚‚è‡ªå‹•åˆ¤å®šã•ã‚Œã¾ã™ï¼ˆupdate.sh è¨­å®šå¾Œã«æœ‰åŠ¹ï¼‰</div>':''}
    </div>`;
}


// ===== HERO STATS =====
function renderHeroStats(){
  const buyN=processed.filter(s=>s.zone.cls==='buy').length;
  const topScore=processed.length?processed[0].score:'â€”';
  const maxDiv=processed.length?Math.max(...processed.map(s=>s.dividend)).toFixed(1)+'%':'â€”';
  document.getElementById('hsBuy').textContent=buyN+'ä»¶';
  document.getElementById('hsTop').textContent=topScore+'ç‚¹';
  document.getElementById('hsDiv').textContent=maxDiv;
  // eyebrow: real data indicator
  const eyebrow=document.getElementById('heroEyebrow');
  if(eyebrow&&dataSource==='real'){
    eyebrow.innerHTML='<span class="hero-dot"></span>ğŸ“¡ å®Ÿãƒ‡ãƒ¼ã‚¿èª­è¾¼æ¸ˆã¿ â€” æ¯æœ8:30ãƒ»å‰å ´å¾Œ12:30 è‡ªå‹•æ›´æ–°';
  }
}

// ===== DIFF BAR =====
function renderDiff(newBuy,newWatch,newTotal){
  const prev=lastScanCounts;
  const el=document.getElementById('diffBar');
  const items=document.getElementById('diffItems');
  el.style.display='flex';
  if(prev.total===0){
    items.innerHTML='<span class="diff-same">åˆå›ã‚¹ã‚­ãƒ£ãƒ³å®Œäº†</span>';
    lastScanCounts={buy:newBuy,watch:newWatch,total:newTotal};
    return;
  }
  const diffBuy=newBuy-prev.buy;
  const diffTotal=newTotal-prev.total;
  let h='';
  if(diffTotal!==0) h+='<span class="'+(diffTotal>0?'diff-new':'diff-gone')+'">'+(diffTotal>0?'â–²':'â–¼')+' å¯¾è±¡éŠ˜æŸ„ '+(diffTotal>0?'+':'')+diffTotal+'ä»¶</span>';
  if(diffBuy!==0) h+='<span class="diff-sep">|</span><span class="'+(diffBuy>0?'diff-new':'diff-gone')+'">'+(diffBuy>0?'â–²':'â–¼')+' è²·ã„åœ '+(diffBuy>0?'+':'')+diffBuy+'ä»¶</span>';
  items.innerHTML=h||'<span class="diff-same">å‰å›ã¨å¤‰åŒ–ãªã—</span>';
  lastScanCounts={buy:newBuy,watch:newWatch,total:newTotal};
}

// ===== RANKINGS =====
function renderRankings(){
  const top5div=[...processed].sort((a,b)=>b.dividend-a.dividend).slice(0,5);
  const top5sc=[...processed].sort((a,b)=>b.score-a.score).slice(0,5);
  const top5dev=[...processed].sort((a,b)=>a.d25-b.d25).slice(0,5);

  function rows(list,keyFn){
    return list.map((s,i)=>{
      const sc=s.score>=60?'hi':s.score>=35?'md':'lo';
      const{v,cls}=keyFn(s);
      return`<div class="rank-row" onclick="jumpToCard('${s.code}')">
        <div class="rank-num ${i<3?'top':''}">${i+1}</div>
        <div class="rank-info"><div class="rank-name">${s.name}</div><div class="rank-meta">${s.code} Â· ${s.sector}</div></div>
        <div class="rank-right"><div class="rank-score ${sc}">${s.score}</div><div class="rank-key ${cls}">${v}</div></div>
      </div>`;
    }).join('');
  }

  document.getElementById('rankings').innerHTML=`
    <div class="rank-block">
      <div class="rank-head"><div class="rank-head-title">ğŸ’° é«˜é…å½“ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP5</div></div>
      <div class="rank-rows">${rows(top5div,s=>({v:s.dividend+'%',cls:'w'}))}</div>
    </div>
    <div class="rank-block">
      <div class="rank-head"><div class="rank-head-title">ğŸ† ç·åˆã‚¹ã‚³ã‚¢ TOP5</div></div>
      <div class="rank-rows">${rows(top5sc,s=>({v:'score '+s.score,cls:'g'}))}</div>
    </div>
    <div class="rank-block">
      <div class="rank-head"><div class="rank-head-title">âš¡ æŠ¼ã—ç›®ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP5</div></div>
      <div class="rank-rows">${rows(top5dev,s=>({v:s.d25+'%',cls:'g'}))}</div>
    </div>`;
}

// ===== CARD =====
function renderCard(){
  if(!processed.length){
    document.getElementById('cardArea').innerHTML='<div class="loader"><div class="loader-text">æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹éŠ˜æŸ„ãŒã‚ã‚Šã¾ã›ã‚“</div></div>';
    return;
  }
  cardIndex=Math.max(0,Math.min(cardIndex,processed.length-1));
  const s=processed[cardIndex];
  document.getElementById('cardCounter').textContent=`${cardIndex+1} / ${processed.length}`;
  document.getElementById('cardPrev').disabled=cardIndex===0;
  document.getElementById('cardNext').disabled=cardIndex===processed.length-1;

  const isFav=watchlist.includes(s.code);
  const r=28;const circ=2*Math.PI*r;const fill=circ-(s.score/100)*circ;
  const col=s.score>=60?'var(--up)':s.score>=35?'var(--amber)':'var(--text3)';

  // â‘¢ è²·ã„ç†ç”±ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆå¼·åŒ–ç‰ˆï¼‰
  // å„æŒ‡æ¨™ã«ã€Œãªãœé‡è¦ã‹ã€ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä»˜åŠ 
  const reasons=[];
  if(s.d25<=-6){
    reasons.push({
      val:`${s.d25}%`,label:'25æ—¥ç§»å‹•å¹³å‡ã‹ã‚‰ã®ä¹–é›¢',
      note:'å¼·ã„æŠ¼ã—ç›®æ°´æº–',desc:'éå»ã®åç™ºå®Ÿç¸¾ã‹ã‚‰-6%ä»¥ä¸‹ã¯è²·ã„åœ§åŠ›ãŒé›†ã¾ã‚Šã‚„ã™ã„æ°´æº–',
      cls:'strong',rank:'A'
    });
  } else if(s.d25<=-3){
    reasons.push({
      val:`${s.d25}%`,label:'25æ—¥ç§»å‹•å¹³å‡ã‹ã‚‰ã®ä¹–é›¢',
      note:'æŠ¼ã—ç›®æ°´æº–',desc:'-3%ä»¥ä¸Šã®ä¸‹è½ã§ä¸­æœŸçš„ãªåç™ºå€™è£œã«å…¥ã£ã¦ãã‚‹',
      cls:'mid',rank:'B'
    });
  }
  if(s.rsi<=30){
    reasons.push({
      val:String(s.rsi),label:'RSIï¼ˆç›¸å¯¾åŠ›æŒ‡æ•°ï¼‰',
      note:'å¼·ã„å£²ã‚‰ã‚Œã™ã',desc:'30ä»¥ä¸‹ã¯éå»ã®åç™ºç‡ãŒé«˜ã„ã€‚çŸ­æœŸçš„ãªè‡ªå¾‹åç™ºã‚’æœŸå¾…ã§ãã‚‹æ°´æº–',
      cls:'strong',rank:'A'
    });
  } else if(s.rsi<=38){
    reasons.push({
      val:String(s.rsi),label:'RSIï¼ˆç›¸å¯¾åŠ›æŒ‡æ•°ï¼‰',
      note:'å£²ã‚‰ã‚Œã™ãåœå†…',desc:'38ä»¥ä¸‹ã¯å£²ã‚Šéå‰°ãŒå’Œã‚‰ãã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚ä¸­é•·æœŸç›®ç·šã§ã¯ä»•è¾¼ã¿ã‚„ã™ã„',
      cls:'mid',rank:'B'
    });
  }
  if(s.dividend>=4.5){
    reasons.push({
      val:`${s.dividend}%`,label:'é…å½“åˆ©å›ã‚Š',
      note:'é«˜é…å½“ãƒ»ä¸‹å€¤ã‚µãƒãƒ¼ãƒˆ',desc:'4.5%è¶…ã¯å®šæœŸé é‡‘ã®ç´„10å€ã€‚é…å½“ãŒæ ªä¾¡ã®ä¸‹å€¤ã‚’æ”¯ãˆã‚‹æ§‹é€ ',
      cls:'strong',rank:'A'
    });
  } else if(s.dividend>=3){
    reasons.push({
      val:`${s.dividend}%`,label:'é…å½“åˆ©å›ã‚Š',
      note:'ã‚¤ãƒ³ã‚«ãƒ æœŸå¾…',desc:'3%ä»¥ä¸Šã§å‚µåˆ¸ã‚ˆã‚Šæœ‰åˆ©ã€‚é•·æœŸä¿æœ‰ã®ãƒªã‚¹ã‚¯ä½æ¸›ã«åŠ¹ã',
      cls:'mid',rank:'B'
    });
  }
  if(s.pbr<=0.8){
    reasons.push({
      val:`${s.pbr}å€`,label:'PBRï¼ˆæ ªä¾¡ç´”è³‡ç”£å€ç‡ï¼‰',
      note:'è§£æ•£ä¾¡å€¤ä»¥ä¸‹',desc:'1å€å‰²ã‚Œã¯ç†è«–ä¸Šã€Œä»Šã™ãè§£æ•£ã—ã¦ã‚‚æ ªã‚ˆã‚Šå¤šãæˆ»ã‚‹ã€æ°´æº–ã€‚ä¸‹å€¤ãŒå›ºã„',
      cls:'strong',rank:'A'
    });
  } else if(s.pbr<=1.1){
    reasons.push({
      val:`${s.pbr}å€`,label:'PBRï¼ˆæ ªä¾¡ç´”è³‡ç”£å€ç‡ï¼‰',
      note:'å‰²å®‰åœ',desc:'1å€ä»˜è¿‘ã¯å‰²å®‰æ„ŸãŒã‚ã‚Šæ©Ÿé–¢æŠ•è³‡å®¶ãŒæ³¨ç›®ã™ã‚‹æ°´æº–',
      cls:'mid',rank:'B'
    });
  }
  if(s.per<=10){
    reasons.push({
      val:`${s.per}å€`,label:'PERï¼ˆæ ªä¾¡åç›Šç‡ï¼‰',
      note:'å‰²å®‰æ°´æº–',desc:'10å€ä»¥ä¸‹ã¯æ—¥æœ¬æ ªå¹³å‡ã‚’å¤§ããä¸‹å›ã‚‹ã€‚åˆ©ç›Šã«å¯¾ã—ã¦æ ªä¾¡ãŒå®‰ã„',
      cls:'mid',rank:'B'
    });
  }

  // â‘¦ å‰æ—¥æ¯”å¤‰åŒ–ï¼ˆã‚¹ã‚­ãƒ£ãƒ³å±¥æ­´ã¨æ¯”è¼ƒï¼‰
  const prevEntry=scanHistory.length>1?scanHistory[1]:null;
  const prevSameMode=prevEntry&&prevEntry.mode===currentMode;
  const prevScore=s.prev_score||null; // stocks_data.jsonã«å‰æ—¥ã‚¹ã‚³ã‚¢ãŒã‚ã‚Œã°

  const rankInAll=processed.findIndex(x=>x.code===s.code)+1;
  const gradeA=reasons.filter(r=>r.rank==='A').length;

  // ã‚µãƒãƒªãƒ¼å¼·åº¦åˆ¤å®š
  const strength=gradeA>=2?'strong':gradeA>=1?'mid':'weak';
  const strengthLabel=strength==='strong'?'è¤‡æ•°ã®å¼·ã„è²·ã„ã‚·ã‚°ãƒŠãƒ«':strength==='mid'?'æŠ¼ã—ç›®ã¨ã—ã¦å€™è£œåœå†…':'æ±ºã‚æ‰‹ã«æ¬ ã‘ã‚‹';

  const reasonsHtml=reasons.length?`
    <div class="why-block">
      <div class="why-header">
        <div class="why-title">ã“ã®éŠ˜æŸ„ãŒé¸ã°ã‚ŒãŸç†ç”±</div>
        <div class="why-strength ${strength}">${strengthLabel}</div>
      </div>
      <div class="why-items">
        ${reasons.map(w=>`
          <div class="why-item ${w.cls}">
            <div class="why-rank-badge ${w.cls}">${w.rank}</div>
            <div class="why-val">${w.val}</div>
            <div class="why-label">${w.label}</div>
            <div class="why-note-text">${w.note}</div>
            <div class="why-desc">${w.desc}</div>
          </div>`).join('')}
      </div>
    </div>`:'<div class="why-block why-empty"><div class="why-title">è²·ã„ã‚·ã‚°ãƒŠãƒ«ãªã—</div><div style="font-size:11px;color:var(--text3);margin-top:4px">ã“ã®éŠ˜æŸ„ã¯ç¾æ™‚ç‚¹ã§æ˜ç¢ºãªæŠ¼ã—ç›®æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“</div></div>';

  // â‘¦ å‰æ—¥æ¯”å¤‰åŒ–ãƒãƒƒã‚¸
  const changeBadge=prevScore!==null?`
    <div class="change-badge ${s.score>prevScore?'up':s.score<prevScore?'dn':'flat'}">
      ${s.score>prevScore?'â–²':'â–¼'} å‰æ—¥æ¯” ${s.score>prevScore?'+':''}${s.score-prevScore}ç‚¹
    </div>`:rankInAll<=3?`<div class="change-badge rank">ãƒ©ãƒ³ã‚­ãƒ³ã‚° ${rankInAll}ä½</div>`:'';

  const bdHtml=s.bd.map(item=>`
    <div class="bd-row">
      <div class="bd-l">${item.l}</div>
      <div class="bd-bar"><div class="bd-fill" style="width:${Math.min(Math.abs(item.v)/item.max*100,100)}%;background:${item.pos?'var(--green)':'var(--up)'}"></div></div>
      <div class="bd-v ${item.pos?'pos':'neg'}">${item.v>0?'+':''}${item.v}ç‚¹</div>
    </div>`).join('');

  document.getElementById('cardArea').innerHTML=`
    <div class="stock-card fadein">
      <div class="score-hero">
        <div class="score-ring">
          <svg width="72" height="72" viewBox="0 0 72 72">
            <circle cx="36" cy="36" r="${r}" fill="none" stroke="${col}" stroke-opacity="0.15" stroke-width="5"/>
            <circle cx="36" cy="36" r="${r}" fill="none" stroke="${col}" stroke-width="5"
              stroke-dasharray="${circ.toFixed(1)}" stroke-dashoffset="${fill.toFixed(1)}"
              stroke-linecap="round" style="transition:stroke-dashoffset 0.6s ease"/>
          </svg>
          <div class="score-ring-inner">
            <div class="score-ring-num" style="color:${col}">${s.score}</div>
            <div class="score-ring-lbl">SCORE</div>
          </div>
        </div>
        <div class="score-info">
          <div class="score-zone-row">
            <div class="score-zone ${s.zone.cls}">${s.zone.label}</div>
            ${changeBadge}
          </div>
          <div class="score-name">${s.name}</div>
          <div class="score-code">${s.code} Â· ${s.sector}</div>
        </div>
      </div>
      ${reasonsHtml}
      <table class="metrics">
        <tr><th>ç¾åœ¨å€¤</th><th>25MAæ¯”</th><th>RSI</th><th>é…å½“</th><th>PBR</th><th>PER</th></tr>
        <tr>
          <td class="val">Â¥${s.price.toLocaleString()}</td>
          <td class="val ${s.d25<0?'dn':'up'}">${s.d25>0?'+':''}${s.d25}%</td>
          <td class="val ${s.rsi<=30?'dn':s.rsi>=50?'up':''}">${s.rsi}</td>
          <td class="val w">${s.dividend}%</td>
          <td class="val ${s.pbr<=1?'dn':''}">${s.pbr}å€</td>
          <td class="val ${s.per<=13?'dn':''}">${s.per}å€</td>
        </tr>
        <tr>
          <td class="hint">â€”</td>
          <td class="hint">-5%ä»¥ä¸‹ãŒç›®å®‰</td>
          <td class="hint">30ä»¥ä¸‹ãŒç›®å®‰</td>
          <td class="hint">3%ä»¥ä¸ŠãŒé«˜é…å½“</td>
          <td class="hint">1ä»¥ä¸‹ãŒå‰²å®‰</td>
          <td class="hint">15ä»¥ä¸‹ãŒå‰²å®‰</td>
        </tr>
      </table>
      <div class="breakdown">
        <div class="breakdown-title">ã‚¹ã‚³ã‚¢å†…è¨³ï¼ˆ100ç‚¹æº€ç‚¹ï¼‰</div>
        ${bdHtml}
      </div>
      <div class="card-actions">
        <button class="btn-fav ${isFav?'active':''}" onclick="toggleFav('${s.code}')">
          ${isFav?'â˜… ç™»éŒ²æ¸ˆã¿':'â˜† ã‚¦ã‚©ãƒƒãƒç™»éŒ²'}
        </button>
      </div>
    </div>`;
  setupSwipe();
}

function cardMove(d){cardIndex=Math.max(0,Math.min(cardIndex+d,processed.length-1));renderCard();}
function jumpToCard(code){const i=processed.findIndex(s=>s.code===code);if(i>=0){cardIndex=i;renderCard();document.getElementById('cardArea').scrollIntoView({behavior:'smooth',block:'nearest'});}}
function setupSwipe(){
  const el=document.querySelector('.stock-card');if(!el)return;
  let sx=0,sy=0;
  el.addEventListener('touchstart',e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY;},{passive:true});
  el.addEventListener('touchend',e=>{
    const dx=e.changedTouches[0].clientX-sx,dy=e.changedTouches[0].clientY-sy;
    if(Math.abs(dx)>Math.abs(dy)&&Math.abs(dx)>40){
      if(dx<0&&cardIndex<processed.length-1){cardIndex++;renderCard();}
      if(dx>0&&cardIndex>0){cardIndex--;renderCard();}
    }
  },{passive:true});
}

// ===== EVENTS =====
function renderEvents(){
  const evs=[
    {ico:'ğŸ“‰',tag:{t:'bear',l:'ä¸‹è½'},title:'æ—¥çµŒå¹³å‡ âˆ’0.81%',desc:'2æ—¥é€£ç¶šã®ä¸‹è½ã€‚éŠ€è¡Œãƒ»å•†ç¤¾ä¸­å¿ƒã«å£²ã‚‰ã‚Œã€å‰²å®‰æ°´æº–ã«è¿‘ã¥ãéŠ˜æŸ„ãŒå¢—åŠ ã€‚'},
    {ico:'ğŸ’´',tag:{t:'bull',l:'è¿½ã„é¢¨'},title:'ãƒ‰ãƒ«å†† 149.82å††ï¼ˆå††å®‰æ–¹å‘ï¼‰',desc:'è¼¸å‡ºä¼æ¥­ï¼ˆè‡ªå‹•è»Šãƒ»å•†ç¤¾ï¼‰ã®æ¥­ç¸¾ã«ãƒ—ãƒ©ã‚¹ã€‚'},
    {ico:'ğŸ“Š',tag:{t:'neutral',l:'ä¸­ç«‹'},title:'æ±è¨¼ å£²è²·ä»£é‡‘ 3.8å…†å††',desc:'å‰æ—¥ã‚ˆã‚Šå°‘ãªã‚ã€‚æ€¥å¤‰ãƒªã‚¹ã‚¯ã¯ä½ã„é™ã‹ãªç›¸å ´ã€‚'},
    {ico:'ğŸ‡ºğŸ‡¸',tag:{t:'bull',l:'è¿½ã„é¢¨'},title:'ç±³NASDAQ å¼·å«ã¿',desc:'ä»Šå¤œã®ç±³å›½å¸‚å ´ãŒå¥½èª¿ãªã‚‰ã€æ˜æœã®æ—¥æœ¬æ ªã«ãƒ—ãƒ©ã‚¹ã®å¯èƒ½æ€§ã€‚'},
  ];
  document.getElementById('eventList').innerHTML=evs.map(e=>`
    <div class="event-row">
      <div class="ev-ico">${e.ico}</div>
      <div class="ev-body">
        <div class="ev-title"><span class="ev-tag ${e.tag.t}">${e.tag.l}</span>${e.title}</div>
        <div class="ev-desc">${e.desc}</div>
      </div>
    </div>`).join('');
}

// ===== QUIZ =====
const QUIZ=[
  {
    id:'goal',q:'æ ªã‚’ã‚„ã‚‹ä¸€ç•ªã®ç›®çš„ã¯ä½•ã§ã™ã‹ï¼Ÿ',
    hint:'ã‚ãªãŸã®ã‚´ãƒ¼ãƒ«ã«åˆã‚ã›ã¦ã‚¹ã‚³ã‚¢ã®é‡ã¿ä»˜ã‘ãŒè‡ªå‹•èª¿æ•´ã•ã‚Œã¾ã™ã€‚',
    recommend:{val:'dividend',reason:'ä»Šæ—¥ã®ç›¸å ´ã¯è»Ÿèª¿ã€‚é«˜é…å½“éŠ˜æŸ„ã¯ä¸‹å€¤ãŒé™å®šçš„ã§ã€åˆå¿ƒè€…ã«ã‚‚æ‰±ã„ã‚„ã™ã„å±€é¢ã§ã™ã€‚'},
    opts:[
      {ico:'ğŸ’°',t:'æ¯å¹´é…å½“é‡‘ã‚’ã‚‚ã‚‰ã„ãŸã„',d:'éŠ€è¡Œã‚ˆã‚Šé«˜ã„åˆ©å›ã‚Šã§ã€ã‚†ã£ãã‚Šè³‡ç”£ã‚’å¢—ã‚„ã—ãŸã„',v:'dividend',isRec:true},
      {ico:'ğŸ“ˆ',t:'å®‰ãè²·ã£ã¦å€¤ä¸ŠãŒã‚Šç›Šã‚’å–ã‚ŠãŸã„',d:'ä¸‹ãŒã£ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ä»•è¾¼ã¿ã€æˆ»ã£ãŸã‚‰å£²ã‚ŠãŸã„',v:'deviation',isRec:false},
      {ico:'ğŸ›¡ï¸',t:'ã¨ã«ã‹ãå‰²å®‰ãªå„ªè‰¯æ ªã‚’è²·ã„ãŸã„',d:'ãƒªã‚¹ã‚¯ã‚’æŠ‘ãˆã¦ãƒãƒªãƒ¥ãƒ¼æŠ•è³‡ã§é•·æœŸä¿æœ‰',v:'value',isRec:false},
      {ico:'âš–ï¸',t:'é…å½“ã‚‚å€¤ä¸ŠãŒã‚Šã‚‚ãƒãƒ©ãƒ³ã‚¹ã‚ˆã',d:'ã©ã‚Œã‹ã«åã‚‰ãšã€ç·åˆçš„ã«è‰¯ã„æ ªã‚’æ¢ã—ãŸã„',v:'balance',isRec:false},
    ]
  },
  {
    id:'market',q:'ä»Šã®ç›¸å ´ã‚’ã©ã†æ„Ÿã˜ã¦ã„ã¾ã™ã‹ï¼Ÿ',
    hint:'ç›¸å ´è¦³ã«ã‚ˆã£ã¦æ¡ä»¶ã®å³ã—ã•ãŒå¾®èª¿æ•´ã•ã‚Œã¾ã™ã€‚ç›´æ„Ÿã§OKã§ã™ã€‚',
    recommend:{val:'flat',reason:'ä»Šæ—¥ã®æ—¥çµŒã¯âˆ’0.81%ã¨å°å¹…ä¸‹è½ã€‚å¤§ããªæ–¹å‘æ„Ÿã¯å‡ºã¦ã„ãªã„ãŸã‚ã€Œæ§˜å­è¦‹ã€ãŒå®‰å…¨ãªåˆ¤æ–­ã§ã™ã€‚'},
    opts:[
      {ico:'ğŸ˜Š',t:'ã¾ã ä¸ŠãŒã‚Šãã†ã€ãƒãƒ£ãƒ³ã‚¹ã‚ã‚Š',d:'ç©æ¥µçš„ã«ä»•è¾¼ã‚“ã§ã„ããŸã„',v:'bull',isRec:false},
      {ico:'ğŸ˜°',t:'ä¸‹ãŒã‚Šãã†ã§å°‘ã—æ€–ã„',d:'æ…é‡ã«ã€‚ã‚‚ã†å°‘ã—ä¸‹ãŒã‚‹ã®ã‚’å¾…ã¡ãŸã„',v:'bear',isRec:false},
      {ico:'ğŸ˜',t:'ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„',d:'æ–¹å‘æ„Ÿãªã—ã€‚å®‰å®šé‡è¦–ã§æ§˜å­è¦‹',v:'flat',isRec:true},
      {ico:'ğŸ¤–',t:'æ„Ÿè¦šã‚ˆã‚Šæ•°å­—ã§æ±ºã‚ãŸã„',d:'ç›¸å ´è¦³ã¯ç„¡è¦–ã€‚æ¡ä»¶ã ã‘ã§åˆ¤æ–­ã™ã‚‹',v:'neutral',isRec:false},
    ]
  },
  {
    id:'horizon',q:'ã©ã®ãã‚‰ã„æŒã¡ç¶šã‘ã‚‹ã¤ã‚‚ã‚Šã§ã™ã‹ï¼Ÿ',
    hint:'ä¿æœ‰æœŸé–“ã«ã‚ˆã£ã¦å‚ç…§ã™ã‚‹ç§»å‹•å¹³å‡ç·šã®åŸºæº–ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚',
    recommend:{val:'long',reason:'é«˜é…å½“å®‰å®šæ ªã¯é•·ãæŒã¤ã»ã©ãƒ¡ãƒªãƒƒãƒˆãŒå‡ºã¾ã™ã€‚é…å½“ã‚’å—ã‘å–ã‚ŠãªãŒã‚‰æ ªä¾¡å›å¾©ã‚’å¾…ã¦ã‚‹ã®ãŒå¼·ã¿ã§ã™ã€‚'},
    opts:[
      {ico:'âš¡',t:'æ•°æ—¥ã€œ1é€±é–“ï¼ˆçŸ­æœŸåç™ºç‹™ã„ï¼‰',d:'ç´ æ—©ãåˆ©ç›Šç¢ºå®šã€‚çŸ­æœŸã®å€¤å‹•ãã‚’å–ã‚ŠãŸã„',v:'short',isRec:false},
      {ico:'ğŸ“…',t:'æ•°é€±é–“ã€œ1ãƒ¶æœˆï¼ˆã‚¹ã‚¦ã‚£ãƒ³ã‚°ï¼‰',d:'ã˜ã£ãã‚Šå¾…ã£ã¦å£²ã‚Šæ™‚ã‚’è¦‹æ¥µã‚ã‚‹',v:'mid',isRec:false},
      {ico:'ğŸŒ±',t:'æ•°ãƒ¶æœˆä»¥ä¸Šï¼ˆä¸­é•·æœŸä¿æœ‰ï¼‰',d:'é…å½“ã‚’ã‚‚ã‚‰ã„ãªãŒã‚‰ã‚†ã£ãã‚Šè‚²ã¦ã‚‹',v:'long',isRec:true},
    ]
  }
];
let qStep=0,qAnswers={};

function openQuiz(){document.getElementById('quizOverlay').classList.add('open');qStep=0;qAnswers={};renderQuiz();}
function closeQuizBg(e){if(e.target===document.getElementById('quizOverlay'))document.getElementById('quizOverlay').classList.remove('open');}

function renderQuiz(){
  const q=QUIZ[qStep];
  document.getElementById('qzStep').textContent=`STEP ${qStep+1} / ${QUIZ.length}`;
  document.getElementById('qzBar').innerHTML=QUIZ.map((_,i)=>`<div class="quiz-seg ${i<qStep?'done':i===qStep?'active':''}"></div>`).join('');
  document.getElementById('qzQ').textContent=q.q;
  document.getElementById('qzHint').textContent=q.hint;
  if(q.recommend){
    document.getElementById('qzRecommend').innerHTML=`
      <div class="quiz-rec">
        <div class="quiz-rec-ico">ğŸ’¡</div>
        <div>
          <div class="quiz-rec-label">ã‹ã¶ã®ã™ã‘ã®ãŠã™ã™ã‚</div>
          <div class="quiz-rec-text">${q.opts.find(o=>o.v===q.recommend.val)?.t||''}</div>
          <div class="quiz-rec-reason">${q.recommend.reason}</div>
        </div>
      </div>`;
  } else {
    document.getElementById('qzRecommend').innerHTML='';
  }
  const sel=qAnswers[q.id];
  document.getElementById('qzOpts').innerHTML=q.opts.map(o=>`
    <div class="quiz-opt ${sel===o.v?'sel':''} ${o.isRec?'recommended':''}" onclick="selectOpt('${o.v}',this)">
      ${o.isRec?'<div class="rec-badge">â˜… ãŠã™ã™ã‚</div>':''}
      <div class="quiz-opt-ico">${o.ico}</div>
      <div>
        <div class="quiz-opt-t">${o.t}</div>
        <div class="quiz-opt-d">${o.d}</div>
      </div>
    </div>`).join('');
  document.getElementById('qzBack').style.visibility=qStep===0?'hidden':'visible';
  document.getElementById('qzNext').textContent=qStep===QUIZ.length-1?'ã‚¹ã‚­ãƒ£ãƒ³é–‹å§‹ â–¶':'æ¬¡ã¸ â–¶';
  document.getElementById('qzNext').disabled=!sel;
}

function selectOpt(val,el){
  qAnswers[QUIZ[qStep].id]=val;
  document.querySelectorAll('.quiz-opt').forEach(o=>o.classList.remove('sel'));
  el.classList.add('sel');
  document.getElementById('qzNext').disabled=false;
}
function quizBack(){if(qStep>0){qStep--;renderQuiz();}}
function quizNext(){
  if(qStep<QUIZ.length-1){qStep++;renderQuiz();}
  else{
    document.getElementById('quizOverlay').classList.remove('open');
    applyAnswers();
    runWithAnimation();
  }
}
function applyAnswers(){
  const{goal}=qAnswers;
  const modeMap={dividend:'dividend',deviation:'rebound',value:'value',balance:'dividend'};
  const m=modeMap[goal]||'dividend';
  currentMode=m;
  document.querySelectorAll('.mode-tab').forEach(t=>t.classList.remove('active'));
  const el=document.getElementById('mode-'+m);
  if(el)el.classList.add('active');
}

// ===== MODE =====
function setMode(m,el){
  currentMode=m;
  document.querySelectorAll('.mode-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
}

// ===== WATCHLIST =====
function toggleFav(code){
  if(watchlist.includes(code)){watchlist=watchlist.filter(c=>c!==code);}
  else{watchlist.push(code);}
  try{localStorage.setItem('kbs_watch',JSON.stringify(watchlist));}catch(e){}
  updateWatchCount();
  renderCard();renderWatchlist();
}
function updateWatchCount(){
  const el=document.getElementById('watchCount');
  el.textContent=watchlist.length;
  el.classList.toggle('show',watchlist.length>0);
}
function renderWatchlist(){
  updateWatchCount();
  const el=document.getElementById('watchlistBody');
  if(!watchlist.length){
    el.innerHTML='<div class="watch-empty">ã‚¦ã‚©ãƒƒãƒç™»éŒ²ã—ãŸéŠ˜æŸ„ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>ã‚«ãƒ¼ãƒ‰ã®ã€Œâ˜† ã‚¦ã‚©ãƒƒãƒç™»éŒ²ã€ã‹ã‚‰è¿½åŠ ã§ãã¾ã™ã€‚</div>';
    return;
  }
  el.innerHTML=`<div class="watch-list">${watchlist.map(code=>{
    const s=STOCKS.find(x=>x.code===code);if(!s)return'';
    const d25=dv(s.price,s.ma25);
    const{score}=calcScore(s,currentMode);
    const sc=score>=60?'hi':score>=35?'md':'lo';
    return`<div class="watch-row" onclick="jumpToCard('${code}');switchTab('home')">
      <div class="watch-code">${code}</div>
      <div class="watch-name">${s.name}</div>
      <div style="text-align:right">
        <div class="watch-score ${sc}">${score}ç‚¹</div>
        <div style="font-size:10px">${d25>0?'+':''}${d25}%</div>
      </div>
      <button class="watch-remove" onclick="event.stopPropagation();toggleFav('${code}')">âœ•</button>
    </div>`;
  }).join('')}</div>`;
}
function renderHistory(){
  const el=document.getElementById('historyBody');
  const modeNames={dividend:'é«˜é…å½“',value:'ãƒãƒªãƒ¥ãƒ¼',rebound:'æŠ¼ã—ç›®'};
  if(!scanHistory.length){
    el.innerHTML='<div style="background:var(--bg2);border:1px solid var(--border);border-top:none;border-radius:0 0 var(--r) var(--r);padding:14px;text-align:center;font-size:12px;color:var(--text3)">ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¨å±¥æ­´ãŒä¿å­˜ã•ã‚Œã¾ã™</div>';
    return;
  }
  el.innerHTML=`<table class="hist-table">
    <tr><th>æ—¥æ™‚</th><th>ãƒ¢ãƒ¼ãƒ‰</th><th>ä»¶æ•°</th><th>1ä½éŠ˜æŸ„</th></tr>
    ${scanHistory.slice(0,7).map(h=>`<tr>
      <td>${h.date}</td><td>${modeNames[h.mode]||h.mode}</td>
      <td>${h.count}ä»¶</td><td>${h.top}</td>
    </tr>`).join('')}
  </table>`;
}

// ===== TABS =====
function switchTab(tab){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.querySelectorAll('.pc-tab').forEach(n=>n.classList.remove('active'));
  document.getElementById('panel-'+tab).classList.add('active');
  const n=document.getElementById('nav-'+tab);if(n)n.classList.add('active');
  const p=document.getElementById('pc-'+tab);if(p)p.classList.add('active');
  if(tab==='watch'){renderWatchlist();renderHistory();}
}

// ===== DATA LOAD =====
async function loadRealData(){
  try{
    const r=await fetch('stocks_data.json?t='+Date.now());
    if(!r.ok)throw new Error();
    const j=await r.json();
    if(j.stocks&&j.stocks.length>0){
      STOCKS.splice(0,STOCKS.length,...j.stocks);
      dataSource='real';
      // å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãï¼ˆã‚ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã ã‘ï¼‰
      const mFields=['nikkei_price','nikkei_ma25','nikkei_1d_chg','nasdaq_1d_chg',
                     'vix','usdjpy','us10y','geo_risk','rate_cut_flag',
                     'prev_buy_count','prev_top_score'];
      mFields.forEach(k=>{ if(j[k]!==undefined) marketData[k]=j[k]; });
      // Pulse ãƒãƒ¼ã‚‚å®Ÿãƒ‡ãƒ¼ã‚¿ã§æ›´æ–°
      if(j.nikkei_price) updatePulseFromMarket(j);
      document.getElementById('trustText').innerHTML=`<span class="hi">${j.updated_at}</span> æ›´æ–° Â· ${j.total}éŠ˜æŸ„ã‚¹ã‚­ãƒ£ãƒ³æ¸ˆã¿`;
      if(j.total){const tc=document.getElementById('totalCount');if(tc)tc.textContent=j.total+'éŠ˜æŸ„';}
      document.getElementById('trustDot').style.background='var(--green)';
      document.getElementById('trustBanner').style.borderLeftColor='var(--green)';
    } else throw new Error();
  } catch{
    dataSource='sample';
    document.getElementById('trustText').innerHTML='<span class="warn">ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºä¸­</span> â€” å®Ÿãƒ‡ãƒ¼ã‚¿ã¯æ¯æœ8:30æ›´æ–°';
    document.getElementById('trustDot').style.background='var(--amber)';
    document.getElementById('trustBanner').style.borderLeftColor='var(--amber)';
  }
}

function updatePulseFromMarket(j){
  const sign=v=>v>0?'+':'';
  const dir=v=>v>0?'up':v<0?'dn':'neutral';
  const chips=[
    {l:'æ—¥çµŒå¹³å‡',v:j.nikkei_price?.toLocaleString()||'â€”',c:sign(j.nikkei_1d_chg)+j.nikkei_1d_chg+'%',d:dir(j.nikkei_1d_chg)},
    {l:'TOPIX',v:j.topix_price||'â€”',c:j.topix_1d_chg?sign(j.topix_1d_chg)+j.topix_1d_chg+'%':'â€”',d:dir(j.topix_1d_chg)},
    {l:'ãƒ‰ãƒ«å††',v:j.usdjpy||'â€”',c:j.usdjpy_chg?sign(j.usdjpy_chg)+j.usdjpy_chg:'â€”',d:dir(j.usdjpy_chg)},
    {l:'VIX',v:j.vix||'â€”',c:j.vix_chg?sign(j.vix_chg)+j.vix_chg:'â€”',d:dir(-j.vix_chg)},
    {l:'ç±³NASDAQ',v:j.nasdaq_1d_chg?sign(j.nasdaq_1d_chg)+j.nasdaq_1d_chg+'%':'â€”',c:'å‰æ—¥æ¯”',d:dir(j.nasdaq_1d_chg)},
    {l:'å£²è²·ä»£é‡‘',v:j.trade_volume||'â€”',c:'',d:'neutral'},
  ];
  document.getElementById('pulseBar').innerHTML=chips.map(c=>`
    <div class="pc">
      <div class="pc-l">${c.l}</div>
      <div class="pc-v ${c.d}">${c.v}</div>
      <div class="pc-c ${c.d}">${c.c}</div>
    </div>`).join('');
}

// ===== MODALS =====
function openLogicModal(){document.getElementById('logicModal').classList.add('open');}
function closeLogicModal(e){if(!e||e.target===document.getElementById('logicModal'))document.getElementById('logicModal').classList.remove('open');}

// ===== RUN =====
function run(){
  processStocks();
  const buyN=processed.filter(s=>s.zone.cls==='buy').length;
  const watchN=processed.filter(s=>s.zone.cls==='watch').length;
  renderDiff(buyN,watchN,processed.length);
  renderHeroStats();
  renderStance();
  renderPulse();
  renderRankings();
  cardIndex=0;
  renderCard();
  renderEvents();
}

async function init(){
  await loadRealData();
  run();
}

updateWatchCount();
init();
</script>
</body>
</html>