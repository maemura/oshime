<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‹ã¶ã®ã™ã‘ â€” ä»Šæ—¥ã®æŠ¼ã—ç›®å€™è£œ</title>
<meta name="description" content="æ±è¨¼ãƒ—ãƒ©ã‚¤ãƒ å…¨éŠ˜æŸ„ã‚’æ¯æœè‡ªå‹•ã‚¹ã‚­ãƒ£ãƒ³ã€‚åœ°åˆã„åˆ¤å®šÃ—é«˜é…å½“Ã—å‰²å®‰ã§ä»Šæ—¥ã®è²·ã„å ´ã‚’å³è¡¨ç¤ºã€‚">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DWW0W11P5T"></script>
<script>
  window.dataLayer=window.dataLayer||[];
  function gtag(){dataLayer.push(arguments);}
  gtag('js',new Date());
  gtag('config','G-DWW0W11P5T',{page_title:'ã‹ã¶ã®ã™ã‘'});
  function gaEvent(n,p){if(typeof gtag!=='undefined')gtag('event',n,p||{});}
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&family=JetBrains+Mono:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg-page:#eef2f7;
  --bg-primary:#0d1117;--bg-card:#151b26;--bg-card2:#1a2233;
  --bg-hover:#1e2a3a;--bg-input:#0f1520;
  --border:#1e293b;--border-hi:#2d3f56;--border-glow:#334155;
  --text:#c9d1d9;--text-hi:#e6edf3;--text-dim:#6b7b8d;--text-muted:#484f5a;
  --text-page:#4a5568;
  --orange:#ff6b00;--orange2:#ff8533;--orange-dim:rgba(255,107,0,0.12);
  --green:#00d68f;--green-dim:rgba(0,214,143,0.10);
  --red:#ff4757;--red-dim:rgba(255,71,87,0.10);
  --cyan:#00b4d8;--cyan-dim:rgba(0,180,216,0.08);
  --amber:#f0a500;--amber-dim:rgba(240,165,0,0.10);
  --blue:#4a9eff;--blue-dim:rgba(74,158,255,0.08);
  --up:#ff4757;--dn:#4a9eff;
  --r:8px;--r2:4px;
  --fn:'JetBrains Mono','Outfit',monospace;
  --fh:'Outfit','Noto Sans JP',sans-serif;
  --fb:'Noto Sans JP','Outfit',sans-serif;
  --shadow:0 2px 8px rgba(0,0,0,0.15),0 1px 3px rgba(0,0,0,0.1);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{font-size:14px;}
body{background:var(--bg-page);color:var(--text);font-family:var(--fb);min-height:100vh;overflow-x:hidden;}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:var(--bg-page);}
::-webkit-scrollbar-thumb{background:#b0bec5;border-radius:3px;}

/* TOPBAR */
.topbar{position:sticky;top:0;z-index:300;background:var(--bg-primary);border-bottom:1px solid var(--border);height:46px;display:flex;align-items:center;padding:0 16px;box-shadow:0 2px 12px rgba(0,0,0,0.2);}
.topbar-inner{width:100%;max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;}
.logo-name{font-family:var(--fh);font-size:16px;font-weight:800;color:var(--orange);letter-spacing:-0.5px;}
.logo-tag{font-size:10px;color:var(--text-dim);font-family:var(--fh);margin-left:8px;}
.topbar-right{display:flex;align-items:center;gap:6px;}
.btn-topbar{background:transparent;border:1px solid var(--border);border-radius:var(--r2);padding:5px 10px;color:var(--text-dim);cursor:pointer;font-family:var(--fh);font-size:10px;font-weight:600;display:flex;align-items:center;gap:4px;transition:all 0.15s;}
.btn-topbar:hover{background:var(--bg-hover);color:var(--text-hi);border-color:var(--border-hi);}
.watch-count{background:var(--orange);color:#fff;border-radius:8px;padding:0 5px;font-size:9px;font-weight:700;display:none;}
.watch-count.show{display:inline-block;}
.live-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pd 2s ease-in-out infinite;margin-right:4px;}
@keyframes pd{0%,100%{opacity:1;box-shadow:0 0 4px var(--green);}50%{opacity:0.4;box-shadow:none;}}

/* LAYOUT */
.page{max-width:1200px;margin:0 auto;padding:16px 16px 90px;}
@media(max-width:480px){.page{padding:10px 10px 90px;}}

/* SECTION */
.section{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--r);margin-bottom:12px;overflow:hidden;transition:border-color 0.2s;box-shadow:var(--shadow);}
.section:hover{border-color:var(--border-hi);}
.section-header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--border);background:var(--bg-card2);}
.section-title{font-family:var(--fh);font-size:12px;font-weight:700;color:var(--text-hi);letter-spacing:0.3px;display:flex;align-items:center;gap:6px;}
.section-title .tag{font-size:9px;padding:1px 6px;border-radius:3px;font-weight:700;font-family:var(--fn);}
.tag-live{background:var(--green-dim);color:var(--green);}
.tag-beta{background:var(--cyan-dim);color:var(--cyan);}
.tag-ai{background:var(--orange-dim);color:var(--orange);}
.section-sub{font-size:10px;color:var(--text-dim);font-family:var(--fh);}
.section-body{padding:12px 14px;}

/* MARKET STRIP */
.market-strip{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--r);margin-bottom:12px;overflow:hidden;box-shadow:var(--shadow);}
.market-strip-header{display:flex;align-items:center;justify-content:space-between;padding:8px 14px;border-bottom:1px solid var(--border);background:var(--bg-card2);}
.market-strip-title{font-family:var(--fh);font-size:11px;font-weight:700;color:var(--text-dim);display:flex;align-items:center;gap:6px;}
.pulse-row{display:flex;overflow-x:auto;scrollbar-width:none;}
.pulse-row::-webkit-scrollbar{display:none;}
.pc{flex-shrink:0;padding:8px 14px;border-right:1px solid var(--border);min-width:90px;text-align:center;}
.pc:last-child{border-right:none;}
.pc-l{font-size:9px;color:var(--text-muted);font-family:var(--fn);letter-spacing:0.5px;margin-bottom:2px;}
.pc-v{font-family:var(--fn);font-size:14px;color:var(--text-hi);font-weight:700;}
.pc-v.up{color:var(--up);}.pc-v.dn{color:var(--dn);}
.pc-c{font-family:var(--fn);font-size:10px;color:var(--text-dim);}
.pc-c.up{color:var(--up);}.pc-c.dn{color:var(--dn);}

/* TRUST BAR (moved to footer area) */
.trust-bar{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;padding:6px 14px;border-bottom:1px solid var(--border);}
.trust-left{display:flex;align-items:center;gap:6px;}
.trust-dot{width:6px;height:6px;border-radius:50%;background:var(--amber);flex-shrink:0;}
.trust-text{font-size:10px;color:var(--text-dim);font-family:var(--fn);}
.trust-text .hi{color:var(--green);font-weight:700;}
.trust-text .warn{color:var(--amber);font-weight:700;}
.trust-badges{display:flex;gap:4px;}
.tbadge{background:transparent;border:1px solid var(--border);border-radius:3px;padding:1px 6px;font-size:9px;color:var(--text-dim);font-family:var(--fn);}
.tbadge.link{cursor:pointer;color:var(--orange);border-color:rgba(255,107,0,0.3);}
.tbadge.link:hover{background:var(--orange-dim);border-color:var(--orange);}

/* STANCE */
.stance{padding:12px 14px;border-top:1px solid var(--border);}
.stance-flex{display:flex;align-items:flex-start;gap:14px;flex-wrap:wrap;}
.stance-left{flex:1;min-width:200px;}
.stance-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:12px;font-family:var(--fh);font-size:11px;font-weight:700;margin-bottom:6px;}
.stance-badge.bull{background:var(--green-dim);color:var(--green);border:1px solid rgba(0,214,143,0.2);}
.stance-badge.neutral{background:var(--amber-dim);color:var(--amber);border:1px solid rgba(240,165,0,0.2);}
.stance-badge.bear{background:var(--red-dim);color:var(--red);border:1px solid rgba(255,71,87,0.2);}
.stance-title{font-family:var(--fh);font-size:15px;font-weight:800;color:var(--text-hi);margin-bottom:4px;}
.stance-reason{font-size:12px;color:var(--text);line-height:1.7;}
.stance-reason strong{color:var(--orange2);}
.stance-right{display:flex;flex-direction:column;gap:4px;min-width:160px;}
.stance-axes{display:flex;flex-direction:column;gap:4px;}
.axis-row{display:flex;align-items:center;gap:6px;font-size:11px;}
.axis-name{min-width:80px;color:var(--text-dim);font-family:var(--fh);font-size:10px;}
.axis-bar{display:flex;gap:2px;}
.axis-seg{width:20px;height:5px;border-radius:2px;background:var(--border);}
.axis-seg.on.hi{background:var(--green);}.axis-seg.on.mid{background:var(--amber);}
.axis-score{font-family:var(--fn);font-size:10px;color:var(--text-dim);}
.axis-total{font-size:10px;font-weight:700;color:var(--text-dim);padding-top:4px;border-top:1px solid var(--border);font-family:var(--fn);}
.stance-chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px;}
.stance-chip{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--r2);padding:5px 10px;text-align:center;flex:1;min-width:65px;}
.stance-chip.buy{border-color:rgba(0,214,143,0.3);background:var(--green-dim);}
.stance-chip.warn{border-color:rgba(240,165,0,0.3);background:var(--amber-dim);}
.stance-chip-val{font-family:var(--fn);font-size:14px;color:var(--text-hi);}
.stance-chip-label{font-size:9px;color:var(--text-dim);}
.stance-date{font-size:10px;color:var(--text-muted);font-family:var(--fn);}

/* BRAIN SCANNER */
.brain-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}
@media(max-width:640px){.brain-grid{grid-template-columns:1fr;}}
.brain-col-title{font-family:var(--fn);font-size:10px;font-weight:700;letter-spacing:1px;padding:4px 0 6px;border-bottom:1px solid var(--border);margin-bottom:6px;}
.brain-col-title.macro{color:var(--cyan);}
.brain-col-title.inst{color:var(--amber);}
.brain-col-title.retail{color:var(--green);}
.brain-item{display:flex;justify-content:space-between;align-items:center;padding:4px 0;font-size:11px;border-bottom:1px solid rgba(30,41,59,0.5);}
.brain-item:last-child{border-bottom:none;}
.brain-topic{color:var(--text);max-width:70%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.brain-score{font-family:var(--fn);font-size:11px;font-weight:700;min-width:36px;text-align:right;}
.brain-score.pos{color:var(--green);}.brain-score.neg{color:var(--red);}.brain-score.neu{color:var(--text-dim);}
.brain-overall{display:flex;align-items:center;gap:10px;padding:8px 10px;margin-bottom:8px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--r2);}
.brain-overall-label{font-size:10px;color:var(--text-dim);}
.brain-overall-val{font-family:var(--fn);font-size:18px;font-weight:700;}
.brain-overall-val.pos{color:var(--green);}.brain-overall-val.neg{color:var(--red);}.brain-overall-val.neu{color:var(--amber);}
.brain-overall-bar{flex:1;height:4px;background:var(--border);border-radius:2px;overflow:hidden;}
.brain-overall-fill{height:100%;border-radius:2px;transition:width 0.5s;}
.brain-summary{margin-top:8px;padding:8px 10px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--r2);font-size:11px;color:var(--text);line-height:1.6;}

/* 3 TABS */
.t5-tabs{display:flex;gap:0;border-bottom:1px solid var(--border);background:var(--bg-card2);}
.t5-tab{flex:1;padding:9px 4px;text-align:center;cursor:pointer;font-family:var(--fh);font-size:11px;font-weight:700;color:var(--text-dim);transition:all 0.15s;position:relative;}
.t5-tab.active{color:var(--orange);}
.t5-tab.active::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;background:var(--orange);}
.t5-tab:hover:not(.active){color:var(--text);}

/* SECTOR GRID */
.sec-grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:6px;}
@media(max-width:640px){.sec-grid{grid-template-columns:1fr 1fr;}}
.sec-tile{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--r2);padding:10px 6px;text-align:center;cursor:pointer;transition:all 0.15s;}
.sec-tile:hover{border-color:var(--orange);background:var(--bg-hover);}
.sec-tile-ico{font-size:20px;margin-bottom:3px;}
.sec-tile-name{font-family:var(--fh);font-size:10px;font-weight:700;color:var(--text-hi);}
.sec-tile-sub{font-family:var(--fn);font-size:9px;color:var(--text-dim);margin-top:2px;}
.sec-back-btn{display:inline-flex;align-items:center;gap:4px;padding:5px 10px;margin-bottom:8px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--r2);font-size:10px;font-weight:700;color:var(--text-dim);cursor:pointer;font-family:var(--fh);}
.sec-back-btn:hover{background:var(--bg-hover);color:var(--text);}

/* TOP10 CARDS */
.top10-cards{display:flex;flex-direction:column;gap:4px;}
.top10-card{display:flex;align-items:center;gap:10px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--r2);padding:10px 12px;cursor:pointer;transition:all 0.15s;}
.top10-card:hover{border-color:var(--orange);background:var(--bg-hover);}
.top10-rank{font-family:var(--fn);font-size:14px;font-weight:800;color:var(--text-dim);min-width:20px;text-align:center;}
.top10-rank.top{color:var(--orange);}
.top10-info{flex:1;min-width:0;}
.top10-name{font-size:12px;font-weight:700;color:var(--text-hi);}
.top10-meta{font-size:9px;color:var(--text-muted);margin-top:1px;font-family:var(--fn);}
.top10-right{text-align:right;min-width:50px;}
.top10-score{font-family:var(--fn);font-size:14px;font-weight:800;}
.top10-score.hi{color:var(--orange);}.top10-score.mid{color:var(--amber);}
.top10-badge{display:inline-block;font-size:8px;font-weight:700;padding:1px 5px;border-radius:3px;margin-top:2px;}
.top10-badge.div{background:var(--green-dim);color:var(--green);}
.top10-badge.mom{background:var(--blue-dim);color:var(--blue);}

/* PORTFOLIO - special diary style */
.section.diary{border:1px solid #2d3a50;border-left:4px solid var(--orange);background:linear-gradient(135deg,#151b26 0%,#1a1f2e 100%);}
.section.diary .section-header{background:linear-gradient(90deg,rgba(255,107,0,0.06),transparent);}
.pf-hero{display:flex;align-items:baseline;gap:12px;padding:10px 0;border-bottom:1px solid var(--border);margin-bottom:10px;}
.pf-nav{font-family:var(--fn);font-size:22px;font-weight:800;color:var(--text-hi);}
.pf-pnl{font-family:var(--fn);font-size:13px;font-weight:700;}
.pf-pnl.up{color:var(--green);}.pf-pnl.dn{color:var(--red);}
.pf-day{font-size:10px;color:var(--text-dim);font-family:var(--fn);}
.pf-bars{display:flex;gap:3px;margin-bottom:8px;}
.pf-bar{flex:1;text-align:center;font-size:10px;padding:4px 0;border-radius:var(--r2);font-family:var(--fn);}
.pf-bar.cash{background:var(--blue-dim);color:var(--blue);}
.pf-bar.stock{background:var(--green-dim);color:var(--green);}
.pf-holdings{display:flex;flex-direction:column;gap:4px;margin-bottom:8px;}
.pf-hold{display:flex;align-items:center;gap:8px;padding:8px 10px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--r2);}
.pf-hold-name{flex:1;font-size:12px;font-weight:600;color:var(--text-hi);}
.pf-hold-pnl{font-family:var(--fn);font-size:13px;font-weight:700;min-width:50px;text-align:right;}
.pf-hold-pnl.up{color:var(--green);}.pf-hold-pnl.dn{color:var(--red);}
.pf-note-link{display:block;text-align:center;padding:10px;background:var(--orange);color:#fff;border-radius:var(--r);font-size:12px;font-weight:700;text-decoration:none;margin-top:8px;transition:all 0.15s;font-family:var(--fh);}
.pf-note-link:hover{background:var(--orange2);box-shadow:0 0 16px rgba(255,107,0,0.3);}

/* WATCHLIST */
.watch-empty{padding:16px;text-align:center;font-size:11px;color:var(--text-dim);}
.watch-list{display:flex;flex-direction:column;gap:4px;}
.watch-row{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--r2);cursor:pointer;transition:all 0.15s;}
.watch-row:hover{border-color:var(--border-hi);background:var(--bg-hover);}
.watch-code{font-family:var(--fn);font-size:10px;color:var(--text-dim);min-width:36px;}
.watch-name{flex:1;font-size:11px;font-weight:600;color:var(--text-hi);}
.watch-score{font-family:var(--fn);font-size:12px;font-weight:700;}
.watch-score.hi{color:var(--orange);}.watch-score.md{color:var(--amber);}.watch-score.lo{color:var(--text-dim);}
.watch-remove{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:12px;padding:4px;transition:color 0.15s;}
.watch-remove:hover{color:var(--red);}
.hist-table{width:100%;border-collapse:collapse;font-size:10px;}
.hist-table th{background:var(--bg-card2);padding:5px 8px;text-align:left;font-family:var(--fn);font-size:9px;color:var(--text-muted);border-bottom:1px solid var(--border);}
.hist-table td{padding:5px 8px;border-bottom:1px solid var(--border);color:var(--text-dim);font-family:var(--fn);}

/* SETTINGS */
.settings-overlay{position:fixed;inset:0;z-index:500;background:rgba(0,0,0,0.7);display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(4px);}
.settings-overlay.open{display:flex;}
.settings-box{background:var(--bg-card);border:1px solid var(--border);border-radius:12px 12px 0 0;padding:16px;width:100%;max-width:520px;max-height:80vh;overflow-y:auto;}
.settings-handle{width:30px;height:3px;background:var(--border-hi);border-radius:2px;margin:0 auto 12px;}
.settings-title{font-family:var(--fh);font-size:13px;font-weight:800;color:var(--text-hi);margin-bottom:12px;}
.setting-row{margin-bottom:12px;}
.setting-label{font-family:var(--fn);font-size:10px;font-weight:700;color:var(--text-muted);margin-bottom:6px;letter-spacing:1px;}
.setting-opts{display:flex;gap:4px;flex-wrap:wrap;}
.setting-opt{border:1px solid var(--border);border-radius:var(--r2);padding:6px 10px;font-family:var(--fh);font-size:10px;font-weight:600;color:var(--text);cursor:pointer;background:var(--bg-input);transition:all 0.15s;}
.setting-opt:hover{border-color:var(--border-hi);}
.setting-opt.active{background:var(--orange);color:#fff;border-color:var(--orange);}
.settings-save{width:100%;padding:10px;background:var(--orange);color:#fff;border:none;border-radius:var(--r);font-family:var(--fh);font-size:12px;font-weight:700;cursor:pointer;margin-top:6px;}
.settings-save:hover{background:var(--orange2);}

/* LOGIC MODAL */
.logic-overlay{position:fixed;inset:0;z-index:500;background:rgba(0,0,0,0.7);display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(4px);}
.logic-overlay.open{display:flex;}
.logic-box{background:var(--bg-card);border:1px solid var(--border);border-radius:12px 12px 0 0;padding:16px;width:100%;max-width:520px;max-height:75vh;overflow-y:auto;}
.modal-handle{width:30px;height:3px;background:var(--border-hi);border-radius:2px;margin:0 auto 12px;}
.logic-title{font-family:var(--fh);font-size:13px;font-weight:800;color:var(--text-hi);margin-bottom:4px;}
.logic-sub{font-size:11px;color:var(--text-dim);margin-bottom:10px;}
.logic-tbl{width:100%;border-collapse:collapse;font-size:11px;margin-bottom:10px;}
.logic-tbl th{background:var(--bg-card2);padding:6px 8px;text-align:left;font-family:var(--fn);font-size:9px;color:var(--text-muted);border-bottom:1px solid var(--border);}
.logic-tbl td{padding:6px 8px;border-bottom:1px solid var(--border);color:var(--text);}
.logic-tbl .pts{text-align:right;font-family:var(--fn);font-weight:700;color:var(--orange);}
.logic-note{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--r2);padding:10px;font-size:10px;color:var(--text);line-height:1.8;margin-bottom:10px;}
.btn-logic-close{width:100%;padding:10px;background:var(--bg-card2);color:var(--text-hi);border:1px solid var(--border);border-radius:var(--r);font-family:var(--fh);font-size:12px;font-weight:700;cursor:pointer;}
.btn-logic-close:hover{background:var(--bg-hover);}

/* BOTTOM NAV */
.bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;z-index:200;background:rgba(13,17,23,0.97);backdrop-filter:blur(8px);border-top:1px solid var(--border);padding:6px 0 8px;}
@media(max-width:768px){.bottom-nav{display:flex;}}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:1px;background:none;border:none;cursor:pointer;color:var(--text-dim);padding:4px;transition:color 0.15s;}
.nav-item.active{color:var(--orange);}
.nav-ico{font-size:16px;}
.nav-label{font-size:8px;font-family:var(--fh);font-weight:700;}

.panel{display:none;}.panel.active{display:block;}
.skeleton{border-radius:var(--r2);animation:sh 1.5s infinite linear;background:linear-gradient(90deg,var(--border) 25%,var(--border-hi) 50%,var(--border) 75%);background-size:200% 100%;}
@keyframes sh{0%{background-position:200% 0;}100%{background-position:-200% 0;}}
.skel-row{height:36px;margin-bottom:3px;border-radius:var(--r2);}
.fadein{animation:fi 0.3s ease;}
@keyframes fi{from{opacity:0;transform:translateY(4px);}to{opacity:1;transform:none;}}
.disclaimer{font-size:9px;color:var(--text-muted);text-align:center;padding:10px 0;line-height:1.8;}

/* FOOTER INFO BAR */
.footer-info{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--r);margin-bottom:12px;overflow:hidden;box-shadow:var(--shadow);}
.footer-info-inner{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;padding:8px 14px;}
.footer-stats{display:flex;gap:12px;flex-wrap:wrap;}
.footer-stat{text-align:center;}
.footer-stat-val{font-family:var(--fn);font-size:13px;color:var(--text-hi);font-weight:700;}
.footer-stat-val.buy{color:var(--orange);}
.footer-stat-label{font-size:8px;color:var(--text-muted);font-family:var(--fh);}

@media(max-width:600px){.stance-flex{flex-direction:column;}.brain-grid{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="topbar"><div class="topbar-inner">
  <div><span class="logo-name">ã‹ã¶ã®ã™ã‘</span><span class="logo-tag">é«˜é…å½“ãƒ»å‰²å®‰æ ªã®è²·ã„å ´ã‚’æ¯æ—¥ã‚¹ã‚­ãƒ£ãƒ³</span></div>
  <div class="topbar-right">
    <button class="btn-topbar" onclick="switchTab('watch')">â­ ã‚¦ã‚©ãƒƒãƒ <span class="watch-count" id="watchCount">0</span></button>
    <button class="btn-topbar" onclick="openSettings()">âš™ è¨­å®š</button>
  </div>
</div></div>
<div class="page">
  <div class="panel active" id="panel-home">
    <!-- â‘  MARKET PULSE + STANCE -->
    <div class="market-strip" id="marketSection">
      <div class="market-strip-header">
        <div class="market-strip-title"><span class="live-dot"></span> MARKET PULSE <span class="tag tag-live" style="font-size:8px">LIVE</span></div>
        <div class="section-sub" id="heroEyebrow">æ¯æœ8:30æ›´æ–°</div>
      </div>
      <div class="pulse-row" id="pulseBar"></div>
      <div id="stanceBox"></div>
    </div>
    <!-- â‘¡ BRAIN SCANNER -->
    <div class="section" id="brainSection" style="display:none">
      <div class="section-header">
        <div class="section-title">ğŸ“¡ BRAIN SCANNER <span class="tag tag-beta">BETA</span></div>
        <div class="section-sub">YouTube 7ch AIè§£æ</div>
      </div>
      <div class="section-body" id="brainBody"><div style="text-align:center;padding:12px;font-size:11px;color:var(--text-dim)">èª­ã¿è¾¼ã¿ä¸­...</div></div>
    </div>
    <!-- â‘¢ STOCK SCAN -->
    <div class="section" id="stockSection">
      <div class="t5-tabs">
        <div class="t5-tab active" id="t5TabSec" onclick="setTop5Tab('sector')">ğŸ“Š ã‚»ã‚¯ã‚¿ãƒ¼</div>
        <div class="t5-tab" id="t5TabMom" onclick="setTop5Tab('mom')">ğŸ“ˆ ä¸Šæ˜‡</div>
        <div class="t5-tab" id="t5TabDip" onclick="setTop5Tab('dip')">ğŸ“‰ å‰²å®‰</div>
      </div>
      <div class="section-body" id="top5Body"><div style="padding:16px;text-align:center"><div class="skel-row skeleton"></div><div class="skel-row skeleton"></div></div></div>
    </div>
    <!-- â‘£ PORTFOLIO DIARY (special style) -->
    <div class="section diary" id="portfolioSection">
      <div class="section-header">
        <div class="section-title">ğŸ» ã‹ã¶ã®ã™ã‘ã®æŠ•è³‡æ—¥è¨˜ <span class="tag tag-ai">AIé‹ç”¨</span></div>
        <div class="section-sub">1000ä¸‡å†† ï¼ 2026.2.24ã€œ</div>
      </div>
      <div class="section-body" id="portfolioBody"><div style="padding:12px;text-align:center;font-size:11px;color:var(--text-dim)">èª­ã¿è¾¼ã¿ä¸­...</div></div>
    </div>
    <!-- â‘¤ FOOTER: Stats + Trust + Logic (å°ã•ãä¸‹ã«) -->
    <div class="footer-info">
      <div class="footer-info-inner">
        <div class="trust-left"><div class="trust-dot" id="trustDot"></div><div class="trust-text" id="trustText">ãƒ‡ãƒ¼ã‚¿ç¢ºèªä¸­...</div></div>
        <div class="footer-stats">
          <div class="footer-stat"><div class="footer-stat-val buy" id="hsBuy">â€”</div><div class="footer-stat-label">è²·ã„åœ</div></div>
          <div class="footer-stat"><div class="footer-stat-val" id="hsTop">â€”</div><div class="footer-stat-label">1ä½</div></div>
          <div class="footer-stat"><div class="footer-stat-val" id="hsDiv">â€”</div><div class="footer-stat-label">æœ€é«˜é…å½“</div></div>
          <div class="footer-stat"><div class="footer-stat-val" id="hsTotal">â€”</div><div class="footer-stat-label">ã‚¹ã‚­ãƒ£ãƒ³æ•°</div></div>
        </div>
        <div class="trust-badges">
          <span class="tbadge" id="totalCountBadge">æ±è¨¼ãƒ—ãƒ©ã‚¤ãƒ </span>
          <span class="tbadge link" onclick="openLogicModal()">LOGIC â–¶</span>
        </div>
      </div>
    </div>
    <div class="disclaimer">âš ï¸ æœ¬ãƒ„ãƒ¼ãƒ«ã¯å‚è€ƒæƒ…å ±ã§ã™ã€‚æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ã§ã€‚å…ƒæœ¬å‰²ã‚Œãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚</div>
  </div>
  <div class="panel" id="panel-watch">
    <div class="section"><div class="section-header"><div class="section-title">â­ ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆ</div></div><div class="section-body" id="watchlistBody"></div></div>
    <div class="section"><div class="section-header"><div class="section-title">ğŸ• ã‚¹ã‚­ãƒ£ãƒ³å±¥æ­´</div></div><div class="section-body" id="historyBody"></div></div>
  </div>
</div>
<nav class="bottom-nav">
  <button class="nav-item active" id="nav-home" onclick="switchTab('home')"><span class="nav-ico">ğŸ </span><span class="nav-label">ãƒ›ãƒ¼ãƒ </span></button>
  <button class="nav-item" id="nav-watch" onclick="switchTab('watch')"><span class="nav-ico">â­</span><span class="nav-label">ã‚¦ã‚©ãƒƒãƒ</span></button>
</nav>
<div class="settings-overlay" id="settingsOverlay" onclick="closeSettingsBg(event)"><div class="settings-box">
  <div class="settings-handle"></div><div class="settings-title">âš™ è¡¨ç¤ºè¨­å®š</div>
  <div class="setting-row"><div class="setting-label">SCAN MODE</div><div class="setting-opts" id="set-mode">
    <div class="setting-opt active" data-val="dividend" onclick="selectSettingOpt(this,'mode')">ğŸ’° å®‰å®šé«˜é…å½“</div>
    <div class="setting-opt" data-val="value" onclick="selectSettingOpt(this,'mode')">ğŸ›¡ å‰²å®‰ãƒãƒªãƒ¥ãƒ¼</div>
    <div class="setting-opt" data-val="rebound" onclick="selectSettingOpt(this,'mode')">âš¡ å¼·æŠ¼ã—ç›®</div>
  </div></div>
  <div class="setting-row"><div class="setting-label">DISPLAY COUNT</div><div class="setting-opts" id="set-count">
    <div class="setting-opt" data-val="10" onclick="selectSettingOpt(this,'count')">TOP 10</div>
    <div class="setting-opt active" data-val="30" onclick="selectSettingOpt(this,'count')">TOP 30</div>
    <div class="setting-opt" data-val="999" onclick="selectSettingOpt(this,'count')">å…¨ä»¶</div>
  </div></div>
  <div class="setting-row"><div class="setting-label">MIN DIVIDEND</div><div class="setting-opts" id="set-mindiv">
    <div class="setting-opt active" data-val="0" onclick="selectSettingOpt(this,'mindiv')">åˆ¶é™ãªã—</div>
    <div class="setting-opt" data-val="2" onclick="selectSettingOpt(this,'mindiv')">2%â†‘</div>
    <div class="setting-opt" data-val="3" onclick="selectSettingOpt(this,'mindiv')">3%â†‘</div>
    <div class="setting-opt" data-val="4" onclick="selectSettingOpt(this,'mindiv')">4%â†‘</div>
  </div></div>
  <div class="setting-row"><div class="setting-label">ZONE FILTER</div><div class="setting-opts" id="set-zone">
    <div class="setting-opt active" data-val="all" onclick="selectSettingOpt(this,'zone')">å…¨ã¦</div>
    <div class="setting-opt" data-val="buy" onclick="selectSettingOpt(this,'zone')">è²·ã„åœã®ã¿</div>
    <div class="setting-opt" data-val="buywatch" onclick="selectSettingOpt(this,'zone')">è²·ã„åœï¼‹æ³¨æ„åœ</div>
  </div></div>
  <button class="settings-save" onclick="saveSettings()">âœ“ SAVE</button>
</div></div>
<div class="logic-overlay" id="logicModal" onclick="closeLogicModal(event)"><div class="logic-box">
  <div class="modal-handle"></div><div class="logic-title">ã‚¹ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ100ç‚¹æº€ç‚¹ï¼‰</div>
  <div class="logic-sub">5æŒ‡æ¨™ã‚’åˆè¨ˆã—ãƒ¢ãƒ¼ãƒ‰åˆ¥ãƒœãƒ¼ãƒŠã‚¹ã‚’é©ç”¨ã€‚</div>
  <table class="logic-tbl">
    <tr><th>æŒ‡æ¨™</th><th>æ¡ä»¶</th><th style="text-align:right">MAX</th></tr>
    <tr><td>é…å½“åˆ©å›ã‚Š</td><td>2.5%ã€œ5%ä»¥ä¸Š</td><td class="pts">30pt</td></tr>
    <tr><td>25MAä¹–é›¢</td><td>-2%ã€œ-8%ä»¥ä¸‹</td><td class="pts">28pt</td></tr>
    <tr><td>RSI</td><td>42ä»¥ä¸‹ã€œ28ä»¥ä¸‹</td><td class="pts">22pt</td></tr>
    <tr><td>PBR</td><td>1.5å€ä»¥ä¸‹ã€œ0.7å€ä»¥ä¸‹</td><td class="pts">18pt</td></tr>
    <tr><td>PER</td><td>15å€ä»¥ä¸‹ã€œ9å€ä»¥ä¸‹</td><td class="pts">12pt</td></tr>
    <tr><td>âš ãƒšãƒŠãƒ«ãƒ†ã‚£</td><td>å‡ºæ¥é«˜1.5å€è¶…/é…å½“ãªã—</td><td class="pts" style="color:var(--red)">-20ã€œ-30</td></tr>
  </table>
  <div class="logic-note">ğŸ’° é«˜é…å½“ â†’ é…å½“Ã—1.4 ï¼ ğŸ›¡ ãƒãƒªãƒ¥ãƒ¼ â†’ PBRÂ·PERÃ—1.6 ï¼ âš¡ æŠ¼ã—ç›® â†’ MAÂ·RSIÃ—1.5</div>
  <button class="btn-logic-close" onclick="closeLogicModal()">é–‰ã˜ã‚‹</button>
</div></div>
<script>
const SAMPLE_STOCKS=[
  {code:'8306',name:'ä¸‰è±UFJãƒ•ã‚£ãƒŠãƒ³ã‚·ãƒ£ãƒ«',sector:'éŠ€è¡Œ',price:1423,ma25:1520,ma75:1580,rsi:32,dividend:3.8,pbr:0.7,per:9.2,vol_r:0.8},
  {code:'9432',name:'NTT',sector:'é€šä¿¡',price:163,ma25:168,ma75:172,rsi:38,dividend:3.2,pbr:1.1,per:11.5,vol_r:0.9},
  {code:'8058',name:'ä¸‰è±å•†äº‹',sector:'å•†ç¤¾',price:2890,ma25:3050,ma75:3200,rsi:29,dividend:4.1,pbr:0.9,per:8.7,vol_r:0.7},
  {code:'4502',name:'æ­¦ç”°è–¬å“å·¥æ¥­',sector:'åŒ»è–¬å“',price:3820,ma25:3960,ma75:4050,rsi:41,dividend:5.6,pbr:1.3,per:15.2,vol_r:1.1},
  {code:'8001',name:'ä¼Šè—¤å¿ å•†äº‹',sector:'å•†ç¤¾',price:6780,ma25:7050,ma75:7200,rsi:33,dividend:3.5,pbr:1.8,per:12.3,vol_r:0.6},
  {code:'7203',name:'ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š',sector:'è‡ªå‹•è»Š',price:2650,ma25:2720,ma75:2800,rsi:36,dividend:3.0,pbr:1.1,per:10.4,vol_r:0.9},
  {code:'8316',name:'ä¸‰äº•ä½å‹FG',sector:'éŠ€è¡Œ',price:7100,ma25:7600,ma75:7800,rsi:28,dividend:4.2,pbr:0.8,per:9.0,vol_r:0.7},
  {code:'2914',name:'JTï¼ˆæ—¥æœ¬ãŸã°ã“ç”£æ¥­ï¼‰',sector:'é£Ÿå“',price:3680,ma25:3780,ma75:3820,rsi:35,dividend:6.2,pbr:1.6,per:13.8,vol_r:0.8},
  {code:'8411',name:'ã¿ãšã»FG',sector:'éŠ€è¡Œ',price:2680,ma25:2850,ma75:2950,rsi:31,dividend:3.9,pbr:0.7,per:8.5,vol_r:0.8},
  {code:'9433',name:'KDDI',sector:'é€šä¿¡',price:4350,ma25:4500,ma75:4600,rsi:37,dividend:3.3,pbr:1.9,per:13.5,vol_r:1.0},
  {code:'9503',name:'é–¢è¥¿é›»åŠ›',sector:'é›»åŠ›',price:2140,ma25:2250,ma75:2300,rsi:33,dividend:3.5,pbr:0.9,per:10.1,vol_r:0.7},
  {code:'5108',name:'ãƒ–ãƒªãƒ‚ã‚¹ãƒˆãƒ³',sector:'ã‚´ãƒ ',price:5100,ma25:5280,ma75:5350,rsi:40,dividend:3.8,pbr:1.2,per:11.8,vol_r:0.8},
];
let STOCKS=[...SAMPLE_STOCKS],processed=[],dataSource='sample',currentMode='dividend',currentTab='sector',activeSector=null,sectorScoresData={},sortKey='score',sortDir='desc',watchlist=[],scanHistory=[],settings={mode:'dividend',count:10,mindiv:0,zone:'all'},trendRankingData=[],portfolioData=null;
let marketData={nikkei_price:null,nikkei_ma25:null,nikkei_1d_chg:null,nasdaq_1d_chg:null,vix:null,usdjpy:null,us10y:null,geo_risk:false,rate_cut_flag:false,prev_buy_count:null};
try{const sw=localStorage.getItem('kbs_watch');if(sw)watchlist=JSON.parse(sw);const sh=localStorage.getItem('kbs_history');if(sh)scanHistory=JSON.parse(sh);const ss=localStorage.getItem('kbs_settings');if(ss){settings=Object.assign(settings,JSON.parse(ss));currentMode=settings.mode||'dividend';}}catch(e){}

function dv(p,m){return m?Math.round((p-m)/m*1000)/10:0;}
function calcScore(s){if(dataSource==='real'&&s.score!=null)return s.score;const d25=dv(s.price,s.ma25);const div=s.dividend||0;let score=0;score+=div>=5?40:div>=4.5?32:div>=4?25:div>=3.5?18:div>=3?10:0;const pbr=s.pbr||99;score+=pbr<=0.7?20:pbr<=0.9?15:pbr<=1.1?8:pbr<=1.5?3:0;score+=d25<=-8?20:d25<=-5?14:d25<=-3?8:d25<=-1?3:0;const rsi=s.rsi||50;score+=rsi<=30?15:rsi<=38?10:rsi<=45?5:0;const per=s.per||99;score+=per<=10?10:per<=13?6:per<=16?3:0;if((s.vol_r||1)>=1.5)score-=20;if(div<0.5)score=Math.min(score,5);const mc=s.market_cap_b||9999;if(mc>0&&mc<300)score-=20;else if(mc>0&&mc<500)score-=10;return Math.max(0,Math.min(score,100));}
function getZone(sc){return sc>=60?{label:'è²·ã„åœ',cls:'buy'}:sc>=35?{label:'æ³¨æ„åœ',cls:'watch'}:{label:'å¾…æ©Ÿåœ',cls:'hold'};}

function processStocks(){const minDiv=settings.mindiv||0;const zoneFilter=settings.zone||'all';let list=STOCKS.filter(s=>{if(minDiv>0&&(s.dividend||0)<minDiv)return false;return true;});processed=list.map(s=>{const d25=dv(s.price,s.ma25);const score=calcScore(s);const zone=getZone(score);const ma75d=s.ma75?dv(s.price,s.ma75):0;const mc=s.market_cap_b||0;const div=s.dividend||0;let _type='neutral';if(ma75d<-8)_type='falling';else if(ma75d<-2&&mc>=3000&&div>=2.5)_type='value_dip';else if(-5<=ma75d&&ma75d<=3&&d25<-1)_type='dip';else if(ma75d>0&&d25>0&&mc>=1000)_type='momentum';else if(ma75d>=-2&&d25>0)_type='bounce';return{...s,d25,score,zone,_type,ma75d};});if(zoneFilter==='buy')processed=processed.filter(s=>s.zone.cls==='buy');else if(zoneFilter==='buywatch')processed=processed.filter(s=>s.zone.cls!=='hold');processed.sort((a,b)=>b.score-a.score);requestAnimationFrame(()=>{const now=new Date();scanHistory.unshift({date:`${now.getMonth()+1}/${now.getDate()} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`,mode:currentMode,count:processed.length,top:processed[0]?.name||'â€”'});scanHistory=scanHistory.slice(0,14);try{localStorage.setItem('kbs_history',JSON.stringify(scanHistory));}catch(e){}});}

function renderHeroStats(){const buyN=processed.filter(s=>s.zone.cls==='buy').length;const topScore=processed.length?processed[0].score:'â€”';const maxDiv=processed.length?Math.max(...processed.map(s=>s.dividend)).toFixed(1)+'%':'â€”';document.getElementById('hsBuy').textContent=buyN+'ä»¶';document.getElementById('hsTop').textContent=topScore+'pt';document.getElementById('hsDiv').textContent=maxDiv;document.getElementById('hsTotal').textContent=STOCKS.length;}
function renderPulse(){const md=marketData;const sign=v=>v>0?'+':'';const dir=v=>v>0?'up':v<0?'dn':'neutral';const chips=[{l:'æ—¥çµŒå¹³å‡',v:md.nikkei_price?md.nikkei_price.toLocaleString():'â€”',c:md.nikkei_1d_chg!=null?sign(md.nikkei_1d_chg)+md.nikkei_1d_chg+'%':'â€”',d:dir(md.nikkei_1d_chg)},{l:'NASDAQ',v:md.nasdaq_1d_chg!=null?sign(md.nasdaq_1d_chg)+md.nasdaq_1d_chg+'%':'â€”',c:'å‰æ—¥æ¯”',d:dir(md.nasdaq_1d_chg)},{l:'ãƒ‰ãƒ«å††',v:md.usdjpy||'â€”',c:'',d:'neutral'},{l:'VIX',v:md.vix||'â€”',c:'',d:md.vix>25?'dn':md.vix<18?'up':'neutral'},{l:'ç±³10å¹´å‚µ',v:md.us10y?md.us10y+'%':'â€”',c:'',d:'neutral'}];document.getElementById('pulseBar').innerHTML=chips.map(c=>`<div class="pc"><div class="pc-l">${c.l}</div><div class="pc-v ${c.d}">${c.v}</div><div class="pc-c ${c.d}">${c.c}</div></div>`).join('');}

function calcStanceScore(){const md=marketData;const buyN=processed.filter(s=>s.zone.cls==='buy').length;const avgRsi=processed.length?(processed.reduce((a,s)=>a+s.rsi,0)/processed.length):50;const avgD25=processed.length?(processed.reduce((a,s)=>a+s.d25,0)/processed.length):0;const highDiv=processed.filter(s=>s.dividend>=4).length;let axes={tech:1,macro:1,scan:0};let t=1;if(md.nikkei_price&&md.nikkei_ma25){if(md.nikkei_price>=md.nikkei_ma25)t++;else t--;}if(md.nikkei_1d_chg!=null){if(md.nikkei_1d_chg>-1)t++;else if(md.nikkei_1d_chg<-1.5)t--;}if(md.vix){if(md.vix<20)t++;else if(md.vix>25)t--;}if(md.usdjpy){if(md.usdjpy>=147)t++;else if(md.usdjpy<140)t--;}axes.tech=Math.max(0,Math.min(t,3));let m=1;if(md.nasdaq_1d_chg!=null){if(md.nasdaq_1d_chg>0.5)m++;else if(md.nasdaq_1d_chg<-1.5)m-=2;else if(md.nasdaq_1d_chg<0)m--;}if(md.us10y){if(md.us10y>=3.5&&md.us10y<=4.5)m++;else if(md.us10y>5)m--;}if(md.geo_risk)m-=2;if(md.rate_cut_flag)m++;axes.macro=Math.max(0,Math.min(m,3));let sc=0;if(buyN>=5)sc+=2;else if(buyN>=3)sc+=1;if(avgRsi<=35)sc++;else if(avgRsi<=42)sc+=0.5;if(avgD25<=-4)sc++;if(md.prev_buy_count!=null&&buyN>md.prev_buy_count)sc++;axes.scan=Math.max(0,Math.min(Math.round(sc),3));return{total:axes.tech+axes.macro+axes.scan,axes,buyN,watchN:processed.filter(s=>s.zone.cls==='watch').length,avgRsi:avgRsi.toFixed(1),avgD25:avgD25.toFixed(1),highDiv};}

function renderStance(){const{total,axes,buyN,watchN,avgRsi,avgD25,highDiv}=calcStanceScore();const now=new Date();const days=['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];const md=marketData;const hasMacro=dataSource==='real'&&md.nikkei_price;let stance,icon,label,title,reason;if(total>=7){stance='bull';icon='ğŸŸ¢';label='å¼·æ°—';title='ä»Šæ—¥ã¯è²·ã„ã‚„ã™ã„åœ°åˆã„';reason=hasMacro?`<strong>${total}/9pt</strong>ã€‚æ—¥çµŒ${md.nikkei_1d_chg>0?'+':''}${md.nikkei_1d_chg}%ãƒ»NASDAQ${md.nasdaq_1d_chg>0?'+':''}${md.nasdaq_1d_chg}%ã€‚è²·ã„åœ<strong>${buyN}éŠ˜æŸ„</strong>ã€RSI<strong>${avgRsi}</strong>ã€‚`:`è²·ã„åœ<strong>${buyN}éŠ˜æŸ„</strong>ã€RSI<strong>${avgRsi}</strong>ã€MAä¹–é›¢<strong>${avgD25}%</strong>ã€‚`;}else if(total>=4){stance='neutral';icon='ğŸŸ¡';label='ä¸­ç«‹';title='ä»Šæ—¥ã¯éŠ˜æŸ„ã‚’é¸ã¶æ—¥';reason=hasMacro?`<strong>${total}/9pt</strong>ã€‚è²·ã„åœ<strong>${buyN}</strong>ã€æ³¨æ„åœ<strong>${watchN}</strong>ã€‚ã‚¹ã‚³ã‚¢ä¸Šä½ã«çµã£ã¦ã€‚`:`è²·ã„åœ<strong>${buyN}éŠ˜æŸ„</strong>ã€RSI<strong>${avgRsi}</strong>ã€‚60ptä»¥ä¸Šã«çµã£ã¦ã€‚`;}else{stance='bear';icon='ğŸ”´';label='å¼±æ°—';title='ä»Šæ—¥ã¯æ§˜å­è¦‹ãŒç„¡é›£';reason=hasMacro?`<strong>${total}/9pt</strong>ã€‚${md.nasdaq_1d_chg<-1?`NASDAQ${md.nasdaq_1d_chg}%ã€‚`:''}è²·ã„åœ<strong>${buyN}</strong>ã€‚æŠ¼ã—ç›®ãŒæµ…ã„ã€‚`:`è²·ã„åœ<strong>${buyN}éŠ˜æŸ„</strong>ã€MAä¹–é›¢<strong>${avgD25}%</strong>ã€‚æ¬¡ã®ä¸‹è½ã‚’å¾…ã¤ã€‚`;}
const axB=(n,s,i)=>`<div class="axis-row"><div class="axis-name">${i} ${n}</div><div class="axis-bar">${[0,1,2].map(j=>`<div class="axis-seg ${j<s?'on':''} ${s>=2?'hi':'mid'}"></div>`).join('')}</div><div class="axis-score">${s}/3</div></div>`;
const chips=[{l:'è²·ã„åœ',v:buyN+'éŠ˜æŸ„',c:buyN>=5?'buy':buyN>=3?'warn':''},{l:'RSI',v:avgRsi,c:parseFloat(avgRsi)<=35?'buy':parseFloat(avgRsi)<=45?'warn':''},{l:'MAä¹–é›¢',v:avgD25+'%',c:parseFloat(avgD25)<=-4?'buy':parseFloat(avgD25)<=-2?'warn':''},{l:'é«˜é…å½“4%â†‘',v:highDiv+'ä»¶',c:highDiv>=3?'buy':highDiv>=1?'warn':''}];
document.getElementById('stanceBox').innerHTML=`<div class="stance fadein"><div class="stance-flex"><div class="stance-left"><div class="stance-badge ${stance}">${icon} ${label}</div><div class="stance-title">${title}</div><div class="stance-reason">${reason}</div><div class="stance-chips">${chips.map(c=>`<div class="stance-chip ${c.c}"><div class="stance-chip-val">${c.v}</div><div class="stance-chip-label">${c.l}</div></div>`).join('')}</div></div><div class="stance-right"><div class="stance-axes">${axB('ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«',axes.tech,'ğŸ“Š')}${axB('ãƒã‚¯ãƒ­',axes.macro,'ğŸŒ')}${axB('ã‚¹ã‚­ãƒ£ãƒ³',axes.scan,'ğŸ”')}<div class="axis-total">${total}/9pt</div></div><div class="stance-date">${now.getMonth()+1}/${now.getDate()}(${days[now.getDay()]})</div></div></div></div>`;}

// BRAIN SCANNER
async function loadBrainScanner(){try{const res=await fetch('sentiment_latest.json?t='+Date.now());if(!res.ok)throw new Error('not found');const data=await res.json();renderBrainScanner(data);document.getElementById('brainSection').style.display='block';}catch(e){console.log('Brain Scanner: sentiment_latest.json not available');}}
function renderBrainScanner(data){const body=document.getElementById('brainBody');const layers={macro:{title:'MACRO',cls:'macro',items:[]},institutional:{title:'INSTITUTIONAL',cls:'inst',items:[]},retail:{title:'RETAIL',cls:'retail',items:[]}};(data.topics||[]).forEach(t=>{const layer=layers[t.layer]||layers.retail;layer.items.push(t);});
let overallScore=0,count=0;(data.topics||[]).forEach(t=>{overallScore+=t.score;count++;});const avg=count?overallScore/count:0;const avgPct=Math.round(avg*100);const cls=avg>=0.1?'pos':avg<=-0.1?'neg':'neu';const barW=Math.min(Math.abs(avgPct),100);const barClr=avg>=0?'var(--green)':'var(--red)';
let html=`<div class="brain-overall"><div><div class="brain-overall-label">ç·åˆã‚»ãƒ³ãƒãƒ¡ãƒ³ãƒˆ</div><div class="brain-overall-val ${cls}">${avgPct>0?'+':''}${avgPct}</div></div><div class="brain-overall-bar"><div class="brain-overall-fill" style="width:${barW}%;background:${barClr}"></div></div></div>`;
html+='<div class="brain-grid">';
for(const[key,layer] of Object.entries(layers)){if(!layer.items.length)continue;const sorted=layer.items.sort((a,b)=>Math.abs(b.score)-Math.abs(a.score));html+=`<div><div class="brain-col-title ${layer.cls}">${layer.title}</div>${sorted.map(t=>{const pct=Math.round(t.score*100);const c=t.score>=0.1?'pos':t.score<=-0.1?'neg':'neu';return`<div class="brain-item"><div class="brain-topic">${t.topic}</div><div class="brain-score ${c}">${pct>0?'+':''}${pct}</div></div>`;}).join('')}</div>`;}
html+='</div>';
if(data.summary)html+=`<div class="brain-summary">${data.summary}</div>`;
body.innerHTML=html;}

// 3-TAB SYSTEM
function setTop5Tab(tab){currentTab=tab;activeSector=null;document.querySelectorAll('.t5-tab').forEach(t=>t.classList.remove('active'));const tabEl={sector:'t5TabSec',mom:'t5TabMom',dip:'t5TabDip'}[tab];if(tabEl)document.getElementById(tabEl).classList.add('active');document.getElementById('t5TabSec').textContent='ğŸ“Š ã‚»ã‚¯ã‚¿ãƒ¼';renderTop10();gaEvent('tab_changed',{tab});}
function renderTop10(){if(currentTab==='sector'){if(activeSector)showSectorStocks(activeSector);else renderSectorTrend();}else if(currentTab==='mom'){const moms=processed.filter(s=>{const m75=s.ma75d||0;return(m75>-2&&s.d25>-2&&(s.market_cap_b||0)>=500&&s.score>=20);}).sort((a,b)=>b.score-a.score).slice(0,10);renderTop10Items(moms);}else{const dips=processed.filter(s=>s.d25<-2&&(s.dividend||0)>=2.0&&(s.market_cap_b||0)>=500&&s.score>=20).sort((a,b)=>b.score-a.score).slice(0,10);renderTop10Items(dips);}}
function renderSectorTrend(){const body=document.getElementById('top5Body');const SEC_MAP={'Technology':{jp:'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼',ico:'ğŸ’»'},'Financial Services':{jp:'é‡‘è',ico:'ğŸ¦'},'Communication Services':{jp:'é€šä¿¡',ico:'ğŸ“¡'},'Consumer Cyclical':{jp:'æ¶ˆè²»ï¼ˆæ™¯æ°—æ•æ„Ÿï¼‰',ico:'ğŸ›’'},'Industrials':{jp:'ç”£æ¥­ãƒ»è³‡æœ¬è²¡',ico:'ğŸ­'},'Consumer Defensive':{jp:'æ¶ˆè²»ï¼ˆå®‰å®šï¼‰',ico:'ğŸ™'},'Energy':{jp:'ã‚¨ãƒãƒ«ã‚®ãƒ¼',ico:'â›½'},'Basic Materials':{jp:'ç´ æ',ico:'ğŸ§±'},'Healthcare':{jp:'ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢',ico:'ğŸ’Š'},'Utilities':{jp:'å…¬ç›Š',ico:'ğŸ’¡'},'Real Estate':{jp:'ä¸å‹•ç”£',ico:'ğŸ '}};const secMap={};processed.forEach(s=>{const sec=s.sector||'ãã®ä»–';if(!secMap[sec])secMap[sec]={count:0,buyCount:0,topScore:0};secMap[sec].count++;if(s.zone&&s.zone.cls==='buy')secMap[sec].buyCount++;if(s.score>secMap[sec].topScore)secMap[sec].topScore=s.score;});const sorted=Object.entries(secMap).map(([name,data])=>({name,...data,jp:(SEC_MAP[name]||{}).jp||name,ico:(SEC_MAP[name]||{}).ico||'ğŸ“Š'})).filter(d=>d.count>=3).sort((a,b)=>b.buyCount-a.buyCount||b.topScore-a.topScore);if(!sorted.length){body.innerHTML='<div style="padding:16px;text-align:center;font-size:11px;color:var(--text-dim)">ã‚»ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãªã—</div>';return;}body.innerHTML=`<div class="sec-grid fadein">${sorted.map(d=>`<div class="sec-tile" onclick="showSectorStocks('${d.name}')"><div class="sec-tile-ico">${d.ico}</div><div class="sec-tile-name">${d.jp}</div><div class="sec-tile-sub">${d.buyCount>0?d.buyCount+'éŠ˜æŸ„ãŒè²·ã„åœ':d.count+'éŠ˜æŸ„'}</div></div>`).join('')}</div>`;}
function showSectorStocks(secName){activeSector=secName;const SEC_JP={'Technology':'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼','Financial Services':'é‡‘è','Communication Services':'é€šä¿¡','Consumer Cyclical':'æ¶ˆè²»ï¼ˆæ™¯æ°—æ•æ„Ÿï¼‰','Industrials':'ç”£æ¥­ãƒ»è³‡æœ¬è²¡','Consumer Defensive':'æ¶ˆè²»ï¼ˆå®‰å®šï¼‰','Energy':'ã‚¨ãƒãƒ«ã‚®ãƒ¼','Basic Materials':'ç´ æ','Healthcare':'ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢','Utilities':'å…¬ç›Š','Real Estate':'ä¸å‹•ç”£'};document.getElementById('t5TabSec').textContent=(SEC_JP[secName]||secName)+' âœ•';const stocks=processed.filter(s=>(s.sector||'')==secName).sort((a,b)=>b.score-a.score).slice(0,10);const body=document.getElementById('top5Body');const back=`<div class="sec-back-btn" onclick="activeSector=null;setTop5Tab('sector')">â† ä¸€è¦§</div>`;if(!stocks.length){body.innerHTML=back+'<div style="padding:12px;text-align:center;font-size:10px;color:var(--text-dim)">è©²å½“ãªã—</div>';return;}body.innerHTML=back+`<div class="top10-cards fadein">${stocks.map((s,i)=>renderCard(s,i+1)).join('')}</div>`;}
function renderCard(s,rank){const sc=s.score>=60?'hi':'mid';const divB=(s.dividend||0)>=2.5?`<span class="top10-badge div">ğŸ’°${s.dividend}%</span>`:'';const momB=s._type==='momentum'?`<span class="top10-badge mom">â†—ä¸Šæ˜‡</span>`:'';const mc=s.market_cap_b?(s.market_cap_b>=10000?(s.market_cap_b/10000).toFixed(1)+'å…†':Math.round(s.market_cap_b)+'å„„'):'';const d75=s.ma75d!=null?`75æ—¥${s.ma75d>0?'+':''}${s.ma75d.toFixed(1)}%`:'';return`<div class="top10-card" onclick="window.open('https://finance.yahoo.co.jp/quote/${s.code}.T','_blank')"><div class="top10-rank${rank<=3?' top':''}">${rank}</div><div class="top10-info"><div class="top10-name">${s.name}</div><div class="top10-meta">${s.code} Â· ${s.sector||''} Â· ${mc}${d75?' Â· '+d75:''}</div></div><div class="top10-right"><div class="top10-score ${sc}">${s.score}pt</div>${divB}${momB}</div></div>`;}
function renderTop10Items(items){const body=document.getElementById('top5Body');if(!items.length){body.innerHTML='<div style="padding:16px;text-align:center;font-size:11px;color:var(--text-dim)">è©²å½“éŠ˜æŸ„ãªã—</div>';return;}body.innerHTML=`<div class="top10-cards fadein">${items.map((s,i)=>renderCard(s,i+1)).join('')}</div>`;}

// PORTFOLIO
async function loadPortfolio(){try{const res=await fetch('portfolio.json?t='+Date.now());if(res.ok)portfolioData=await res.json();}catch(e){}renderPortfolio();}
function renderPortfolio(){const body=document.getElementById('portfolioBody');if(!body)return;if(!portfolioData||!portfolioData.daily_nav||portfolioData.daily_nav.length<=1){body.innerHTML=`<div style="padding:16px;text-align:center"><div style="font-size:28px;margin-bottom:6px">ğŸš€</div><div style="font-size:12px;font-weight:700;color:var(--text-hi);margin-bottom:4px">1000ä¸‡å††ã§é‹ç”¨é–‹å§‹</div><div style="font-size:10px;color:var(--text-dim);margin-bottom:10px">AIãŒã‚¹ã‚³ã‚¢ã«åŸºã¥ã„ã¦è‡ªå‹•å£²è²·ã€‚æ¯æ—¥æ›´æ–°ã€‚</div><a class="pf-note-link" href="https://note.com/kabunosuke_navi" target="_blank" rel="noopener">ğŸ“ noteã§èª­ã‚€ â†’</a></div>`;return;}const pf=portfolioData;const nav=pf.daily_nav[pf.daily_nav.length-1];const currentNav=nav.nav;const pnl=currentNav-pf.initial_capital;const pnlPct=(pnl/pf.initial_capital*100).toFixed(2);const dayCount=pf.daily_nav.length;const posCount=(pf.positions||[]).length;const cashPct=Math.round(pf.cash/currentNav*100);const stockPct=100-cashPct;const pnlCls=pnl>=0?'up':'dn';const pnlSign=pnl>=0?'+':'';const holdingsHtml=posCount?(pf.positions||[]).map(p=>{const pc=(p.pnl_pct||0)>=0?'up':'dn';return`<div class="pf-hold"><div style="flex:1"><div class="pf-hold-name">${p.name}</div><div style="font-size:9px;color:var(--text-dim);font-family:var(--fn)">${p.code} Â· ${p.shares}æ ª</div></div><div class="pf-hold-pnl ${pc}">${(p.pnl_pct||0)>=0?'+':''}${(p.pnl_pct||0).toFixed(1)}%</div></div>`;}).join(''):'<div style="font-size:10px;color:var(--text-dim);padding:4px 0">ç¾é‡‘å¾…æ©Ÿä¸­ ğŸ”</div>';let chartHtml='';if(pf.daily_nav.length>=3){const vals=pf.daily_nav.map(d=>d.nav);const mn=Math.min(...vals),mx=Math.max(...vals),rng=mx-mn||1;const w=280,h=36;const pts=vals.map((v,i)=>`${(i/(vals.length-1))*w},${h-((v-mn)/rng)*h*0.8-h*0.1}`).join(' ');const clr=vals[vals.length-1]>=pf.initial_capital?'var(--green)':'var(--red)';chartHtml=`<svg viewBox="0 0 ${w} ${h}" style="width:100%;height:36px;margin:4px 0"><line x1="0" y1="${h-((pf.initial_capital-mn)/rng)*h*0.8-h*0.1}" x2="${w}" y2="${h-((pf.initial_capital-mn)/rng)*h*0.8-h*0.1}" stroke="var(--text-muted)" stroke-dasharray="3,3" stroke-width="0.5" opacity="0.4"/><polyline points="${pts}" fill="none" stroke="${clr}" stroke-width="1.5"/></svg>`;}body.innerHTML=`<div class="pf-hero"><div class="pf-nav">Â¥${currentNav.toLocaleString()}</div><div class="pf-pnl ${pnlCls}">${pnlSign}${pnlPct}%</div><div class="pf-day">Day ${dayCount}</div></div><div class="pf-bars"><div class="pf-bar cash" style="flex:${cashPct}">ğŸ’´ ${cashPct}%</div>${posCount?`<div class="pf-bar stock" style="flex:${stockPct}">ğŸ“ˆ ${stockPct}%</div>`:''}</div>${chartHtml}<div style="font-size:10px;font-weight:700;color:var(--text-hi);margin:6px 0 3px;font-family:var(--fn)">HOLDINGS (${posCount})</div><div class="pf-holdings">${holdingsHtml}</div><a class="pf-note-link" href="https://note.com/kabunosuke_navi" target="_blank" rel="noopener">ğŸ“ noteã§èª­ã‚€ â†’</a><div style="font-size:8px;color:var(--text-muted);margin-top:6px;text-align:center">â€»ä»®æƒ³æŠ•è³‡ã§ã™</div>`;}

// SETTINGS
function openSettings(){document.querySelectorAll('#set-mode .setting-opt').forEach(o=>o.classList.toggle('active',o.dataset.val===settings.mode));document.querySelectorAll('#set-count .setting-opt').forEach(o=>o.classList.toggle('active',o.dataset.val===String(settings.count)));document.querySelectorAll('#set-mindiv .setting-opt').forEach(o=>o.classList.toggle('active',o.dataset.val===String(settings.mindiv)));document.querySelectorAll('#set-zone .setting-opt').forEach(o=>o.classList.toggle('active',o.dataset.val===settings.zone));document.getElementById('settingsOverlay').classList.add('open');}
function closeSettingsBg(e){if(e.target===document.getElementById('settingsOverlay'))document.getElementById('settingsOverlay').classList.remove('open');}
function selectSettingOpt(el,group){document.querySelectorAll(`#set-${group} .setting-opt`).forEach(o=>o.classList.remove('active'));el.classList.add('active');}
function saveSettings(){settings.mode=document.querySelector('#set-mode .setting-opt.active')?.dataset.val||'dividend';settings.count=parseInt(document.querySelector('#set-count .setting-opt.active')?.dataset.val||'30');settings.mindiv=parseFloat(document.querySelector('#set-mindiv .setting-opt.active')?.dataset.val||'0');settings.zone=document.querySelector('#set-zone .setting-opt.active')?.dataset.val||'all';try{localStorage.setItem('kbs_settings',JSON.stringify(settings));}catch(e){}currentMode=settings.mode;document.getElementById('settingsOverlay').classList.remove('open');run();}

// WATCHLIST
function toggleFav(code){if(!watchlist.includes(code))watchlist.push(code);else watchlist=watchlist.filter(c=>c!==code);try{localStorage.setItem('kbs_watch',JSON.stringify(watchlist));}catch(e){}updateWatchCount();renderWatchlist();}
function updateWatchCount(){const el=document.getElementById('watchCount');el.textContent=watchlist.length;el.classList.toggle('show',watchlist.length>0);}
function renderWatchlist(){updateWatchCount();const el=document.getElementById('watchlistBody');if(!watchlist.length){el.innerHTML='<div class="watch-empty">éŠ˜æŸ„ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã‚¦ã‚©ãƒƒãƒç™»éŒ²</div>';return;}el.innerHTML=`<div class="watch-list">${watchlist.map(code=>{const s=STOCKS.find(x=>x.code===code);if(!s)return'';const score=calcScore(s);const sc=score>=60?'hi':score>=35?'md':'lo';const d25=dv(s.price,s.ma25);return`<div class="watch-row" onclick="window.open('https://finance.yahoo.co.jp/quote/${code}.T','_blank')"><div class="watch-code">${code}</div><div class="watch-name">${s.name}</div><div style="text-align:right"><div class="watch-score ${sc}">${score}pt</div><div style="font-size:9px;color:var(--text-dim);font-family:var(--fn)">${d25>0?'+':''}${d25}%</div></div><button class="watch-remove" onclick="event.stopPropagation();toggleFav('${code}')">âœ•</button></div>`;}).join('')}</div>`;}
function renderHistory(){const el=document.getElementById('historyBody');const mn={dividend:'é«˜é…å½“',value:'ãƒãƒªãƒ¥ãƒ¼',rebound:'æŠ¼ã—ç›®'};if(!scanHistory.length){el.innerHTML='<div class="watch-empty">ã‚¹ã‚­ãƒ£ãƒ³å±¥æ­´ãªã—</div>';return;}el.innerHTML=`<table class="hist-table"><tr><th>TIME</th><th>MODE</th><th>N</th><th>TOP</th></tr>${scanHistory.slice(0,7).map(h=>`<tr><td>${h.date}</td><td>${mn[h.mode]||h.mode}</td><td>${h.count}</td><td>${h.top}</td></tr>`).join('')}</table>`;}

function switchTab(tab){document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));document.getElementById('panel-'+tab).classList.add('active');const n=document.getElementById('nav-'+tab);if(n)n.classList.add('active');if(tab==='watch'){renderWatchlist();renderHistory();}}
function openLogicModal(){document.getElementById('logicModal').classList.add('open');}
function closeLogicModal(e){if(!e||e.target===document.getElementById('logicModal'))document.getElementById('logicModal').classList.remove('open');}

async function loadRealData(){try{const r=await fetch('stocks_data.json?t='+Date.now());if(!r.ok)throw new Error('fail');const j=await r.json();if(j.stocks&&j.stocks.length>0){STOCKS=j.stocks;dataSource='real';['nikkei_price','nikkei_ma25','nikkei_1d_chg','nasdaq_1d_chg','vix','usdjpy','us10y','geo_risk','rate_cut_flag','prev_buy_count'].forEach(k=>{if(j[k]!==undefined)marketData[k]=j[k];});if(j.trend_ranking)trendRankingData=j.trend_ranking;if(j.sector_scores)sectorScoresData=j.sector_scores;document.getElementById('trustText').innerHTML=`<span class="hi">${j.updated_at}</span> Â· ${j.total}éŠ˜æŸ„`;document.getElementById('trustDot').style.background='var(--green)';document.getElementById('totalCountBadge').textContent=j.total+'éŠ˜æŸ„';document.getElementById('heroEyebrow').innerHTML='ğŸ“¡ å®Ÿãƒ‡ãƒ¼ã‚¿ Â· æ¯æœ8:30æ›´æ–°';}else throw new Error('no stocks');}catch{dataSource='sample';STOCKS=[...SAMPLE_STOCKS];document.getElementById('trustText').innerHTML='<span class="warn">SAMPLE</span> â€” å®Ÿãƒ‡ãƒ¼ã‚¿ã¯æ¯æœ8:30';document.getElementById('trustDot').style.background='var(--amber)';}}

function run(){processStocks();renderHeroStats();renderPulse();renderTop10();requestAnimationFrame(()=>{renderStance();});}
async function init(){updateWatchCount();await loadRealData();run();loadPortfolio();loadBrainScanner();}
init();
</script>
</body>
</html>
