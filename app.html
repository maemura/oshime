<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‹ã¶ã®ã™ã‘ â€” é«˜é…å½“æ ªã®è²·ã„å ´ã‚’æ¯æ—¥ã‚¹ã‚­ãƒ£ãƒ³</title>
<meta name="description" content="æ±è¨¼ãƒ—ãƒ©ã‚¤ãƒ 1,600éŠ˜æŸ„ã‚’æ¯æœè‡ªå‹•ã‚¹ã‚­ãƒ£ãƒ³ã€‚æŠ¼ã—ç›®ã‚¹ã‚³ã‚¢ã§ä»Šæ—¥ã®è²·ã„å ´ã‚’å³æ¤œå‡ºã€‚">
<meta property="og:title" content="ã‹ã¶ã®ã™ã‘ â€” é«˜é…å½“æ ªã®è²·ã„å ´ã‚’æ¯æœã‚¹ã‚­ãƒ£ãƒ³">
<meta property="og:description" content="æ±è¨¼ãƒ—ãƒ©ã‚¤ãƒ 1,600éŠ˜æŸ„ã‚’æ¯æœ7:30ã«è‡ªå‹•ã‚¹ã‚­ãƒ£ãƒ³ã€‚6ãƒ¶æœˆãƒˆãƒ¬ãƒ³ãƒ‰Ã—MA75ã§ä»Šæ—¥ã®æŠ¼ã—ç›®TOP5ã‚’å³è¡¨ç¤ºã€‚">
<meta property="og:image" content="https://oshime.vercel.app/ogp.png">
<meta property="og:url" content="https://oshime.vercel.app/app.html">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@kabunosuke_navi">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DWW0W11P5T"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-DWW0W11P5T');function gaEvent(n,p){if(typeof gtag!=='undefined')gtag('event',n,p||{});}</script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#F0F3F7;--card:#FFF;--border:#E3E8EE;--border-l:#F1F5F9;
  --blue:#003D99;--blue-m:#1B6AC9;--blue-l:#E8F0FB;--blue-tab:#0056C4;
  --navy:#0A1628;--navy-bar:#1A2744;
  --green:#059669;--green-bg:#ECFDF5;
  --red:#DC2626;--red-bg:#FEF2F2;
  --amber:#D97706;--amber-bg:#FFFBEB;
  --purple:#7C3AED;--purple-bg:#F5F3FF;
  --text:#1A1A1A;--text2:#4A5568;--text3:#8E99A8;
  --sh:0 1px 4px rgba(0,0,0,0.04),0 2px 8px rgba(0,0,0,0.04);
  --sh-m:0 2px 8px rgba(0,0,0,0.06),0 4px 16px rgba(0,0,0,0.04);
  --r:14px;
  --f:-apple-system,BlinkMacSystemFont,'Hiragino Sans','Hiragino Kaku Gothic ProN','ãƒ¡ã‚¤ãƒªã‚ª',Meiryo,'Yu Gothic',sans-serif;
  --fn:'DM Sans',-apple-system,sans-serif;
}
body{font-family:var(--f);background:var(--bg);color:var(--text);max-width:960px;margin:0 auto;padding-bottom:72px;-webkit-font-smoothing:antialiased;line-height:1.6;}
a{color:var(--blue-m);text-decoration:none;}

/* LOGO + TICKER */
.logo-bar{background:var(--navy-bar);padding:8px 16px;display:flex;align-items:center;position:sticky;top:0;z-index:100;}
.logo{font-family:var(--fn);font-size:16px;font-weight:800;color:#fff;letter-spacing:-0.03em;flex-shrink:0;}
.logo span{color:#4ADE80;}
.ticker{display:flex;flex:1;margin-left:16px;}
.ticker-item{text-align:center;flex:1;}
.ticker-lbl{font-size:9px;color:rgba(255,255,255,0.5);font-weight:500;}
.ticker-val{font-family:var(--fn);font-size:14px;font-weight:800;color:#fff;letter-spacing:-0.03em;line-height:1.3;}
.ticker-chg{font-family:var(--fn);font-size:10px;font-weight:700;}
.ticker-chg.up{color:#4ADE80;}.ticker-chg.dn{color:#F87171;}

/* HERO */
.hero{background:var(--card);border-radius:var(--r);margin:10px 12px;padding:22px 20px;box-shadow:var(--sh-m);border-left:5px solid var(--blue);}
.hero-date{font-size:11px;color:var(--text3);margin-bottom:6px;}
.hero-hl{font-size:20px;font-weight:800;color:var(--text);line-height:1.5;margin-bottom:10px;}
.hero-hl em{font-style:normal;color:var(--blue-m);}
.stance{display:inline-flex;align-items:center;gap:5px;padding:5px 13px;border-radius:20px;font-size:12px;font-weight:700;}
.stance.bear{background:var(--red-bg);color:var(--red);}.stance.bull{background:var(--green-bg);color:var(--green);}.stance.neutral{background:var(--amber-bg);color:var(--amber);}
.hero-chips{display:flex;gap:6px;margin-top:10px;flex-wrap:wrap;}
.hero-chip{padding:4px 11px;border-radius:20px;font-size:11px;font-weight:600;background:var(--blue-l);color:var(--blue);}
.hero-stats{display:flex;gap:12px;margin-top:14px;padding-top:12px;border-top:1px solid var(--border);}
.hero-stat{text-align:center;flex:1;}
.hero-stat b{font-family:var(--fn);font-size:22px;font-weight:800;display:block;letter-spacing:-0.03em;}
.hero-stat small{font-size:10px;color:var(--text3);}

/* TOP5 */
.t5-sec{margin:10px 12px;}
.t5-tabs{display:flex;background:var(--card);border-radius:var(--r) var(--r) 0 0;box-shadow:var(--sh);overflow:hidden;}
.t5-tab{flex:1;padding:11px 0;text-align:center;font-size:13px;font-weight:700;cursor:pointer;border-bottom:3px solid transparent;color:var(--text3);transition:all .15s;background:var(--card);}
.t5-tab.active{color:var(--blue);border-bottom-color:var(--blue);}
.t5-body{background:var(--card);border-radius:0 0 var(--r) var(--r);box-shadow:var(--sh);}
.t5-item{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .1s;}
.t5-item:last-child{border-bottom:none;}.t5-item:active{background:var(--blue-l);}
.t5-rank{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--fn);font-size:13px;font-weight:800;background:var(--bg);color:var(--text2);flex-shrink:0;}
.t5-rank.gold{background:linear-gradient(135deg,#F59E0B,#D97706);color:#fff;}
.t5-info{flex:1;min-width:0;}
.t5-nm{font-size:14px;font-weight:700;line-height:1.4;}
.t5-meta{font-family:var(--fn);font-size:11px;color:var(--text3);margin-top:1px;}
.t5-spark{flex-shrink:0;width:80px;height:36px;}
.t5-right{text-align:right;flex-shrink:0;min-width:56px;}
.t5-sc{font-family:var(--fn);font-size:20px;font-weight:800;line-height:1.2;}
.t5-sc span{font-size:11px;font-weight:500;color:var(--text3);}
.t5-gauge{width:48px;height:4px;background:var(--border);border-radius:2px;margin:4px 0 3px auto;overflow:hidden;}
.t5-gauge-fill{height:100%;border-radius:2px;}
.t5-type{font-size:9px;font-weight:700;padding:2px 7px;border-radius:10px;display:inline-block;}
.t5-type.dip{background:var(--green-bg);color:var(--green);}
.t5-type.mom{background:var(--blue-l);color:var(--blue);}
.t5-reason{font-size:11px;color:var(--text2);margin-top:3px;line-height:1.5;}
/* é…å½“ãƒãƒƒã‚¸ */
.div-badge{display:inline-flex;align-items:center;gap:2px;padding:2px 8px;border-radius:10px;font-family:var(--fn);font-size:11px;font-weight:800;background:var(--green-bg);color:var(--green);border:1px solid rgba(5,150,105,0.15);}
/* PC 2ã‚«ãƒ©ãƒ ã‚°ãƒªãƒƒãƒ‰ */
@media(min-width:700px){
  .t5-grid{display:grid;grid-template-columns:1fr 1fr;}
  .t5-grid .t5-item{border-right:1px solid var(--border);}
  .t5-grid .t5-item:nth-child(2n){border-right:none;}
  .t5-grid .t5-expand{grid-column:1/-1;}
  .t5-spark{width:120px;height:44px;}
  .t5-sc{font-size:22px;}
  .t5-nm{font-size:14px;}
  .div-badge{font-size:12px;padding:3px 10px;}
}

/* SHARE */
.share{margin:10px 12px;display:flex;gap:8px;}
.share-btn{flex:1;padding:10px;border-radius:10px;text-align:center;font-size:12px;font-weight:700;cursor:pointer;border:none;font-family:var(--f);}
.share-btn.x{background:#0F1419;color:#fff;}.share-btn.line{background:#06C755;color:#fff;}.share-btn.copy{background:var(--card);color:var(--text2);border:1px solid var(--border);}

/* DANGER */
.danger{background:var(--red-bg);border-radius:var(--r);margin:10px 12px;padding:16px;border:1px solid #FDCFC4;}
.danger-ttl{font-size:12px;font-weight:700;color:var(--red);margin-bottom:8px;}
.danger-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(220,38,38,0.08);font-size:12px;}
.danger-row:last-child{border-bottom:none;}
.danger-nm{font-weight:700;}.danger-cd{font-family:var(--fn);font-size:10px;color:var(--text3);}
.danger-badge{font-size:10px;color:var(--red);font-weight:600;background:rgba(220,38,38,0.08);padding:2px 7px;border-radius:4px;}

/* AD */
.ad{margin:10px 12px;border-radius:var(--r);background:linear-gradient(135deg,var(--navy-bar),#2A4068);padding:16px 18px;display:flex;align-items:center;gap:12px;box-shadow:var(--sh);cursor:pointer;color:#fff;}
.ad-t{font-size:13px;font-weight:700;margin-bottom:2px;}.ad-d{font-size:10px;opacity:0.7;line-height:1.5;}
.ad-cta{padding:7px 16px;border-radius:8px;font-size:11px;font-weight:700;background:#fff;color:var(--navy-bar);white-space:nowrap;}
.ad-pr{font-size:8px;color:rgba(255,255,255,0.3);margin-top:5px;}

/* FILTER */
.filter-bar{display:flex;align-items:center;gap:8px;flex-wrap:wrap;padding:10px 14px;background:var(--card);border-radius:var(--r);border:1px solid var(--border);margin:10px 12px;box-shadow:var(--sh);}
.f-label{font-size:10px;color:var(--text3);font-weight:600;}
.f-tabs{display:flex;gap:3px;}
.f-tab{padding:4px 12px;border-radius:8px;font-size:11px;font-weight:600;cursor:pointer;color:var(--text2);background:transparent;border:1px solid transparent;transition:all .15s;font-family:var(--f);}
.f-tab:hover{background:var(--bg);}.f-tab.active{background:var(--navy-bar);color:#fff;}

/* TABLE */
.sec-hdr{margin:16px 12px 6px;display:flex;align-items:center;justify-content:space-between;}
.sec-ttl{font-size:15px;font-weight:800;}.sec-act{font-size:11px;color:var(--blue-m);font-weight:700;cursor:pointer;}
.tbl-wrap{background:var(--card);border-radius:var(--r);margin:0 12px 10px;box-shadow:var(--sh);overflow-x:auto;}
.tbl{width:100%;border-collapse:collapse;min-width:420px;}
.tbl thead th{background:var(--blue);color:rgba(255,255,255,0.9);padding:9px 8px;font-size:10px;font-weight:600;text-align:left;cursor:pointer;user-select:none;position:sticky;top:44px;z-index:10;}
.tbl thead th:hover{background:var(--blue-tab);}
.tbl tbody td{padding:10px 8px;border-bottom:1px solid var(--border-l);font-size:12px;vertical-align:middle;}
.tbl tbody tr:nth-child(even){background:#F8FAFC;}
.tbl tbody tr:hover{background:var(--blue-l);}
.tbl tbody tr{cursor:pointer;transition:background .1s;}
.t-nm{font-weight:700;font-size:12px;line-height:1.3;}.t-cd{font-family:var(--fn);font-size:10px;color:var(--text3);}
.t-num{font-family:var(--fn);text-align:right;font-size:12px;color:var(--text2);}
.t-badge{font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;display:inline-block;white-space:nowrap;}
.t-badge.dip{background:var(--green-bg);color:var(--green);}.t-badge.momentum{background:var(--blue-l);color:var(--blue);}
.t-badge.falling{background:var(--red-bg);color:var(--red);}.t-badge.bounce{background:var(--amber-bg);color:var(--amber);}
.t-badge.neutral{background:var(--bg);color:var(--text3);}
.t-sc{font-family:var(--fn);font-weight:800;font-size:14px;}
.t-spark{width:64px;height:28px;}

/* DETAIL BOX */
.detail{background:var(--bg);border-radius:12px;padding:18px;margin:4px 0 8px;border:1px solid var(--border);}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
@media(max-width:600px){.detail-grid{grid-template-columns:1fr;}}
.d-title{font-size:13px;font-weight:700;color:var(--text);margin-bottom:10px;display:flex;align-items:center;gap:6px;}
.chart-box{background:#FAFBFC;border-radius:10px;padding:10px 8px 6px;border:1px solid var(--border);}
.chart-svg{width:100%;display:block;}
.chart-legend{display:flex;gap:12px;padding:6px 0 2px;flex-wrap:wrap;}
.leg-item{display:flex;align-items:center;gap:4px;font-size:10px;color:var(--text2);}
.leg-line{width:14px;height:2px;border-radius:1px;}
.leg-val{font-family:var(--fn);font-weight:700;font-size:10px;}
.ma-rows{display:flex;flex-direction:column;gap:5px;margin-top:10px;}
.ma-row{display:flex;align-items:center;gap:6px;font-size:11px;}
.ma-lbl{min-width:48px;color:var(--text3);font-weight:600;font-size:10px;}
.ma-bar{flex:1;height:16px;background:var(--border-l);border-radius:3px;position:relative;overflow:hidden;}
.ma-dot{position:absolute;top:50%;transform:translate(-50%,-50%);width:8px;height:8px;border-radius:50%;border:2px solid #fff;box-shadow:0 1px 3px rgba(0,0,0,0.2);}
.ma-val{min-width:48px;text-align:right;font-family:var(--fn);font-size:11px;font-weight:700;}
.ma-val.up{color:var(--green);}.ma-val.dn{color:var(--red);}
.price-levels{margin-top:8px;padding-top:8px;border-top:1px solid var(--border);}
.pl-row{display:flex;justify-content:space-between;padding:3px 0;font-size:11px;}
.pl-lbl{color:var(--text2);font-weight:500;}.pl-val{font-family:var(--fn);font-weight:700;}
.signal-box{background:var(--blue-l);border-radius:8px;padding:12px;margin-top:10px;border:1px solid rgba(27,106,201,0.12);}
.signal-ttl{font-size:10px;font-weight:700;color:var(--blue);margin-bottom:4px;}
.signal-txt{font-size:11px;color:var(--text);line-height:1.6;}
.bd-row{display:flex;align-items:center;gap:6px;font-size:11px;margin-bottom:4px;}
.bd-l{min-width:100px;color:var(--text2);font-weight:500;font-size:10px;}
.bd-bar{flex:1;height:5px;background:var(--border-l);border-radius:2px;overflow:hidden;}
.bd-fill{height:100%;border-radius:2px;}
.bd-v{font-family:var(--fn);font-size:10px;font-weight:600;min-width:36px;text-align:right;}
.bd-v.p{color:var(--green);}.bd-v.n{color:var(--red);}
.d-btns{display:flex;gap:6px;margin-top:12px;flex-wrap:wrap;}
.d-btn{padding:6px 14px;border-radius:8px;font-size:11px;font-weight:600;border:1px solid var(--border);background:var(--card);color:var(--text2);cursor:pointer;font-family:var(--f);transition:all .15s;display:inline-flex;align-items:center;text-decoration:none;}
.d-btn:hover{border-color:var(--blue-m);color:var(--blue-m);}
.d-btn.fav{}.d-btn.fav.active{background:var(--blue);color:#fff;border-color:var(--blue);}

/* QUADRANT */
.q-sec{margin:10px 12px;padding:18px;background:var(--card);border-radius:var(--r);box-shadow:var(--sh);}
.q-ttl{font-size:13px;font-weight:700;margin-bottom:12px;}
.q-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;max-width:380px;margin:0 auto;}
.q-cell{padding:14px 10px;border-radius:10px;text-align:center;font-size:10px;color:var(--text2);line-height:1.5;}
.q-cell b{font-size:11px;display:block;margin-bottom:3px;color:var(--text);}
.q-cell.tl{background:var(--blue-l);}.q-cell.tr{background:var(--purple-bg);}
.q-cell.bl{background:var(--bg);}.q-cell.br{background:var(--green-bg);border:2px solid var(--green);position:relative;}
.q-cell.br::after{content:'â˜…';position:absolute;top:5px;right:7px;font-size:10px;color:var(--green);}
.q-ax{text-align:center;font-size:9px;color:var(--text3);font-weight:500;padding:3px;}

/* BOTTOM NAV */
.bnav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);display:flex;justify-content:space-around;padding:5px 0 max(5px,env(safe-area-inset-bottom));z-index:100;max-width:960px;margin:0 auto;}
.bnav a{display:flex;flex-direction:column;align-items:center;gap:1px;font-size:9px;color:var(--text3);text-decoration:none;font-weight:600;padding:3px 8px;}.bnav a.active{color:var(--blue);}
.bnav-i{font-size:18px;line-height:1.2;}

/* MODAL */
.modal-bg{position:fixed;inset:0;background:rgba(15,23,42,0.5);backdrop-filter:blur(3px);z-index:200;display:none;justify-content:center;align-items:center;}
.modal-bg.open{display:flex;}
.modal{background:var(--card);border-radius:16px;padding:24px;max-width:560px;width:90vw;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.15);}
.modal h3{font-size:15px;font-weight:800;margin-bottom:12px;}
.modal p{font-size:12px;line-height:1.8;color:var(--text2);margin-bottom:8px;}
.modal .close-btn{width:100%;margin-top:16px;padding:10px;font-size:13px;background:var(--navy-bar);border:none;color:#fff;border-radius:8px;cursor:pointer;font-family:var(--f);font-weight:700;}
.settings-panel{position:fixed;right:0;top:0;bottom:0;width:300px;max-width:85vw;background:var(--card);box-shadow:-4px 0 20px rgba(0,0,0,0.1);z-index:201;padding:24px;overflow-y:auto;transform:translateX(100%);transition:transform .2s;}
.settings-panel.open{transform:translateX(0);}

/* FOOTER */
.footer{text-align:center;padding:20px 12px;font-size:10px;color:var(--text3);line-height:1.6;}

/* RESPONSIVE */
@media(max-width:600px){
  .ticker-val{font-size:15px;}.hero-hl{font-size:18px;}
  .hero-stat b{font-size:18px;}
}
@media(min-width:600px){.d-grid{grid-template-columns:1fr 1fr;}.d-chart-box{height:150px;}}

/* ANIMATION */
.fadein{animation:fadein .3s ease;}
@keyframes fadein{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€ DETAIL EXPAND (TOP10å†…ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³) â”€â”€ */
.t5-expand{background:var(--bg);padding:16px;border-top:1px solid var(--border);border-left:4px solid var(--blue);animation:fadein .25s ease;}
.d-grid{display:grid;grid-template-columns:1fr;gap:14px;}
.d-sec-ttl{font-size:12px;font-weight:700;color:var(--text);margin-bottom:8px;display:flex;align-items:center;gap:5px;}
.d-chart-box{background:#FAFBFC;border-radius:10px;padding:10px 8px 6px;border:1px solid var(--border);}
.d-chart-svg{width:100%;display:block;}
.d-legend{display:flex;gap:10px;padding:6px 0 2px;flex-wrap:wrap;}
.d-leg{display:flex;align-items:center;gap:3px;font-size:10px;color:var(--text2);}
.d-leg-ln{width:12px;height:2px;border-radius:1px;}
.d-leg b{font-family:var(--fn);font-weight:700;font-size:10px;}
.d-ma{display:flex;flex-direction:column;gap:5px;margin-top:10px;}
.d-ma-row{display:flex;align-items:center;gap:6px;font-size:11px;}
.d-ma-lbl{min-width:90px;color:var(--text2);font-weight:500;font-size:10px;}
.d-ma-bar{flex:1;height:16px;background:var(--border-l);border-radius:3px;position:relative;overflow:hidden;}
.d-ma-ctr{position:absolute;left:50%;top:0;bottom:0;width:1px;background:var(--text3);opacity:0.2;}
.d-ma-dot{position:absolute;top:50%;transform:translate(-50%,-50%);width:8px;height:8px;border-radius:50%;border:2px solid #fff;box-shadow:0 1px 3px rgba(0,0,0,0.2);}
.d-ma-val{min-width:48px;text-align:right;font-family:var(--fn);font-size:11px;font-weight:700;}
.d-ma-val.up{color:var(--green);}.d-ma-val.dn{color:var(--red);}
.d-ma-tag{font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;margin-left:3px;}
.d-ma-tag.near{background:var(--amber-bg);color:var(--amber);}
.d-pl{margin-top:8px;padding-top:8px;border-top:1px solid var(--border);}
.d-pl-row{display:flex;justify-content:space-between;padding:3px 0;font-size:11px;}
.d-pl-lbl{color:var(--text2);font-weight:500;}.d-pl-val{font-family:var(--fn);font-weight:700;}
.d-cards{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:10px;}
.d-card{text-align:center;padding:10px 6px;background:var(--card);border-radius:8px;border:1px solid var(--border);}
.d-card b{font-family:var(--fn);font-size:18px;font-weight:800;display:block;}
.d-card small{font-size:9px;color:var(--text3);}
.d-signal{background:var(--blue-l);border-radius:8px;padding:12px;margin-top:10px;border:1px solid rgba(27,106,201,0.12);}
.d-signal b{font-size:10px;font-weight:700;color:var(--blue);display:block;margin-bottom:4px;}
.d-signal p{font-size:11px;color:var(--text);line-height:1.7;margin:0;}
.d-btns{display:flex;gap:6px;margin-top:12px;flex-wrap:wrap;}
.d-btn{padding:6px 14px;border-radius:8px;font-size:11px;font-weight:600;border:1px solid var(--border);background:var(--card);color:var(--text2);cursor:pointer;font-family:var(--f);transition:all .15s;display:inline-flex;align-items:center;text-decoration:none;}
.d-btn:hover{border-color:var(--blue-m);color:var(--blue-m);}

/* SECTOR CHIPS */
.sector-scroll{overflow-x:auto;margin:0 12px 8px;-webkit-overflow-scrolling:touch;padding:2px 0;}
.sector-scroll::-webkit-scrollbar{display:none;}
.sector-inner{display:flex;gap:5px;}
.s-chip{white-space:nowrap;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;cursor:pointer;color:var(--text2);background:var(--card);border:1px solid var(--border);transition:all .15s;}
.s-chip:hover{border-color:var(--blue-m);}.s-chip.active{background:var(--blue);color:#fff;border-color:var(--blue);}
</style>
</head>
<body>

<!-- LOGO + TICKER -->
<div class="logo-bar">
  <div class="logo">ã‹ã¶ã®<span>ã™ã‘</span></div>
  <div class="ticker" id="tickerBar"></div>
</div>

<!-- HERO CONCLUSION -->
<div class="hero" id="heroBox"></div>

<!-- TOP10 -->
<div class="t5-sec" id="top5Section" style="display:none">
  <div class="t5-tabs">
    <div class="t5-tab active" id="t5TabDip" onclick="setTop5Tab('dip')">ğŸ›¡ ä»Šæ—¥ã®æŠ¼ã—ç›® TOP10</div>
    <div class="t5-tab" id="t5TabMom" onclick="setTop5Tab('mom')">ğŸš€ ä¸Šæ˜‡ä¸­ TOP10</div>
  </div>
  <div class="t5-body" id="top5Body"></div>
</div>

<!-- SHARE -->
<div class="share">
  <button class="share-btn x" onclick="shareX()">ğ• ã§ã‚·ã‚§ã‚¢</button>
  <button class="share-btn line" onclick="shareLine()">LINE ã§é€ã‚‹</button>
  <button class="share-btn copy" onclick="copyLink()">ğŸ”— ã‚³ãƒ”ãƒ¼</button>
</div>

<!-- DANGER -->
<div id="dangerSection"></div>

<!-- AD #1 -->
<div class="ad" id="adSlot1" onclick="gaEvent('ad_click',{slot:'top'})">
  <div style="flex:1"><div class="ad-t">ğŸ“ˆ æŠ¼ã—ç›®ã§è²·ã†ãªã‚‰ SBIè¨¼åˆ¸</div><div class="ad-d">NISAå¯¾å¿œãƒ»æ‰‹æ•°æ–™0å††ã€‚ã‹ã¶ã®ã™ã‘ã®éŠ˜æŸ„ã‚’ã™ãè³¼å…¥</div><div class="ad-pr">PR</div></div>
  <div class="ad-cta">å£åº§é–‹è¨­ â†’</div>
</div>

<!-- AD #2 -->
<div class="ad" id="adSlot2" onclick="gaEvent('ad_click',{slot:'bottom'})" style="background:linear-gradient(135deg,#059669,#047857)">
  <div style="flex:1"><div class="ad-t">ğŸ¯ NISAã§é«˜é…å½“æ ªã‚’å§‹ã‚ã‚ˆã†</div><div class="ad-d">éèª²ç¨ã§é…å½“é‡‘ã‚’å—ã‘å–ã‚Šã€‚ã‹ã¶ã®ã™ã‘éŠ˜æŸ„ã‚’NISAã§é•·æœŸä¿æœ‰</div><div class="ad-pr">PR</div></div>
  <div class="ad-cta" style="color:#059669">è©³ã—ãè¦‹ã‚‹ â†’</div>
</div>

<!-- QUADRANT -->
<div class="q-sec">
  <div class="q-ttl">ğŸ“ ã‹ã¶ã®ã™ã‘ã®ãƒã‚¸ã‚·ãƒ§ãƒ³</div>
  <div class="q-ax">â–² ãƒ•ã‚¡ãƒ³ãƒ€ãƒ¡ãƒ³ã‚¿ãƒ«</div>
  <div style="display:flex;align-items:center">
    <div class="q-ax" style="writing-mode:vertical-rl;transform:rotate(180deg);padding:6px 2px">â—€ é•·æœŸ</div>
    <div class="q-grid" style="flex:1">
      <div class="q-cell tl"><b>å››å­£å ±ãƒ»ãƒãƒ•ã‚§ãƒƒãƒˆ</b>ãƒ•ã‚¡ãƒ³ãƒ€Ã—é•·æœŸ</div>
      <div class="q-cell tr"><b>ãƒãƒãƒƒã‚¯ã‚¹ãƒ»SBI</b>ãƒ•ã‚¡ãƒ³ãƒ€Ã—çŸ­æœŸ</div>
      <div class="q-cell bl"><b>ï¼ˆç©ºç™½åœ°å¸¯ï¼‰</b>ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«Ã—é•·æœŸ</div>
      <div class="q-cell br"><b>ã‹ã¶ã®ã™ã‘</b>ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«Ã—çŸ­æœŸ<br>ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³æŠ¼ã—ç›®ã‚¹ã‚³ã‚¢</div>
    </div>
    <div class="q-ax" style="writing-mode:vertical-rl;padding:6px 2px">çŸ­æœŸ â–¶</div>
  </div>
  <div class="q-ax">â–¼ ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«</div>
</div>

<!-- FOOTER -->
<div class="footer">
  â€» æœ¬ã‚µã‚¤ãƒˆã¯æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æŠ•è³‡åˆ¤æ–­ã¯è‡ªå·±è²¬ä»»ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚<br>
  ã‹ã¶ã®ã™ã‘ v7.3 Â· æŠ¼ã—ç›®ã‚¹ã‚³ã‚¢ Â· æ¯æœ7:30è‡ªå‹•æ›´æ–°<br>
  <a href="#" onclick="openLogic();return false" style="color:var(--blue-m);text-decoration:none;font-weight:600">ğŸ“ ã‚¹ã‚³ã‚¢ã®ä»•çµ„ã¿ã‚’è¦‹ã‚‹</a>
</div>

<!-- LOGIC MODAL -->
<div class="modal-bg" id="logicModal" onclick="if(event.target===this)this.classList.remove('open')">
  <div class="modal">
    <h3>ğŸ“ ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ v7</h3>
    <p><strong style="color:var(--text)">ã‚³ãƒ³ã‚»ãƒ—ãƒˆï¼š</strong>å¤§æ‰‹ã®å®‰å®šä¸Šæ˜‡æ ªã‚’ã€ã€Œä¸‹ãŒã‚Šã«ãã„ä¾¡æ ¼å¸¯ã€ã¾ã§ä¸‹ãŒã£ãŸæ™‚ã«è²·ã†</p>
    <table style="width:100%;font-size:11px;border-collapse:collapse;margin:8px 0">
      <tr style="background:var(--blue);color:#fff"><th style="padding:6px 8px;text-align:left">è¦ç´ </th><th style="padding:6px 8px;text-align:right">é…ç‚¹</th><th style="padding:6px 8px;text-align:left">æ„å‘³</th></tr>
      <tr><td style="padding:5px 8px;border-bottom:1px solid var(--border)">ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã¨ã®è·é›¢</td><td style="padding:5px 8px;text-align:right;border-bottom:1px solid var(--border)"><strong>25ç‚¹</strong></td><td style="padding:5px 8px;border-bottom:1px solid var(--border)">åç™ºã—ã‚„ã™ã„ä¾¡æ ¼å¸¯ã«è¿‘ã„ï¼è²·ã„æ™‚</td></tr>
      <tr><td style="padding:5px 8px;border-bottom:1px solid var(--border)">çŸ­æœŸã®ç›®å®‰ã¨ã®å·®</td><td style="padding:5px 8px;text-align:right;border-bottom:1px solid var(--border)">15ç‚¹</td><td style="padding:5px 8px;border-bottom:1px solid var(--border)">çŸ­æœŸçš„ã«ã©ã‚Œã ã‘èª¿æ•´ã—ã¦ã„ã‚‹ã‹</td></tr>
      <tr><td style="padding:5px 8px;border-bottom:1px solid var(--border)">20æ—¥ãƒªã‚¿ãƒ¼ãƒ³</td><td style="padding:5px 8px;text-align:right;border-bottom:1px solid var(--border)">15ç‚¹</td><td style="padding:5px 8px;border-bottom:1px solid var(--border)">ç›´è¿‘ã®æ–¹å‘</td></tr>
      <tr><td style="padding:5px 8px;border-bottom:1px solid var(--border)">120æ—¥ãƒªã‚¿ãƒ¼ãƒ³</td><td style="padding:5px 8px;text-align:right;border-bottom:1px solid var(--border)">10ç‚¹</td><td style="padding:5px 8px;border-bottom:1px solid var(--border)">é•·æœŸãƒˆãƒ¬ãƒ³ãƒ‰</td></tr>
      <tr><td style="padding:5px 8px;border-bottom:1px solid var(--border)">60æ—¥ãƒªã‚¿ãƒ¼ãƒ³</td><td style="padding:5px 8px;text-align:right;border-bottom:1px solid var(--border)">10ç‚¹</td><td style="padding:5px 8px;border-bottom:1px solid var(--border)">ä¸­æœŸãƒˆãƒ¬ãƒ³ãƒ‰</td></tr>
      <tr><td style="padding:5px 8px;border-bottom:1px solid var(--border)">æŒã£ã¦ã¦å®‰å¿ƒ</td><td style="padding:5px 8px;text-align:right;border-bottom:1px solid var(--border)">15ç‚¹</td><td style="padding:5px 8px;border-bottom:1px solid var(--border)">é…å½“+å®‰å®š+å¤§å‹</td></tr>
      <tr><td style="padding:5px 8px">ä¸€è²«æ€§ãƒœãƒ¼ãƒŠã‚¹</td><td style="padding:5px 8px;text-align:right">Â±10ç‚¹</td><td style="padding:5px 8px">ãƒˆãƒ¬ãƒ³ãƒ‰ã®ä¿¡é ¼æ€§</td></tr>
    </table>
    <p><strong style="color:var(--text)">ğŸ· ã‚¿ã‚¤ãƒ—è‡ªå‹•åˆ¤å®šï¼š</strong></p>
    <p>ğŸ›¡ æŠ¼ã—ç›® â€” ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã®ä¸Šã§çŸ­æœŸèª¿æ•´ä¸­ = è²·ã„ãƒãƒ£ãƒ³ã‚¹<br>ğŸš€ å‹¢ã„ â€” ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰å…¨é–‹ = æµã‚Œã«ä¹—ã‚‹<br>âš  è½ã¡ã‚‹ãƒŠã‚¤ãƒ• â€” ã‚µãƒãƒ¼ãƒˆå‰²ã‚Œ = ä»Šã¯è§¦ã‚‰ãªã„<br>ğŸ”„ åç™º â€” ä¸‹è½å¾Œã«æŒã¡ç›´ã—ã®å…†ã— = æ§˜å­è¦‹</p>
    <button class="close-btn" onclick="document.getElementById('logicModal').classList.remove('open')">âœ• é–‰ã˜ã‚‹</button>
  </div>
</div>

<!-- SETTINGS -->
<div class="settings-panel" id="settingsPanel">
  <h3 style="font-size:15px;font-weight:800;margin-bottom:16px">âš™ è¨­å®š</h3>
  <div style="margin-bottom:16px">
    <div style="font-size:11px;font-weight:600;color:var(--text2);margin-bottom:6px">æœ€ä½é…å½“åˆ©å›ã‚Š</div>
    <div style="display:flex;align-items:center;gap:8px">
      <input type="range" id="minDivSlider" min="0" max="5" step="0.5" value="0" oninput="settings.mindiv=parseFloat(this.value);document.getElementById('minDivVal').textContent=this.value+'%';run();" style="flex:1">
      <span id="minDivVal" style="font-family:var(--fn);font-size:12px">0%</span>
    </div>
  </div>
  <div style="margin-bottom:16px">
    <div style="font-size:11px;font-weight:600;color:var(--text2);margin-bottom:6px">ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆ</div>
    <div id="watchlistDisp" style="font-size:11px;color:var(--text3)"></div>
  </div>
  <button class="close-btn" onclick="document.getElementById('settingsPanel').classList.remove('open')">âœ• é–‰ã˜ã‚‹</button>
</div>

<!-- BOTTOM NAV -->
<nav class="bnav">
  <a href="#" class="active" onclick="return false"><span class="bnav-i">ğŸ </span>ãƒ›ãƒ¼ãƒ </a>
  <a href="#" onclick="document.getElementById('top5Section').scrollIntoView({behavior:'smooth'});return false"><span class="bnav-i">ğŸ“‹</span>TOP10</a>
  <a href="#" onclick="return false"><span class="bnav-i">â­</span>ã‚¦ã‚©ãƒƒãƒ</a>
  <a href="#" onclick="document.getElementById('settingsPanel').classList.toggle('open');return false"><span class="bnav-i">âš™</span>è¨­å®š</a>
  <a href="#" onclick="shareX();return false"><span class="bnav-i">ğŸ“¤</span>ã‚·ã‚§ã‚¢</a>
</nav>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KABUNOSUKE v7 â€” MA75 QualityÃ—Timing
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SAMPLE_STOCKS=[
{code:"8316",name:"ä¸‰äº•ä½å‹FG",sector:"éŠ€è¡Œæ¥­",price:3200,ma25:3300,ma75:3100,rsi:38,dividend:3.8,pbr:0.9,per:11,vol_r:1.1,market_cap_b:9500,volatility:1.5,ret5:-2.5,ret10:-1.8,ret20:-3.2,ret60:8.5,ret120:22,roe:12,ma25_dev:-3.0,ma75_dev:3.2,trend_type:"dip",closes_60d:[]},
{code:"9433",name:"KDDI",sector:"æƒ…å ±ãƒ»é€šä¿¡æ¥­",price:4800,ma25:4900,ma75:4700,rsi:41,dividend:3.2,pbr:1.8,per:14,vol_r:0.9,market_cap_b:11000,volatility:1.2,ret5:-1.8,ret10:-0.5,ret20:-2.1,ret60:5.2,ret120:12,roe:15,ma25_dev:-2.1,ma75_dev:2.1,trend_type:"dip",closes_60d:[]},
];
const SECTOR_MAP={"éŠ€è¡Œæ¥­":"ğŸ¦ éŠ€è¡Œ","ãƒ¡ã‚¬ãƒãƒ³ã‚¯":"ğŸ¦ ãƒ¡ã‚¬ãƒãƒ³ã‚¯","æƒ…å ±ãƒ»é€šä¿¡æ¥­":"ğŸ“¡ é€šä¿¡","é€šä¿¡ã‚­ãƒ£ãƒªã‚¢":"ğŸ“¡ é€šä¿¡ã‚­ãƒ£ãƒªã‚¢","é›»æ°—æ©Ÿå™¨":"âš¡ é›»æ©Ÿ","è¼¸é€ç”¨æ©Ÿå™¨":"ğŸš— è‡ªå‹•è»Š","åŒ»è–¬å“":"ğŸ’Š åŒ»è–¬","åŒ–å­¦":"ğŸ§ª åŒ–å­¦","å¸å£²æ¥­":"ğŸ“¦ å•†ç¤¾","ç·åˆå•†ç¤¾":"ğŸ“¦ ç·åˆå•†ç¤¾","ä¿é™ºæ¥­":"ğŸ›¡ ä¿é™º","å»ºè¨­æ¥­":"ğŸ— å»ºè¨­","é£Ÿæ–™å“":"ğŸ™ é£Ÿå“","ä¸å‹•ç”£æ¥­":"ğŸ  ä¸å‹•ç”£","é™¸é‹æ¥­":"ğŸšƒ é™¸é‹","æ©Ÿæ¢°":"âš™ æ©Ÿæ¢°","é‰„é‹¼":"ğŸ”© é‰„é‹¼","ã‚µãƒ¼ãƒ“ã‚¹æ¥­":"ğŸ’¼ ã‚µãƒ¼ãƒ“ã‚¹","å°å£²æ¥­":"ğŸ›’ å°å£²","ãã®ä»–é‡‘èæ¥­":"ğŸ’³ é‡‘è","ã‚¬ãƒ©ã‚¹ãƒ»åœŸçŸ³è£½å“":"ğŸ§± ã‚¬ãƒ©ã‚¹","éé‰„é‡‘å±":"ğŸ”§ éé‰„","ç¹Šç¶­è£½å“":"ğŸ‘• ç¹Šç¶­","çŸ³æ²¹ãƒ»çŸ³ç‚­è£½å“":"â›½ çŸ³æ²¹","é›»æ°—ãƒ»ã‚¬ã‚¹æ¥­":"ğŸ’¡ é›»åŠ›","æµ·é‹æ¥­":"ğŸš¢ æµ·é‹","ç©ºé‹æ¥­":"âœˆ ç©ºé‹","é‰±æ¥­":"â› é‰±æ¥­","ãƒ‘ãƒ«ãƒ—ãƒ»ç´™":"ğŸ“„ ç´™ãƒ‘","ã‚´ãƒ è£½å“":"ğŸ”´ ã‚´ãƒ ","é‡‘å±è£½å“":"ğŸ”¨ é‡‘å±","ç²¾å¯†æ©Ÿå™¨":"ğŸ”¬ ç²¾å¯†","æ°´ç”£ãƒ»è¾²æ—æ¥­":"ğŸŸ æ°´ç”£","å€‰åº«ãƒ»é‹è¼¸é–¢é€£æ¥­":"ğŸ“¦ å€‰åº«","ãã®ä»–è£½å“":"ğŸ¯ ãã®ä»–è£½å“","è¨¼åˆ¸ã€å•†å“å…ˆç‰©å–å¼•æ¥­":"ğŸ“ˆ è¨¼åˆ¸","ã‚²ãƒ¼ãƒ ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡":"ğŸ® ã‚²ãƒ¼ãƒ ","åŠå°ä½“":"ğŸ’ åŠå°ä½“","ITãƒ»SaaS":"ğŸ’» SaaS","ITãƒ»ãƒãƒƒãƒˆ":"ğŸŒ IT","Technology":"ğŸ’» ãƒ†ãƒƒã‚¯","Communication Services":"ğŸ“¡ é€šä¿¡","Financial Services":"ğŸ’³ é‡‘è","Consumer Cyclical":"ğŸ›’ æ¶ˆè²»","Consumer Defensive":"ğŸ™ ç”Ÿæ´»å¿…éœ€","Healthcare":"ğŸ’Š åŒ»è–¬","Industrials":"âš™ ç”£æ¥­","Basic Materials":"ğŸ§ª ç´ æ","Energy":"â›½ ã‚¨ãƒãƒ«ã‚®ãƒ¼","Real Estate":"ğŸ  ä¸å‹•ç”£","Utilities":"ğŸ’¡ å…¬ç›Š"};
const TREND_LABEL={"dip":"ğŸ›¡ æŠ¼ã—ç›®","momentum":"ğŸš€ å‹¢ã„","falling":"âš  è½ã¡ã‚‹ãƒŠã‚¤ãƒ•","bounce":"ğŸ”„ åç™º","neutral":"ğŸ˜ æ–¹å‘æ„Ÿãªã—","avoid":"ğŸš« å¯¾è±¡å¤–"};
let RAW=[],processed=[],EVENTS=[];
let settings={mindiv:0,style:'trend',disp:10,zone:'all',sort:'score',sortDir:-1,sector:'all',top5tab:'dip'};
let favorites=JSON.parse(localStorage.getItem('kbn_fav')||'[]');


// â”€â”€ LocalStorage â”€â”€
try{
  const sv=JSON.parse(localStorage.getItem('kbn_settings')||'{}');
  if(sv.mindiv!==undefined)settings.mindiv=sv.mindiv;
}catch(e){}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHART UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcMA(prices,period){
  return prices.map((v,i)=>{
    if(i<period-1)return null;
    let s=0;for(let j=i-period+1;j<=i;j++)s+=prices[j];return s/period;
  });
}
function toPath(vals,w,h,pad,mn,mx){
  const pts=[];const rng=mx-mn||1;
  vals.forEach((v,i)=>{
    if(v===null)return;
    const x=pad+(i/(vals.length-1))*(w-2*pad);
    const y=pad+(1-(v-mn)/rng)*(h-2*pad);
    pts.push(`${pts.length?'L':'M'}${x.toFixed(1)},${y.toFixed(1)}`);
  });
  return pts.join(' ');
}
function drawSpark(el,closes,w,h){
  if(!closes||!closes.length||!el)return;
  const pad=2;
  const ma=calcMA(closes,20);
  const all=closes.concat(ma.filter(v=>v!==null));
  const mn=Math.min(...all),mx=Math.max(...all);
  const pp=toPath(closes,w,h,pad,mn,mx);
  const mp=toPath(ma,w,h,pad,mn,mx);
  const lastX=pad+((closes.length-1)/(closes.length-1))*(w-2*pad);
  const isUp=closes[closes.length-1]>=closes[0];
  const col=isUp?'#059669':'#DC2626';
  const id='sg_'+Math.random().toString(36).substr(2,6);
  el.innerHTML=`<defs><linearGradient id="${id}" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="${col}" stop-opacity="0.15"/><stop offset="100%" stop-color="${col}" stop-opacity="0.01"/></linearGradient></defs>`+
    `<path d="${pp} L${lastX},${h-pad} L${pad},${h-pad} Z" fill="url(#${id})"/>`+
    `<path d="${mp}" fill="none" stroke="#059669" stroke-width="1" opacity="0.5"/>`+
    `<path d="${pp}" fill="none" stroke="${col}" stroke-width="1.5"/>`;
}
function drawDetailChart(el,closes,ma25v,ma75v){
  if(!closes||!closes.length||!el)return;
  const W=400,H=150,P=6;
  const ma25=calcMA(closes,25);
  const ma75arr=calcMA(closes,Math.min(closes.length,60));
  const all=closes.concat(ma25.filter(v=>v!==null),ma75arr.filter(v=>v!==null));
  const mn=Math.min(...all),mx=Math.max(...all);
  const pp=toPath(closes,W,H,P,mn,mx);
  const lastX=P+((closes.length-1)/(closes.length-1))*(W-2*P);
  const lastY=P+(1-(closes[closes.length-1]-mn)/(mx-mn||1))*(H-2*P);
  const id='dg_'+Math.random().toString(36).substr(2,6);
  el.innerHTML=`<defs><linearGradient id="${id}" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#1B6AC9" stop-opacity="0.12"/><stop offset="100%" stop-color="#1B6AC9" stop-opacity="0.01"/></linearGradient></defs>`+
    `<path d="${pp} L${lastX},${H-P} L${P},${H-P} Z" fill="url(#${id})"/>`+
    `<path d="${toPath(ma75arr,W,H,P,mn,mx)}" fill="none" stroke="#059669" stroke-width="2" opacity="0.8"/>`+
    `<path d="${toPath(ma25,W,H,P,mn,mx)}" fill="none" stroke="#F59E0B" stroke-width="1.5" opacity="0.7"/>`+
    `<path d="${pp}" fill="none" stroke="#1A1A1A" stroke-width="2"/>`+
    `<circle cx="${lastX}" cy="${lastY}" r="4" fill="#DC2626" stroke="#fff" stroke-width="2"/>`+
    `<text x="${P}" y="${H-1}" font-size="9" fill="#8E99A8">60æ—¥å‰</text>`+
    `<text x="${W-P}" y="${H-1}" font-size="9" fill="#8E99A8" text-anchor="end">ä»Šæ—¥</text>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCORE (JSç‰ˆ â€” Pythonå´ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcScoreTrend(s){
  const mc=s.market_cap_b||0;
  if(mc<300)return{score:0,type:'avoid'};
  let sc=0;
  const r120=s.ret120||0,r60=s.ret60||0,r20=s.ret20||0;
  const ma75d=s.ma75_dev||0,ma25d=s.ma25_dev||0;
  // MA75 (25pt)
  if(ma75d>=0&&ma75d<=1)sc+=25;else if(ma75d>=0&&ma75d<=2)sc+=22;else if(ma75d>=0&&ma75d<=3)sc+=18;
  else if(ma75d>=0&&ma75d<=5)sc+=14;else if(ma75d>=0&&ma75d<=8)sc+=10;else if(ma75d>=0&&ma75d<=12)sc+=6;
  else if(ma75d>12)sc+=2;
  else if(ma75d>=-2&&ma75d<0)sc+=3;  // ã‚ãšã‹ã«ä¸‹: ã»ã¼åŠ ç‚¹ãªã—
  else if(ma75d>=-5&&ma75d<-2)sc+=0;  // æ˜ç¢ºã«ä¸‹: 0ç‚¹
  else sc-=5;                          // å¤§ããä¸‹: ãƒšãƒŠãƒ«ãƒ†ã‚£
  // MA25 (15pt)
  if(ma25d>=-5&&ma25d<=-3)sc+=15;else if(ma25d>=-8&&ma25d<-5)sc+=10;else if(ma25d>=-3&&ma25d<=-1)sc+=10;
  else if(ma25d>-1&&ma25d<=0)sc+=6;else if(ma25d>0&&ma25d<=3)sc+=3;else if(ma25d>3)sc+=8;else if(ma25d<-8)sc+=3;
  // r20 (15pt)
  if(r20>=10)sc+=15;else if(r20>=5)sc+=12;else if(r20>=2)sc+=8;else if(r20>=0)sc+=4;
  else if(r20>=-3)sc+=6;else if(r20>=-5)sc+=10;else if(r20>=-8)sc+=8;else sc+=3;
  // r120 (10pt)
  if(r120>=30)sc+=10;else if(r120>=15)sc+=8;else if(r120>=5)sc+=6;else if(r120>=0)sc+=3;else if(r120>=-5)sc+=0;else sc-=3;
  // r60 (10pt)
  if(r60>=15)sc+=10;else if(r60>=8)sc+=8;else if(r60>=3)sc+=5;else if(r60>=0)sc+=2;else if(r60>=-5)sc+=0;else sc-=3;
  // å®‰å¿ƒ (15pt)
  const div=s.dividend||0,vol=s.volatility||2,roe=s.roe||0;
  if(div>=4)sc+=5;else if(div>=3)sc+=4;else if(div>=2.5)sc+=3;else if(div>=2)sc+=2;
  if(vol<=1.5&&r120>=5)sc+=5;else if(vol<=2&&r120>=5)sc+=4;else if(vol<=2.5&&r120>=0)sc+=2;
  if(mc>=10000)sc+=5;else if(mc>=5000)sc+=4;else if(mc>=2000)sc+=3;else if(mc>=1000)sc+=2;else if(mc>=500)sc+=1;
  // ä¸€è²«æ€§ (Â±10pt)
  const pc=[r120,r60,r20].filter(r=>r>0).length;
  if(pc===3)sc+=10;else if(pc===2)sc+=5;else if(pc===0)sc-=5;
  // ãƒšãƒŠãƒ«ãƒ†ã‚£
  const vr1d=s.vol_ratio_1d||1,ret1d=s.ret_1d||0,rsi=s.rsi||50;
  if(vr1d>=3&&ret1d<=-3)sc-=10;if(vr1d>=3&&ret1d>=5)sc-=8;if(rsi>=80)sc-=5;
  sc=Math.max(0,Math.min(sc,100));
  // type
  let type='neutral';
  if(ma75d>=0&&ma25d<0&&pc>=2)type='dip';
  else if(ma75d>=0&&ma25d>=0&&pc>=2)type='momentum';
  else if(ma75d<0&&ma25d<0)type='falling';
  else if(ma75d<0&&ma25d>=0)type='bounce';
  // fallingè¿½åŠ ãƒšãƒŠãƒ«ãƒ†ã‚£
  if(type==='falling')sc=Math.max(0,sc-10);
  return{score:sc,type};
}

function getZone(sc){return sc>=60?'buy':sc>=40?'watch':'hold';}
// ã‚³ãƒ¼ãƒ‰åˆ¥ã®å¼·åˆ¶ä¸Šæ›¸ãï¼ˆJSONã®åˆ†é¡ã«é–¢ã‚ã‚‰ãšç¢ºå®Ÿã«æ—¥æœ¬èªè¡¨ç¤ºï¼‰
const CODE_SECTOR={"7974":"ğŸ® ã‚²ãƒ¼ãƒ ","3635":"ğŸ® ã‚²ãƒ¼ãƒ ","9684":"ğŸ® ã‚²ãƒ¼ãƒ ","9766":"ğŸ® ã‚²ãƒ¼ãƒ ","3659":"ğŸ® ã‚²ãƒ¼ãƒ ","2121":"ğŸ® ã‚²ãƒ¼ãƒ ","9697":"ğŸ® ã‚²ãƒ¼ãƒ ","7832":"ğŸ® ã‚²ãƒ¼ãƒ ","3668":"ğŸ® ã‚²ãƒ¼ãƒ ","3765":"ğŸ® ã‚²ãƒ¼ãƒ ","6723":"ğŸ’ åŠå°ä½“","6526":"ğŸ’ åŠå°ä½“","6857":"ğŸ’ åŠå°ä½“","8035":"ğŸ’ åŠå°ä½“","6920":"ğŸ’ åŠå°ä½“","6146":"ğŸ’ åŠå°ä½“","4443":"ğŸ’» SaaS","4478":"ğŸ’» SaaS","4751":"ğŸŒ IT","4689":"ğŸŒ IT","4755":"ğŸŒ IT","9434":"ğŸ“¡ é€šä¿¡ã‚­ãƒ£ãƒªã‚¢","9433":"ğŸ“¡ é€šä¿¡ã‚­ãƒ£ãƒªã‚¢","9432":"ğŸ“¡ é€šä¿¡ã‚­ãƒ£ãƒªã‚¢","8058":"ğŸ“¦ ç·åˆå•†ç¤¾","8031":"ğŸ“¦ ç·åˆå•†ç¤¾","8001":"ğŸ“¦ ç·åˆå•†ç¤¾","8002":"ğŸ“¦ ç·åˆå•†ç¤¾","8053":"ğŸ“¦ ç·åˆå•†ç¤¾","8306":"ğŸ¦ ãƒ¡ã‚¬ãƒãƒ³ã‚¯","8316":"ğŸ¦ ãƒ¡ã‚¬ãƒãƒ³ã‚¯","8411":"ğŸ¦ ãƒ¡ã‚¬ãƒãƒ³ã‚¯"};
function sMap(s,code){if(code&&CODE_SECTOR[code])return CODE_SECTOR[code];return SECTOR_MAP[s]||s||'ãã®ä»–';}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROCESS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function processStocks(){
  let out=RAW.map(s=>{
    const {score,type}=calcScoreTrend(s);
    s.score=score;s.trend_type=type;s.zone=getZone(score);
    return s;
  });
  if(settings.mindiv>0)out=out.filter(s=>(s.dividend||0)>=settings.mindiv);
  if(settings.zone==='buy')out=out.filter(s=>s.zone==='buy');
  else if(settings.zone==='buywatch')out=out.filter(s=>s.zone==='buy'||s.zone==='watch');
  if(settings.sector!=='all')out=out.filter(s=>sMap(s.sector,s.code)===settings.sector);
  out.sort((a,b)=>settings.sortDir*((b[settings.sort]||0)-(a[settings.sort]||0)));
  processed=out;
  return out;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTicker(){
  const el=document.getElementById('tickerBar');
  el.innerHTML=['æ—¥çµŒå¹³å‡ ğŸ‡¯ğŸ‡µ','NYãƒ€ã‚¦ ğŸ‡ºğŸ‡¸','ãƒ‰ãƒ«å††'].map(l=>`<div class="ticker-item"><div class="ticker-lbl">${l}</div><div class="ticker-val">â€”</div><div class="ticker-chg">â€”</div></div>`).join('');
}
function renderHero(){
  const el=document.getElementById('heroBox');
  const all=processStocks();
  const buyN=all.filter(s=>s.zone==='buy').length;
  const topSc=all.length?Math.max(...all.map(s=>s.score)):0;
  const maxDiv=all.length?Math.max(...all.map(s=>s.dividend||0)).toFixed(1)+'%':'â€”';
  // ç‹™ã„ã‚»ã‚¯ã‚¿ãƒ¼è¨ˆç®—
  const dipStocks=all.filter(s=>s.trend_type==='dip'&&s.score>=50);
  const secCount={};
  dipStocks.forEach(s=>{const k=sMap(s.sector,s.code);secCount[k]=(secCount[k]||0)+1;});
  const topSecs=Object.entries(secCount).sort((a,b)=>b[1]-a[1]).slice(0,3).map(x=>x[0]);
  // ã‚¹ã‚¿ãƒ³ã‚¹åˆ¤å®š
  const avgSc=all.length?all.reduce((s,x)=>s+x.score,0)/all.length:0;
  const dipRatio=all.length?dipStocks.length/all.length:0;
  let stanceClass='neutral',stanceText='ğŸ“Š æ§˜å­è¦‹';
  if(avgSc>=50&&dipRatio>=0.1){stanceClass='bull';stanceText='ğŸ“ˆ ã‚„ã‚„å¼·æ°—';}
  else if(avgSc>=40){stanceClass='neutral';stanceText='ğŸ“Š æ§˜å­è¦‹';}
  else{stanceClass='bear';stanceText='ğŸ“‰ ã‚„ã‚„å¼±æ°—';}
  const updated=window._updatedAt||'â€”';
  el.innerHTML=`
    <div class="hero-date">${updated} æ›´æ–°</div>
    <div class="hero-hl">ä»Šæ—¥ã®æŠ¼ã—ç›®ï¼š<em>${topSecs.length?topSecs.join('ãƒ»'):'è§£æä¸­...'}</em>ãŒç‹™ã„ç›®</div>
    <span class="stance ${stanceClass}">${stanceText}</span>
    <div class="hero-chips">${topSecs.map(s=>`<span class="hero-chip">${s}</span>`).join('')}</div>
    <div class="hero-stats">
      <div class="hero-stat"><b>${buyN}</b><small>éŠ˜æŸ„ãŒè²·ã„æ™‚</small></div>
      <div class="hero-stat"><b>${topSc}</b><small>æœ€é«˜ã‚¹ã‚³ã‚¢</small></div>
      <div class="hero-stat"><b>${maxDiv}</b><small>æœ€é«˜é…å½“</small></div>
      <div class="hero-stat"><b>${all.length}</b><small>ã‚¹ã‚­ãƒ£ãƒ³æ•°</small></div>
    </div>`;
}

function genReason(s){
  const parts=[];
  if(s.ma75_dev!==undefined){
    if(s.ma75_dev>=0&&s.ma75_dev<=3)parts.push(`ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ï¼ˆç·‘ç·šï¼‰ã«ã‚¿ãƒƒãƒæ¥è¿‘ä¸­`);
    else if(s.ma75_dev>3&&s.ma75_dev<=8)parts.push(`ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰ç¶™ç¶šä¸­`);
    else if(s.ma75_dev>8)parts.push(`é«˜å€¤åœã§æ¨ç§»`);
    else parts.push(`ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä¸‹å›ã‚Šæ³¨æ„`);
  }
  if(s.ret120>10)parts.push(`åŠå¹´ã§+${s.ret120.toFixed(0)}%æˆé•·`);
  else if(s.ret120>5)parts.push(`åŠå¹´ã§å®‰å®šä¸Šæ˜‡`);
  if(s.dividend>=3)parts.push(`é…å½“${s.dividend.toFixed(1)}%`);
  return parts.slice(0,3).join(' Â· ')||'åˆ†æä¸­â€¦';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOP10 + INLINE DETAIL EXPAND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let expandedCode=null;

function renderTop10(){
  const sec=document.getElementById('top5Section');
  sec.style.display='';
  const body=document.getElementById('top5Body');
  const tab=settings.top5tab;
  const items=processed.filter(s=>tab==='dip'?s.trend_type==='dip':s.trend_type==='momentum').slice(0,10);
  if(!items.length){body.innerHTML='<div style="padding:24px;text-align:center;color:var(--text3);font-size:13px">è©²å½“ã™ã‚‹éŠ˜æŸ„ãŒã‚ã‚Šã¾ã›ã‚“</div>';return;}
  let html='<div class="t5-grid">';
  items.forEach((s,i)=>{
    const hasSpark=s.closes_60d&&s.closes_60d.length>10;
    const isOpen=expandedCode===s.code;
    const divBadge=(s.dividend||0)>=2?`<span class="div-badge">ğŸ’° ${(s.dividend||0).toFixed(1)}%</span>`:`é…å½“${(s.dividend||0).toFixed(1)}%`;
    const gaugeColor=s.score>=60?'var(--green)':s.score>=40?'var(--amber)':'var(--red)';
    html+=`<div class="t5-item" onclick="toggleExpand('${s.code}')" style="${isOpen?'background:var(--blue-l)':''}">
      <div class="t5-rank${i===0?' gold':''}">${i+1}</div>
      <div class="t5-info">
        <div class="t5-nm">${s.name}</div>
        <div class="t5-meta">${s.code} Â· ${sMap(s.sector,s.code)} Â· ${divBadge}</div>
        <div class="t5-reason">${genReason(s)}</div>
      </div>
      ${hasSpark?`<svg class="t5-spark" viewBox="0 0 120 44" data-spark="${s.code}"></svg>`:''}
      <div class="t5-right">
        <div class="t5-sc">${s.score}<span>pt</span></div>
        <div class="t5-gauge"><div class="t5-gauge-fill" style="width:${s.score}%;background:${gaugeColor}"></div></div>
        <div class="t5-type ${s.trend_type==='dip'?'dip':'mom'}">${TREND_LABEL[s.trend_type]||s.trend_type}</div>
      </div>
    </div>`;
    if(isOpen) html+=buildExpand(s);
  });
  html+='</div>';
  body.innerHTML=html;
  // Draw sparklines
  items.forEach(s=>{
    if(s.closes_60d&&s.closes_60d.length>10){
      const el=body.querySelector(`[data-spark="${s.code}"]`);
      if(el)drawSpark(el,s.closes_60d,120,44);
    }
  });
  // Draw detail chart
  if(expandedCode){
    setTimeout(()=>{
      const s=items.find(x=>x.code===expandedCode);
      if(s&&s.closes_60d&&s.closes_60d.length>10){
        const el=document.querySelector(`[data-dchart="${expandedCode}"]`);
        if(el)drawDetailChart(el,s.closes_60d,s.ma25,s.ma75);
      }
    },50);
  }
}

function toggleExpand(code){
  expandedCode=expandedCode===code?null:code;
  renderTop10();
  if(expandedCode){
    setTimeout(()=>{
      const el=document.querySelector(`[data-dchart="${code}"]`)||document.querySelector('.t5-expand');
      if(el)el.scrollIntoView({behavior:'smooth',block:'nearest'});
    },100);
    gaEvent('detail_open',{code});
  }
}

function buildExpand(s){
  const hasSpark=s.closes_60d&&s.closes_60d.length>10;
  const ma75pct=Math.max(5,Math.min(95,50+(s.ma75_dev||0)*3));
  const ma25pct=Math.max(5,Math.min(95,50+(s.ma25_dev||0)*3));
  const ma75col=(s.ma75_dev||0)>=0?'var(--green)':'var(--red)';
  const ma25col=(s.ma25_dev||0)>=0?'var(--green)':'var(--red)';
  // Signal (åˆå¿ƒè€…å‘ã‘)
  let signal='';
  if(s.trend_type==='dip'){
    signal=`é•·æœŸã§ã¯ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰ã€‚çŸ­æœŸçš„ã«èª¿æ•´ä¸­ã§<strong>è²·ã„ã‚„ã™ã„ä¾¡æ ¼å¸¯ã«æ¥è¿‘ä¸­</strong>ã€‚`;
    if(s.ma75_dev<=3)signal+=`<br>ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ï¼ˆç·‘ç·š Â¥${(s.ma75||0).toLocaleString()}ï¼‰ã¾ã§ã‚ã¨${(s.ma75_dev||0).toFixed(1)}%ã€‚ã“ã“ã¾ã§ä¸‹ãŒã‚Œã°çµ¶å¥½ã®ãƒãƒ£ãƒ³ã‚¹ã€‚`;
    else signal+=`<br>ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã¾ã§ã¾ã è·é›¢ã‚ã‚Šï¼ˆ${(s.ma75_dev||0).toFixed(1)}%ï¼‰ã€‚ã‚‚ã†å°‘ã—ä¸‹ãŒã‚‹ã®ã‚’å¾…ã¤æ‰‹ã‚‚ã€‚`;
  }else if(s.trend_type==='momentum'){
    signal=`çŸ­æœŸãƒ»é•·æœŸã¨ã‚‚ã«ä¸Šæ˜‡ä¸­ã€‚<strong>å‹¢ã„ã«ä¹—ã£ã¦ã„ã‚‹çŠ¶æ…‹</strong>ã€‚é«˜å€¤æ´ã¿ã«æ³¨æ„ã—ã¤ã¤ã€æµã‚Œã«ä¹—ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚`;
  }else{
    signal=`ç¾åœ¨ã¯æ–¹å‘æ„ŸãŒèª­ã¿ã«ãã„çŠ¶æ³ã€‚ç„¡ç†ã›ãšæ§˜å­è¦‹ãŒãŠã™ã™ã‚ã€‚`;
  }
  // MA tag
  let ma75tag='';
  if(s.ma75_dev>=0&&s.ma75_dev<=3)ma75tag='<span class="d-ma-tag near">æ¥è¿‘ä¸­!</span>';

  return `<div class="t5-expand">
  <div class="d-grid">
    <!-- LEFT: ãƒãƒ£ãƒ¼ãƒˆ -->
    <div>
      <div class="d-sec-ttl">ğŸ“Š å€¤å‹•ããƒãƒ£ãƒ¼ãƒˆï¼ˆ60æ—¥ï¼‰</div>
      ${hasSpark?`<div class="d-chart-box">
        <svg class="d-chart-svg" viewBox="0 0 400 150" data-dchart="${s.code}"></svg>
        <div class="d-legend">
          <div class="d-leg"><div class="d-leg-ln" style="background:#1A1A1A"></div>æ ªä¾¡</div>
          <div class="d-leg"><div class="d-leg-ln" style="background:#F59E0B"></div>çŸ­æœŸã®ç›®å®‰ <b style="color:#F59E0B">Â¥${(s.ma25||0).toLocaleString()}</b></div>
          <div class="d-leg"><div class="d-leg-ln" style="background:#059669"></div>ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ <b style="color:#059669">Â¥${(s.ma75||0).toLocaleString()}</b></div>
        </div>
      </div>`:`<div style="padding:20px;text-align:center;background:var(--card);border-radius:8px;border:1px solid var(--border)">
        <div style="font-size:12px;color:var(--text)">çŸ­æœŸã®ç›®å®‰: Â¥${(s.ma25||0).toLocaleString()} / ã‚µãƒãƒ¼ãƒˆ: Â¥${(s.ma75||0).toLocaleString()}</div>
      </div>`}
      <div class="d-ma">
        <div class="d-ma-row">
          <div class="d-ma-lbl">çŸ­æœŸã®ç›®å®‰ã¨ã®å·®</div>
          <div class="d-ma-bar"><div class="d-ma-ctr"></div><div class="d-ma-dot" style="left:${ma25pct}%;background:${ma25col}"></div></div>
          <div class="d-ma-val ${(s.ma25_dev||0)>=0?'up':'dn'}">${(s.ma25_dev||0)>=0?'+':''}${(s.ma25_dev||0).toFixed(1)}%</div>
        </div>
        <div class="d-ma-row">
          <div class="d-ma-lbl">ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã¨ã®å·®</div>
          <div class="d-ma-bar"><div class="d-ma-ctr"></div><div class="d-ma-dot" style="left:${ma75pct}%;background:${ma75col}"></div></div>
          <div class="d-ma-val ${(s.ma75_dev||0)>=0?'up':'dn'}">${(s.ma75_dev||0)>=0?'+':''}${(s.ma75_dev||0).toFixed(1)}%</div>
          ${ma75tag}
        </div>
      </div>
      <div class="d-pl">
        <div class="d-pl-row"><div class="d-pl-lbl">ğŸŸ¢ ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³</div><div class="d-pl-val" style="color:var(--green)">Â¥${(s.ma75||0).toLocaleString()}</div></div>
        <div class="d-pl-row"><div class="d-pl-lbl">ğŸ“ ä»Šã®æ ªä¾¡</div><div class="d-pl-val">Â¥${(s.price||0).toLocaleString()}</div></div>
        <div class="d-pl-row"><div class="d-pl-lbl">ğŸŸ  çŸ­æœŸã®ç›®å®‰</div><div class="d-pl-val" style="color:#F59E0B">Â¥${(s.ma25||0).toLocaleString()}</div></div>
      </div>
    </div>
    <!-- RIGHT: æŒ‡æ¨™ -->
    <div>
      <div class="d-sec-ttl">ğŸ“ˆ ã“ã®éŠ˜æŸ„ã®ãƒã‚¤ãƒ³ãƒˆ</div>
      <div class="d-cards">
        <div class="d-card"><b>${(s.dividend||0).toFixed(1)}%</b><small>å¹´é–“é…å½“</small></div>
        <div class="d-card"><b>${(s.pbr||0).toFixed(2)}å€</b><small>å‰²å®‰åº¦</small></div>
        <div class="d-card"><b>${(s.roe||0).toFixed(0)}%</b><small>ç¨¼ãåŠ›</small></div>
      </div>
      <div style="font-size:10px;color:var(--text3);margin:-4px 0 10px;line-height:1.5">
        ğŸ’¡ <strong>å¹´é–“é…å½“</strong>=æŒã£ã¦ã‚‹ã ã‘ã§ã‚‚ã‚‰ãˆã‚‹åˆ©ç›Š / <strong>å‰²å®‰åº¦</strong>(PBR)=1å€ä»¥ä¸‹ãªã‚‰å‰²å®‰ / <strong>ç¨¼ãåŠ›</strong>(ROE)=é«˜ã„ã»ã©å„ªç§€ãªä¼šç¤¾
      </div>
      <div style="font-size:10px;color:var(--text3);margin-bottom:8px;line-height:1.5">
        ğŸ“ <strong>ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³</strong> = éå»75æ—¥é–“ã®å¹³å‡æ ªä¾¡ï¼ˆMA75ï¼‰ã€‚ã“ã“ã¾ã§ä¸‹ãŒã‚‹ã¨åç™ºã—ã‚„ã™ã„ã€Œä¸‹å€¤ã®å£ã€
      </div>
      <div class="d-signal"><b>ğŸ“ ã‹ã¶ã®ã™ã‘ã®åˆ¤å®š</b><p>${signal}</p></div>
      <div class="d-btns">
        <a class="d-btn" href="https://finance.yahoo.co.jp/quote/${s.code}.T" target="_blank" rel="noopener">Yahoo!ãƒ•ã‚¡ã‚¤ãƒŠãƒ³ã‚¹ â†’</a>
        <a class="d-btn" href="https://kabutan.jp/stock/?code=${s.code}" target="_blank" rel="noopener">æ ªæ¢ã§è©³ã—ã â†’</a>
      </div>
    </div>
  </div>
</div>`;
}

function setTop5Tab(tab){
  settings.top5tab=tab;
  expandedCode=null;
  document.getElementById('t5TabDip').classList.toggle('active',tab==='dip');
  document.getElementById('t5TabMom').classList.toggle('active',tab==='mom');
  renderTop10();
}

function renderDanger(){
  const sec=document.getElementById('dangerSection');
  const items=processed.filter(s=>s.trend_type==='falling'&&s.score<=30).slice(0,5);
  if(!items.length){sec.innerHTML='';return;}
  sec.innerHTML=`<div class="danger"><div class="danger-ttl">âš  ä»Šæ—¥ã¯æ‰‹ã‚’å‡ºã•ãªã„æ–¹ãŒã„ã„éŠ˜æŸ„</div>${items.map(s=>`
    <div class="danger-row">
      <div><div class="danger-nm">${s.name}</div><div class="danger-cd">${s.code} Â· ${sMap(s.sector,s.code)}</div></div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;justify-content:flex-end">
        ${s.rsi>=75?`<span class="danger-badge">éç†± RSI${s.rsi}</span>`:''}
        ${(s.ret_1d||0)<=-3?`<span class="danger-badge">å‰æ—¥${s.ret_1d.toFixed(1)}%</span>`:''}
        ${(s.ma75_dev||0)<-5?`<span class="danger-badge">ä¸‹è½ãƒˆãƒ¬ãƒ³ãƒ‰</span>`:''}
        ${s.trend_type==='falling'?'<span class="danger-badge">ã‚µãƒãƒ¼ãƒˆå‰²ã‚Œ</span>':''}
      </div>
    </div>`).join('')}</div>`;
}

// â”€â”€ SHARE â”€â”€
function shareX(){
  const top=processed.filter(s=>s.trend_type==='dip').slice(0,3);
  const text=`ğŸ“Š ã‹ã¶ã®ã™ã‘ ä»Šæ—¥ã®æŠ¼ã—ç›®TOP3\n${top.map((s,i)=>`${i+1}. ${s.name}ï¼ˆ${s.score}ptï¼‰`).join('\n')}\nhttps://oshime.vercel.app/app.html`;
  window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent(text),'_blank');
  gaEvent('share',{platform:'x'});
}
function shareLine(){
  const text='ã‹ã¶ã®ã™ã‘ - ä»Šæ—¥ã®æŠ¼ã—ç›®ãƒã‚§ãƒƒã‚¯ https://oshime.vercel.app/app.html';
  window.open('https://line.me/R/msg/text/?'+encodeURIComponent(text),'_blank');
  gaEvent('share',{platform:'line'});
}
function copyLink(){
  navigator.clipboard.writeText('https://oshime.vercel.app/app.html').then(()=>alert('ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'));
  gaEvent('share',{platform:'copy'});
}

// â”€â”€ MODALS â”€â”€
function openLogic(){document.getElementById('logicModal').classList.add('open');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RUN & INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function run(){
  processStocks();
  renderHero();
  renderTop10();
  renderDanger();
  try{localStorage.setItem('kbn_settings',JSON.stringify({mindiv:settings.mindiv}));}catch(e){}
}

async function init(){
  renderTicker();
  try{
    const r=await fetch('stocks_data.json?t='+Date.now());
    const data=await r.json();
    RAW=data.stocks||[];
    window._updatedAt=data.updated_at||'â€”';
    if(data.nikkei225)document.querySelector('.ticker-item:nth-child(1) .ticker-val').textContent=data.nikkei225.toLocaleString();
  }catch(e){
    RAW=SAMPLE_STOCKS;
    window._updatedAt='ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿';
  }
  run();
  gaEvent('page_view',{version:'v7'});
}

init();
</script>
</body>
</html>
